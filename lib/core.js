/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js_ca8443e7__ from "https://cdn.skypack.dev/pin/three@v0.135.0-pjGUcRG9Xt70OdXl97VF/mode=imports/optimized/three.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js_e9257153__ from "https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_controls_OrbitControls_js_45f05ee1__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_FBXLoader_js_3c26c106__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FBXLoader.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_GLTFLoader_js_9cb5268d__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_EffectComposer_js_4572cba5__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/EffectComposer.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_FilmPass_js_a4cf9645__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/FilmPass.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_RenderPass_js_0dc18f7f__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/RenderPass.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_ShaderPass_js_de906420__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/ShaderPass.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_renderers_CSS2DRenderer_js_d3e40862__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/renderers/CSS2DRenderer.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_shaders_FXAAShader_js_6abc11d7__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/shaders/FXAAShader.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_utils_BufferGeometryUtils_js_2cb856e0__ from "https://cdn.skypack.dev/three@0.136.0/examples/jsm/utils/BufferGeometryUtils.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_threejs_org_examples_jsm_math_ImprovedNoise_js_6d016c7a__ from "https://threejs.org/examples/jsm/math/ImprovedNoise.js";
import * as __WEBPACK_EXTERNAL_MODULE_https_unpkg_com_three_0_137_0_examples_jsm_postprocessing_SMAAPass_js_959c2540__ from "https://unpkg.com/three@0.137.0/examples/jsm/postprocessing/SMAAPass.js";
/******/ var __webpack_modules__ = ({

/***/ "./src/UserInterface/UiController.js":
/*!*******************************************!*\
  !*** ./src/UserInterface/UiController.js ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"UiController\": () => (/* binding */ UiController)\n/* harmony export */ });\n/* harmony import */ var _UiElements_BlockerScreen_BlockerScreen_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./UiElements/BlockerScreen/BlockerScreen.js */ \"./src/UserInterface/UiElements/BlockerScreen/BlockerScreen.js\");\n/* harmony import */ var _UiElements_Common_RingtoneSystem_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./UiElements/Common/RingtoneSystem.js */ \"./src/UserInterface/UiElements/Common/RingtoneSystem.js\");\n/* harmony import */ var _UiElements_PlayScreen_PlayScreen_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./UiElements/PlayScreen/PlayScreen.js */ \"./src/UserInterface/UiElements/PlayScreen/PlayScreen.js\");\n\r\n\r\n\r\n\r\nclass UiController {\r\n\r\n    /**\r\n     * There are 2 levels to the UI, the first one is always active and the second \r\n     * one disappears when the controls are lock.\r\n    */\r\n    constructor() {\r\n        this.blockerScreen = new _UiElements_BlockerScreen_BlockerScreen_js__WEBPACK_IMPORTED_MODULE_0__.BlockerScreen();\r\n        this.playScreen = new _UiElements_PlayScreen_PlayScreen_js__WEBPACK_IMPORTED_MODULE_2__.PlayScreen();\r\n        this.ringtoneSystem = new _UiElements_Common_RingtoneSystem_js__WEBPACK_IMPORTED_MODULE_1__.RingToneSystem();\r\n    }\r\n\r\n    handleControlsLock() {\r\n        if(!VIRTUAL_ENVIRONMENT.touch) {\r\n            LOCAL_PLAYER.controls.lock();\r\n        } else {\r\n            LOCAL_PLAYER.joystick.element.style.display = 'block';\r\n            this.playScreen.controlsInstructions.controlsDisplayBox.element.remove();\r\n        }\r\n        this.blockerScreen.element.style.display = \"none\";\r\n        this.playScreen.element.style.display = \"block\";\r\n    }\r\n\r\n    handleControlsUnlock() {\r\n        if(VIRTUAL_ENVIRONMENT.touch) {\r\n            LOCAL_PLAYER.joystick.element.style.display = 'none';\r\n        }\r\n        this.blockerScreen.element.style.display = \"grid\";\r\n        this.playScreen.element.style.display = \"none\";\r\n    }\r\n\r\n    handleNewMessage(message) {\r\n        this.blockerScreen.menu.menuDisplay.chatPanel.chatOutputDisplay.displayNewMessage(message);\r\n    }\r\n\r\n    handleConnectionClose(peerId) {\r\n        this.blockerScreen.menu.menuDisplay.multiplayerPanel.connectionsManagementDisplay.handleConnectionClose(peerId);\r\n    }\r\n\r\n    update() {\r\n        this.blockerScreen.menu.menuFooter.update();\r\n        this.blockerScreen.menu.menuDisplay.multiplayerPanel.connectionsManagementDisplay.update();\r\n        this.blockerScreen.menu.menuDisplay.videoPanel.update();\r\n        this.blockerScreen.menu.menuDisplay.mapPanel.update();\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiController.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/BlockerScreen.js":
/*!*********************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/BlockerScreen.js ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"BlockerScreen\": () => (/* binding */ BlockerScreen)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _Blocker_Blocker_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Blocker/Blocker.js */ \"./src/UserInterface/UiElements/BlockerScreen/Blocker/Blocker.js\");\n/* harmony import */ var _Menu_Menu_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Menu/Menu.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/Menu.js\");\n\r\n\r\n \r\n\r\n\r\nclass BlockerScreen extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            id: \"blockerScreen\",\r\n            style: {\r\n                position: \"absolute\",\r\n                top: \"0\",\r\n                width: \"100%\",\r\n                height: \"100%\",\r\n                display: \"grid\",\r\n                gridTemplateColumns: \"auto 1fr\",\r\n            }\r\n        })\r\n\r\n        this.blocker = new _Blocker_Blocker_js__WEBPACK_IMPORTED_MODULE_1__.Blocker();\r\n        this.menu = new _Menu_Menu_js__WEBPACK_IMPORTED_MODULE_2__.Menu()\r\n\r\n        this.appendChildList([\r\n            this.menu,\r\n            this.blocker\r\n        ])\r\n\r\n        document.body.appendChild(this.element)\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/BlockerScreen.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Blocker/Blocker.js":
/*!***********************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Blocker/Blocker.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"Blocker\": () => (/* binding */ Blocker)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass Blocker extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            id: \"blocker\",\r\n            style: {\r\n                width: \"100%\",\r\n                height: \"100%\",\r\n                background: \"rgba(0, 0, 0, 0.5)\",\r\n                textAlign: \"center\",\r\n                cursor: \"pointer\",\r\n                fontSize: \"16px\",\r\n                color: \"white\",\r\n                transition: \"all 0.5s ease\"\r\n            },\r\n            hover: {\r\n                background: \"rgba(0, 0, 0, 0.3)\",\r\n                fontSize: \"large\"\r\n            },\r\n            innerHTML: \"Click to play\",\r\n            onClick: () => VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleControlsLock()\r\n        })\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Blocker/Blocker.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/Menu.js":
/*!*****************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/Menu.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"Menu\": () => (/* binding */ Menu)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _MenuElements_MenuHeader_MenuHeader_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./MenuElements/MenuHeader/MenuHeader.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuHeader/MenuHeader.js\");\n/* harmony import */ var _MenuElements_MenuFooter_MenuFooter_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./MenuElements/MenuFooter/MenuFooter.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuFooter/MenuFooter.js\");\n/* harmony import */ var _MenuElements_MenuDisplay_MenuDisplay_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./MenuElements/MenuDisplay/MenuDisplay.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuDisplay.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nclass Menu extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor() {\r\n        super({\r\n            id: \"Menu\",\r\n            style: {\r\n                background: \"white\",\r\n                display: \"grid\",\r\n                gridTemplateRows: \"50px 1fr auto\"\r\n            }\r\n        })\r\n\r\n        this.menuHeader = new _MenuElements_MenuHeader_MenuHeader_js__WEBPACK_IMPORTED_MODULE_1__.MenuHeader();\r\n        this.menuDisplay = new _MenuElements_MenuDisplay_MenuDisplay_js__WEBPACK_IMPORTED_MODULE_3__.MenuDisplay();\r\n        this.menuFooter = new _MenuElements_MenuFooter_MenuFooter_js__WEBPACK_IMPORTED_MODULE_2__.MenuFooter();\r\n\r\n        this.appendChildList([\r\n            this.menuHeader,\r\n            this.menuDisplay,\r\n            this.menuFooter\r\n        ])\r\n\r\n        // set multiplayer as default panel\r\n        this.handleMenuPanelSelection(\"multiplayer\");\r\n    }\r\n\r\n    handleMenuPanelSelection(panel) {\r\n        this.menuDisplay.handleMenuPanelSelection(panel);\r\n        this.menuHeader.handleMenuHeaderSelection(panel);\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/Menu.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuDisplay.js":
/*!*************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuDisplay.js ***!
  \*************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MenuDisplay\": () => (/* binding */ MenuDisplay)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _MenuPanels_ChatPanel_ChatPanel_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./MenuPanels/ChatPanel/ChatPanel.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanel.js\");\n/* harmony import */ var _MenuPanels_MultiplayerPanel_MultiplayerPanel_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./MenuPanels/MultiplayerPanel/MultiplayerPanel.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanel.js\");\n/* harmony import */ var _MenuPanels_AvatarPanel_AvatarPanel_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./MenuPanels/AvatarPanel/AvatarPanel.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanel.js\");\n/* harmony import */ var _MenuPanels_MapPanel_MapPanel_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./MenuPanels/MapPanel/MapPanel.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MapPanel/MapPanel.js\");\n/* harmony import */ var _MenuPanels_CallPanel_CallPanel_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./MenuPanels/CallPanel/CallPanel.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanel.js\");\n/* harmony import */ var _MenuPanels_PlaylistPanel_PlaylistPanel_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./MenuPanels/PlaylistPanel/PlaylistPanel.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/PlaylistPanel.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass MenuDisplay extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor() {\r\n        super({\r\n            id: \"MenuDisplay\",\r\n        })\r\n        \r\n        this.chatPanel = new _MenuPanels_ChatPanel_ChatPanel_js__WEBPACK_IMPORTED_MODULE_1__.ChatPanel();\r\n        this.multiplayerPanel = new _MenuPanels_MultiplayerPanel_MultiplayerPanel_js__WEBPACK_IMPORTED_MODULE_2__.MultiplayerPanel();\r\n        this.callPanel = new _MenuPanels_CallPanel_CallPanel_js__WEBPACK_IMPORTED_MODULE_5__.CallPanel();\r\n        this.avatarPanel = new _MenuPanels_AvatarPanel_AvatarPanel_js__WEBPACK_IMPORTED_MODULE_3__.AvatarPanel();\r\n        this.videoPanel = new _MenuPanels_PlaylistPanel_PlaylistPanel_js__WEBPACK_IMPORTED_MODULE_6__.PlaylistPanel();\r\n        this.mapPanel = new _MenuPanels_MapPanel_MapPanel_js__WEBPACK_IMPORTED_MODULE_4__.MapPanel();\r\n\r\n        this.appendChildList([\r\n            this.chatPanel,\r\n            this.multiplayerPanel,\r\n            this.callPanel,\r\n            this.avatarPanel,\r\n            this.videoPanel,\r\n            this.mapPanel\r\n        ])\r\n    }\r\n\r\n    handleMenuPanelSelection(panel) {\r\n        this.closeAllPanels()\r\n        switch(panel) {\r\n            case \"chat\":\r\n                this.chatPanel.element.style.display = \"grid\";\r\n                break;\r\n            case \"multiplayer\":\r\n                this.multiplayerPanel.element.style.display = \"block\";\r\n                break;\r\n            case \"option\":\r\n                this.avatarPanel.element.style.display = \"block\";\r\n                break;\r\n            case \"calling\":\r\n                this.callPanel.element.style.display = \"block\";\r\n                break;\r\n            case \"playlist\":\r\n                this.videoPanel.element.style.display = \"block\";\r\n                break;\r\n            case \"map\":\r\n                this.mapPanel.element.style.display = \"flex\";\r\n                break;\r\n            \r\n        }\r\n    }\r\n\r\n    closeAllPanels() {\r\n        this.chatPanel.element.style.display = \"none\";\r\n        this.multiplayerPanel.element.style.display = \"none\";\r\n        this.callPanel.element.style.display = \"none\";\r\n        this.avatarPanel.element.style.display = \"none\";\r\n        this.videoPanel.element.style.display = \"none\";\r\n        this.mapPanel.element.style.display = \"none\";\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuDisplay.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanel.js":
/*!************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanel.js ***!
  \************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"AvatarPanel\": () => (/* binding */ AvatarPanel)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _AvatarPanelElements_AvatarSelectButton_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./AvatarPanelElements/AvatarSelectButton.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanelElements/AvatarSelectButton.js\");\n/* harmony import */ var _AvatarPanelElements_OptionElement_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./AvatarPanelElements/OptionElement.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanelElements/OptionElement.js\");\n\r\n\r\n\r\n\r\nconst defaultMapping = { walk: 1, idle: 2, run: 3, jump: 5, fall: 4 };\r\nconst defaultAnimations = '../../../resources/animations/defaultAvatar.glb';\r\n\r\nclass AvatarPanel extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            style: {\r\n                height: \"100%\",\r\n                display: \"none\"\r\n            }\r\n        })\r\n\r\n        this.appendChild(new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"Controls\",\r\n            style: {\r\n                width: \"100%\",\r\n                fontWeight: \"bold\",\r\n                fontSize: \"25px\",\r\n                textAlign: \"center\",\r\n                paddingTop: \"50px\"\r\n            }\r\n        }));\r\n\r\n        this.mobileControl = new _AvatarPanelElements_OptionElement_js__WEBPACK_IMPORTED_MODULE_2__.OptionElement(\"mobile\");\r\n        this.desktopControl = new _AvatarPanelElements_OptionElement_js__WEBPACK_IMPORTED_MODULE_2__.OptionElement(\"desktop\", true);\r\n\r\n        this.appendChildList([\r\n            this.mobileControl,\r\n            this.desktopControl\r\n        ])\r\n\r\n        this.appendChild(new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"Select an Avatar\",\r\n            style: {\r\n                width: \"100%\",\r\n                fontWeight: \"bold\",\r\n                fontSize: \"25px\",\r\n                textAlign: \"center\",\r\n                paddingTop: \"50px\"\r\n            }\r\n        }));\r\n\r\n        this.maleAvatarSelectButton = new _AvatarPanelElements_AvatarSelectButton_js__WEBPACK_IMPORTED_MODULE_1__.AvatarSelectButton(\r\n            \"male\",\r\n            '//asset.airclass.io/public/avatars/joe.glb',\r\n            '//asset.airclass.io/public/animations/joe@animation.glb',\r\n            { walk: 1, idle: 2, run: 3, jump: 4, fall: 5 }\r\n        );\r\n\r\n        this.femaleAvatarSelectButton = new _AvatarPanelElements_AvatarSelectButton_js__WEBPACK_IMPORTED_MODULE_1__.AvatarSelectButton(\r\n            \"female\",\r\n            '//asset.airclass.io/public/avatars/megan.glb',\r\n            '//asset.airclass.io/public/animations/megan@animation.glb',\r\n            { walk: 1, idle: 2, run: 3, jump: 4, fall: 5 }\r\n        );\r\n\r\n        this.appendChildList([\r\n            this.maleAvatarSelectButton,\r\n            this.femaleAvatarSelectButton\r\n        ])\r\n    } \r\n}\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanel.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanelElements/AvatarSelectButton.js":
/*!***************************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanelElements/AvatarSelectButton.js ***!
  \***************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"AvatarSelectButton\": () => (/* binding */ AvatarSelectButton)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass AvatarSelectButton extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(name, avatarUrl, animationUrl, animationMapping){\r\n        super({\r\n            innerHTML: name,\r\n            style: {\r\n                padding: \"10px\",\r\n                margin: \"10px\",\r\n                border: \"1px solid #e0e0e0\",\r\n                borderRadius: \"10px\",\r\n                background: \"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(235,235,235,1) 48%, rgba(250,250,250,1) 100%)\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                textAlign: \"center\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.5s ease\"\r\n            },\r\n            hover: {\r\n                background: \"#d8d8d8\"\r\n            }\r\n        })\r\n\r\n        this.element.addEventListener(\"click\", ()=>{\r\n            LOCAL_PLAYER.avatarController.changeAvatar(avatarUrl, animationUrl, animationMapping)\r\n        })\r\n    }\r\n}\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanelElements/AvatarSelectButton.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanelElements/OptionElement.js":
/*!**********************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanelElements/OptionElement.js ***!
  \**********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"OptionElement\": () => (/* binding */ OptionElement)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass OptionElement extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(option, checked = false){\r\n        super({\r\n            style: {\r\n                textAlign: \"center\"\r\n            }\r\n        })\r\n\r\n        this.labelOption = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            type: \"label\",\r\n            innerHTML: option\r\n        });\r\n\r\n        this.touchOption = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            type: \"input\",\r\n            id: \"option\",\r\n            style: {\r\n                verticalAlign: \"sub\"\r\n            },\r\n            onClick: () => {\r\n                if(\"mobile\" === option && this.touchOption.element.checked) {\r\n                    VIRTUAL_ENVIRONMENT.enableTouchControls(true);\r\n                } else {\r\n                    VIRTUAL_ENVIRONMENT.enableTouchControls(false);\r\n                }\r\n                LOCAL_PLAYER.setupControls();\r\n                VIRTUAL_ENVIRONMENT.UI_CONTROLLER.update();\r\n            }\r\n        });\r\n        this.touchOption.element.type = \"radio\";\r\n        this.touchOption.element.value = option;\r\n        this.touchOption.element.name = \"controls-group\";\r\n        this.touchOption.element.checked = checked;\r\n\r\n        this.appendChildList([\r\n            this.labelOption,\r\n            this.touchOption\r\n        ])\r\n    }\r\n}\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/AvatarPanel/AvatarPanelElements/OptionElement.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanel.js":
/*!********************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanel.js ***!
  \********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"CallPanel\": () => (/* binding */ CallPanel)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _CallPanelElements_CameraBox_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./CallPanelElements/CameraBox.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanelElements/CameraBox.js\");\n/* harmony import */ var _CallPanelElements_EndCallButton_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./CallPanelElements/EndCallButton.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanelElements/EndCallButton.js\");\n\r\n\r\n\r\n\r\nclass CallPanel extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            id: \"CallPanel\",\r\n            style: { \r\n                height: \"100%\",\r\n                display: \"none\",\r\n            }\r\n        })\r\n\r\n        this.element.className = \"call-panel\";\r\n\r\n        this.endCallButton = new _CallPanelElements_EndCallButton_js__WEBPACK_IMPORTED_MODULE_2__.EndCallButton();\r\n        this.camera = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            style: {\r\n                height: \"80%\",\r\n                overflow: 'scroll',\r\n                overflowX: 'hidden',\r\n            }\r\n        })\r\n\r\n        this.appendChildList([\r\n            this.endCallButton,\r\n            this.camera\r\n        ])\r\n    }\r\n\r\n    addCameraBox(peerId, stream, mute) {\r\n        let notify = document.getElementById('notify-' + peerId);\r\n        if(notify) notify.remove();\r\n        let cameraBox = document.getElementById(\"camera-screen-\" + peerId);\r\n        if(!cameraBox) {\r\n            this.myStream = stream;\r\n            this.camera.appendChild(new _CallPanelElements_CameraBox_js__WEBPACK_IMPORTED_MODULE_1__.CameraBox(peerId, stream, mute));\r\n        };\r\n    }\r\n\r\n    closeCameraBox(peerId) {\r\n        let cameraBox = document.getElementById(\"camera-screen-\" + peerId);\r\n        if(cameraBox){ \r\n            let cameraDisplay = document.getElementById(\"camera-display-\" + peerId);\r\n            \r\n            const stream = cameraDisplay.srcObject;\r\n            const tracks = stream.getTracks();\r\n\r\n            tracks.forEach(function(track) {\r\n                track.stop();\r\n            });\r\n\r\n            cameraDisplay.srcObject = null;\r\n\r\n            cameraBox.remove();\r\n        } \r\n    }\r\n\r\n    notifyCall(peerId) {\r\n        this.notify = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            id: 'notify-' + peerId,\r\n            style: {\r\n                background: 'rgb(56, 56, 56)',\r\n                color: 'white',\r\n                padding: '5px',\r\n                margin: '5px'\r\n            },\r\n            innerHTML: `Calling ${peerId}...`\r\n        })\r\n        this.camera.appendChild(this.notify);\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanel.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanelElements/CameraBox.js":
/*!**************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanelElements/CameraBox.js ***!
  \**************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"CameraBox\": () => (/* binding */ CameraBox)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass CameraBox extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(peerId, stream, mute = \"\"){\r\n        super({\r\n            id: \"camera-screen-\" + peerId,\r\n            style: {\r\n                textAlign: \"center\"\r\n            }\r\n        })\r\n\r\n        this.title = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            id: \"user-\" + peerId,\r\n            style: {\r\n                margin: \"0 80px\",\r\n                border: \"1px solid rgba(256, 256, 256, 0.3)\",\r\n                background: \"rgba(0, 0, 0, 0.2)\",\r\n                color: 'rgba(256, 256, 256, 0.8)'\r\n            },\r\n            innerHTML: peerId\r\n        });\r\n\r\n        this.screen = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            id: \"camera-display-\" + peerId,\r\n            type: \"video\",\r\n            style: {\r\n                height: '200px'\r\n            },\r\n            attributes: {\r\n                autoplay: 'autoplay',\r\n                srcObject: stream,\r\n                muted: mute\r\n            }\r\n        });\r\n\r\n        this.appendChildList([\r\n            this.title,\r\n            this.screen\r\n        ])\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanelElements/CameraBox.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanelElements/EndCallButton.js":
/*!******************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanelElements/EndCallButton.js ***!
  \******************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"EndCallButton\": () => (/* binding */ EndCallButton)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass EndCallButton extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            innerHTML: \"End Call\",\r\n            style: {\r\n                padding: \"10px\",\r\n                margin: \"10px\",\r\n                border: \"1px solid #e0e0e0\",\r\n                borderRadius: \"10px\",\r\n                background: \"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(235,235,235,1) 48%, rgba(250,250,250,1) 100%)\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                textAlign: \"center\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.5s ease\"\r\n            },\r\n            hover: {\r\n                background: \"#d8d8d8\"\r\n            }\r\n        })\r\n\r\n        this.element.addEventListener(\"click\", ()=>{\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuHeader.callPanelButton.toggleMenuHeader(\"call-panel\", \"none\");\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.handleMenuPanelSelection(\"multiplayer\");\r\n            VIRTUAL_ENVIRONMENT.remoteController.endcall();\r\n        })\r\n    }\r\n}\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/CallPanel/CallPanelElements/EndCallButton.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanel.js":
/*!********************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanel.js ***!
  \********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ChatPanel\": () => (/* binding */ ChatPanel)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _ChatPanelElements_ChatOutputDisplay_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ChatPanelElements/ChatOutputDisplay.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanelElements/ChatOutputDisplay.js\");\n/* harmony import */ var _ChatPanelElements_ChatFooter_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ChatPanelElements/ChatFooter.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanelElements/ChatFooter.js\");\n\r\n\r\n\r\n\r\n\r\nclass ChatPanel extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            id: \"ChatPanel\",\r\n            style: { \r\n                height: \"100%\",\r\n                display: \"none\",\r\n                gridTemplateRows: \"1fr 45px\",\r\n            }\r\n        })\r\n\r\n        this.chatOutputDisplay = new _ChatPanelElements_ChatOutputDisplay_js__WEBPACK_IMPORTED_MODULE_1__.ChatOutputDisplay();\r\n        this.chatFooter = new _ChatPanelElements_ChatFooter_js__WEBPACK_IMPORTED_MODULE_2__.ChatFooter();\r\n\r\n        this.appendChildList([\r\n            this.chatOutputDisplay,\r\n            this.chatFooter\r\n        ])\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanel.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanelElements/ChatFooter.js":
/*!***************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanelElements/ChatFooter.js ***!
  \***************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ChatFooter\": () => (/* binding */ ChatFooter)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass ChatFooter extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            id: \"ChatFooter\",\r\n            style: {\r\n                background: \"#c8c8c8\",\r\n                padding: \"5px\",\r\n            }\r\n        })\r\n\r\n        this.inputBar = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            id: \"InputBar\",\r\n            type: \"input\",\r\n            style: {\r\n                width: \"280px\"\r\n            }\r\n        });\r\n\r\n        this.inputBar.element.addEventListener(\"keypress\", event => {\r\n            if (event.key === \"Enter\") {\r\n                event.preventDefault();\r\n                this.handleSendMessage();\r\n            }\r\n        })\r\n\r\n        this.sendButton = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            id: \"SendButton\",\r\n            type: \"button\",\r\n            innerHTML: \"send\", \r\n            onClick: () => this.handleSendMessage()\r\n        });\r\n\r\n        this.appendChildList([\r\n            this.inputBar,\r\n            this.sendButton,\r\n        ])\r\n    }\r\n\r\n    handleSendMessage() {\r\n        const message = this.inputBar.element.value;\r\n        if(message !== \"\"){\r\n            this.inputBar.element.value = \"\";\r\n            VIRTUAL_ENVIRONMENT.remoteController.sendChatMessage(message);\r\n        }\r\n    }\r\n\r\n    handleCreateJoinRoom() {\r\n        const sessionId = this.inputBar.element.value;\r\n        if(sessionId !== \"\"){\r\n            this.inputBar.element.value = \"\";\r\n            VIRTUAL_ENVIRONMENT.remoteController.createRoom(sessionId);\r\n        }\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanelElements/ChatFooter.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanelElements/ChatOutputDisplay.js":
/*!**********************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanelElements/ChatOutputDisplay.js ***!
  \**********************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ChatOutputDisplay\": () => (/* binding */ ChatOutputDisplay)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass ChatOutputDisplay extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            id: \"ChatOutputDisplay\",\r\n            style: {\r\n                height: \"100%\",\r\n                background: \"white\",\r\n                overflow: 'scroll',\r\n                overflowX: 'hidden',\r\n                wordBreak: 'break-all',\r\n                fontSize: \"x-small\",\r\n            }\r\n        })\r\n    }\r\n\r\n    displayNewMessage(message) {\r\n        this.element.innerHTML += \"<br>\"+message;\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/ChatPanel/ChatPanelElements/ChatOutputDisplay.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MapPanel/MapElement.js":
/*!********************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MapPanel/MapElement.js ***!
  \********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MapElement\": () => (/* binding */ MapElement)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass MapElement extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(mapItem){\r\n        super({\r\n            id: 'src-' + mapItem.url,\r\n            style: {\r\n                border: \"1px solid black\",\r\n                display: \"flex\",\r\n                flexDirection: \"row\",\r\n                justifyContent: \"space-between\",\r\n                margin: \"5px\",\r\n                padding: \"5px\",\r\n                borderRadius: \"5px\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                background: \"#e0e0e0\"\r\n            }    \r\n        })\r\n\r\n        this.mapItem = mapItem;\r\n\r\n        this.nameDisplay = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: mapItem.name,\r\n            style: {\r\n                padding: \"3px\",\r\n                cursor: \"pointer\"\r\n            },\r\n            onClick: () => {\r\n                window.location.href = this.mapItem.url;\r\n            } \r\n        });\r\n\r\n        this.appendChildList([\r\n            this.nameDisplay\r\n        ])\r\n    } \r\n}\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MapPanel/MapElement.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MapPanel/MapPanel.js":
/*!******************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MapPanel/MapPanel.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MapPanel\": () => (/* binding */ MapPanel)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _MapElement_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./MapElement.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MapPanel/MapElement.js\");\n\r\n\r\n\r\nclass MapPanel extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            style: {\r\n                height: \"100%\",\r\n                display: \"none\",\r\n                flexDirection: \"column\",\r\n                justifyContent: \"center\",\r\n                alignItems: \"left\"\r\n            }\r\n        })\r\n\r\n        this.updated = false;\r\n\r\n        this.appendChild( new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"go back to map\",\r\n            style: {\r\n                padding: \"20px\",\r\n                margin: \"20px\",\r\n                border: \"1px solid #e0e0e0\",\r\n                borderRadius: \"10px\",\r\n                background: \"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(235,235,235,1) 48%, rgba(250,250,250,1) 100%)\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                textAlign: \"center\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.5s ease\"\r\n            },\r\n            hover: {\r\n                background: \"#d8d8d8\"\r\n            },\r\n            onClick: ()=>{\r\n                window.location.href = \"https://tong-the.netlify.app/\"\r\n            }\r\n        }))\r\n\r\n        \r\n    }\r\n\r\n    update() {\r\n        if(VIRTUAL_ENVIRONMENT.maps && !this.updated) {\r\n            let me = this;\r\n            VIRTUAL_ENVIRONMENT.maps.map(item => {\r\n                me.appendChild(new _MapElement_js__WEBPACK_IMPORTED_MODULE_1__.MapElement(item));\r\n            })\r\n            this.updated = true;\r\n        }\r\n    }\r\n}\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MapPanel/MapPanel.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanel.js":
/*!**********************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanel.js ***!
  \**********************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MultiplayerPanel\": () => (/* binding */ MultiplayerPanel)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _MultiplayerPanelElements_GoLiveDisplay_GoLiveDisplay_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplay.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplay.js\");\n/* harmony import */ var _MultiplayerPanelElements_ConnectionsManagementDisplay_ConnectionsManagementDisplay_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionsManagementDisplay.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionsManagementDisplay.js\");\n\r\n\r\n\r\n\r\n\r\nclass MultiplayerPanel extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            id: \"MultiplayerPanel\",\r\n            style: {\r\n                display: \"none\",\r\n                height: \"100%\"\r\n            }\r\n        })\r\n\r\n        this.goLiveDisplay = new _MultiplayerPanelElements_GoLiveDisplay_GoLiveDisplay_js__WEBPACK_IMPORTED_MODULE_1__.GoLiveDisplay(()=>this.handleGoLive());\r\n        this.connectionsManagementDisplay = new _MultiplayerPanelElements_ConnectionsManagementDisplay_ConnectionsManagementDisplay_js__WEBPACK_IMPORTED_MODULE_2__.ConnectionsManagementDisplay();\r\n\r\n        this.appendChildList([\r\n            this.goLiveDisplay,\r\n            this.connectionsManagementDisplay\r\n        ])\r\n    }\r\n\r\n    handleGoLive() {\r\n        const inputValue = this.goLiveDisplay.inputs.peerIdInput.element.value\r\n        if(inputValue !== \"\") {\r\n            VIRTUAL_ENVIRONMENT.remoteController.createPeerWithId(inputValue);\r\n            LOCAL_PLAYER.avatarController.reloadAvatar();\r\n        }\r\n    }\r\n\r\n    update() {\r\n        if(typeof VIRTUAL_ENVIRONMENT.remoteController.peer !== \"undefined\") {\r\n            this.goLiveDisplay.element.style.display = \"none\";\r\n            this.connectionsManagementDisplay.element.style.display = \"block\";\r\n        } else {\r\n            this.goLiveDisplay.element.style.display = \"flex\";\r\n            this.connectionsManagementDisplay.element.style.display = \"none\";\r\n        }\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanel.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/ConnectionDisplay.js":
/*!**********************************************************************************************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/ConnectionDisplay.js ***!
  \**********************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ConnectionDisplay\": () => (/* binding */ ConnectionDisplay)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _util_localProxy_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../../../../../../../../util/localProxy.js */ \"./src/util/localProxy.js\");\n/* harmony import */ var _ConnectionOptions_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ConnectionOptions.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/ConnectionOptions.js\");\n\r\n\r\n\r\n\r\n\r\nclass ConnectionDisplay extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(connection){\r\n        super({\r\n            id: connection.peer,\r\n            style: {\r\n                border: \"1px solid black\",\r\n                display: \"flex\",\r\n                flexDirection: \"row\",\r\n                justifyContent: \"space-between\",\r\n                margin: \"5px\",\r\n                padding: \"5px\",\r\n                borderRadius: \"5px\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                background: \"#e0e0e0\"\r\n            }    \r\n        })\r\n\r\n        this.connection = connection;\r\n\r\n        // remember the name for closing\r\n        this.peer = connection.peer\r\n\r\n        this.peerIdDisplay = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: connection.peer,\r\n            style: {\r\n                padding: \"3px\"\r\n            }\r\n        })\r\n\r\n        this.options = new _ConnectionOptions_js__WEBPACK_IMPORTED_MODULE_2__.ConnectionOptions(\r\n            ()=>this.handleConnectionClose(),\r\n            _util_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList.includes(this.peer),\r\n            ()=>this.handleClickOnStar(),\r\n            ()=>this.handleClickOnCall()\r\n        );\r\n\r\n        this.appendChildList([\r\n            this.peerIdDisplay,\r\n            this.options\r\n        ])\r\n    }\r\n\r\n    handleClickOnStar() {\r\n        if(_util_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList.includes(this.peer)) {\r\n            this.options.setStar(\"\")\r\n            let tempList = _util_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList;\r\n            const index = tempList.indexOf(this.peer);\r\n            tempList.splice(index, 1);\r\n            _util_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList = tempList;\r\n            if(typeof this.connection === \"undefined\") {\r\n                this.element.remove()\r\n            }\r\n        } else {\r\n            this.options.setStar(\"star\")\r\n            let tempList = _util_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList\r\n            tempList.push(this.peer);\r\n            _util_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList = tempList\r\n        }\r\n    }\r\n\r\n    handleConnectionClose() {\r\n        VIRTUAL_ENVIRONMENT.remoteController.disconnectPeer(this.peer);\r\n        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuHeader.callPanelButton.toggleMenuHeader(\"call-panel\", \"none\");\r\n        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.handleMenuPanelSelection(\"multiplayer\");\r\n    }\r\n\r\n    handleClickOnCall() {\r\n        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuHeader.callPanelButton.toggleMenuHeader(\"call-panel\", \"block\");\r\n        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.handleMenuPanelSelection(\"calling\");\r\n        VIRTUAL_ENVIRONMENT.remoteController.call(this.peer);\r\n    }\r\n\r\n    update() {\r\n        if(typeof this.connection !== \"undefined\"){\r\n            if(this.connection.open){\r\n                this.element.style.border = \"1px solid green\";\r\n                this.element.style.background = \"#f0fff0\";\r\n            } else {\r\n                this.element.style.border = \"1px solid yellow\";\r\n                this.element.style.background = \"#fffff0\";\r\n            }\r\n        } else {\r\n            this.element.style.border = \"1px solid red\";\r\n            this.element.style.background = \"#fff0f0\";\r\n        }\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/ConnectionDisplay.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/ConnectionOptions.js":
/*!**********************************************************************************************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/ConnectionOptions.js ***!
  \**********************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ConnectionOptions\": () => (/* binding */ ConnectionOptions)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass ConnectionOptions extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(onClose, starState, onStar, onCall) {\r\n        super({\r\n            style: {\r\n                display: \"flex\",\r\n                flexDirection: \"row\"\r\n            }\r\n        })\r\n\r\n        this.closeConnection = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"&#9746;\",\r\n            style: {\r\n                padding: \"3px\",\r\n                cursor: \"pointer\",\r\n                color: \"black\"\r\n            },\r\n            hover: {\r\n                color: \"#383838\"\r\n            },\r\n            onClick: onClose,\r\n        })\r\n\r\n        this.starConnection = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: starState ? \"&#9733;\" : \"&#9734;\",\r\n            style: {\r\n                padding: \"3px\",\r\n                cursor: \"pointer\",\r\n                color: \"black\"\r\n            },\r\n            hover: {\r\n                color: \"#383838\"\r\n            },\r\n            onClick: onStar,\r\n        })\r\n\r\n        this.call = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"&#9742;\",\r\n            style: {\r\n                padding: \"3px\",\r\n                cursor: \"pointer\",\r\n                color: \"black\"\r\n            },\r\n            hover: {\r\n                color: \"#383838\"\r\n            },\r\n            onClick: onCall,\r\n        })\r\n\r\n        this.appendChildList([\r\n            this.call,\r\n            this.starConnection,\r\n            this.closeConnection\r\n        ])\r\n    }\r\n\r\n    setStar(state) {\r\n        if(state === \"star\"){\r\n            this.starConnection.element.innerHTML = \"&#9733;\";\r\n        } else {\r\n            this.starConnection.element.innerHTML = \"&#9734;\";\r\n        }\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/ConnectionOptions.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/NewConnectionDisplay.js":
/*!*************************************************************************************************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/NewConnectionDisplay.js ***!
  \*************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"NewConnectionDisplay\": () => (/* binding */ NewConnectionDisplay)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass NewConnectionDisplay extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            id: \"NewConnectionDisplay\",\r\n            style: {\r\n                padding: \"10px\",\r\n                margin: \"10px\",\r\n                border: \"1px solid #e0e0e0\",\r\n                borderRadius: \"10px\",\r\n                background: \"rgb(255,255,255)\",\r\n                background: \"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(235,235,235,1) 48%, rgba(250,250,250,1) 100%)\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                textAlign: \"center\"\r\n            }\r\n        })\r\n\r\n        this.title = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"Connect to peers\",\r\n            style: {\r\n                fontWeight: \"bold\",\r\n                fontSize: \"25px\",\r\n                \r\n            }\r\n        });\r\n\r\n        this.remoteIdInput = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            type: \"input\",\r\n        });\r\n        \r\n        this.connectToPeer = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            type: \"button\",\r\n            innerHTML: \"connect\",\r\n            onClick: () => {\r\n                VIRTUAL_ENVIRONMENT.remoteController.connectToPeer(this.remoteIdInput.element.value);\r\n                this.remoteIdInput.element.value = \"\";\r\n            }\r\n        })\r\n\r\n        this.info = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"Enter a peerId to attempt connection.\"\r\n        })\r\n\r\n        this.appendChildList([\r\n            this.title,\r\n            this.remoteIdInput,\r\n            this.connectToPeer,\r\n            this.info\r\n        ]);\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/NewConnectionDisplay.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionsManagementDisplay.js":
/*!****************************************************************************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionsManagementDisplay.js ***!
  \****************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ConnectionsManagementDisplay\": () => (/* binding */ ConnectionsManagementDisplay)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _util_localProxy_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../../../../../../../util/localProxy.js */ \"./src/util/localProxy.js\");\n/* harmony import */ var _ConnectionManagementElements_ConnectionDisplay_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ConnectionManagementElements/ConnectionDisplay.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/ConnectionDisplay.js\");\n/* harmony import */ var _ConnectionManagementElements_NewConnectionDisplay_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ConnectionManagementElements/NewConnectionDisplay.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionManagementElements/NewConnectionDisplay.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nclass ConnectionsManagementDisplay extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor() {\r\n        super({\r\n            id: \"ConnectionManagementPanel\",\r\n            style: {\r\n                display: \"none\",\r\n            }\r\n        })\r\n\r\n        this.connectionDisplayList = []\r\n\r\n        this.newConnectionDisplay = new _ConnectionManagementElements_NewConnectionDisplay_js__WEBPACK_IMPORTED_MODULE_3__.NewConnectionDisplay\r\n        this.appendChild(this.newConnectionDisplay);\r\n        \r\n        this.appendChild(new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"Connection List\",\r\n            style: {\r\n                width: \"100%\",\r\n                fontWeight: \"bold\",\r\n                fontSize: \"25px\",\r\n                textAlign: \"center\",\r\n                marginTop: \"50px\"\r\n            }\r\n        }));\r\n        \r\n        this.appendChild(new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"Activate the &#9733; icon to save a connection.\",\r\n            style: {\r\n                fontSize: \"xx-small\",\r\n                width: \"100%\",\r\n                textAlign: \"center\"\r\n            }\r\n        }))\r\n\r\n\r\n    }\r\n\r\n    handleNewConnection(connection) {\r\n        this.connectionDisplayList.forEach(connectionDisplay => {\r\n            if(connectionDisplay.peer === connection.peer){\r\n                connectionDisplay.element.remove()\r\n            }\r\n        })\r\n        const newConnectionDisplay = new _ConnectionManagementElements_ConnectionDisplay_js__WEBPACK_IMPORTED_MODULE_2__.ConnectionDisplay(connection);\r\n        this.connectionDisplayList.push(newConnectionDisplay);\r\n        this.appendChild(newConnectionDisplay);\r\n    }\r\n\r\n    handleConnectionClose(peerId) {\r\n        if(_util_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList.includes(peerId)) {\r\n            // if is in friend list \r\n            this.connectionDisplayList.forEach((display, index) => {\r\n                if(display.element.id === peerId){\r\n                    delete this.connectionDisplayList[index].connection;\r\n                }\r\n            })\r\n        } else {\r\n            //if is not\r\n            const childList = this.element.childNodes\r\n            for(let i=0; i<childList.length; i++) {\r\n                if(childList[i].id === peerId) {\r\n                    this.element.childNodes[i].remove();\r\n                }\r\n            }\r\n            this.connectionDisplayList.forEach((display, index) => {\r\n                if(display.element.id === peerId){\r\n                    this.connectionDisplayList.splice(index, 1);\r\n                }\r\n            })\r\n        }\r\n       \r\n    }\r\n\r\n    update(){\r\n        this.connectionDisplayList.forEach(connectionDisplay => {\r\n            connectionDisplay.update();\r\n        })\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/ConnectionsManagementDisplay/ConnectionsManagementDisplay.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplay.js":
/*!**********************************************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplay.js ***!
  \**********************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"GoLiveDisplay\": () => (/* binding */ GoLiveDisplay)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _GoLiveDisplayElements_GoLiveButton_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./GoLiveDisplayElements/GoLiveButton.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplayElements/GoLiveButton.js\");\n/* harmony import */ var _GoLiveDisplayElements_PeerIdInput_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./GoLiveDisplayElements/PeerIdInput.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplayElements/PeerIdInput.js\");\n\r\n\r\n\r\n\r\n\r\nclass GoLiveDisplay extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(onClick) {\r\n        super({\r\n            id: \"GoLiveDisplay\",\r\n            style: {\r\n                display: \"flex\",\r\n                flexDirection: \"column\",\r\n                justifyContent: \"center\",\r\n                alignItems: \"center\",\r\n                height: \"100%\"\r\n            }\r\n        })\r\n        \r\n        this.inputs = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({})\r\n\r\n        this.inputs.peerIdInput = new _GoLiveDisplayElements_PeerIdInput_js__WEBPACK_IMPORTED_MODULE_2__.PeerIdInput()\r\n        this.inputs.appendChildList([\r\n            this.inputs.peerIdInput,\r\n            new _GoLiveDisplayElements_GoLiveButton_js__WEBPACK_IMPORTED_MODULE_1__.GoLiveButton(onClick)\r\n        ])\r\n        \r\n        this.title = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"enter a peer id\",\r\n            style: {\r\n                width: \"100%\",\r\n                fontWeight: \"bold\",\r\n                fontSize: \"25px\",\r\n                textAlign: \"center\",\r\n                marginTop: \"50px\"\r\n            }\r\n        });\r\n        \r\n        this.info = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            style: {\r\n                padding: \"10px\",\r\n                fontSize: \"xx-small\",\r\n                textAlign: \"justify\",\r\n                width: \"250px\"\r\n            },\r\n            innerHTML: \"This feature is still experimental. Please join our <a href='https://discord.gg/w6CzHy35E2'>Discord</a> if you have any difficulty or want to suggest an improvement.\"\r\n        })\r\n\r\n        this.appendChildList([\r\n            this.title,\r\n            this.inputs,\r\n            this.info\r\n        ]);\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplay.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplayElements/GoLiveButton.js":
/*!*******************************************************************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplayElements/GoLiveButton.js ***!
  \*******************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"GoLiveButton\": () => (/* binding */ GoLiveButton)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass GoLiveButton extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(onClick) {\r\n        super({\r\n            id: \"GoLiveButton\",\r\n            type: \"button\",\r\n            innerHTML: \"Go live\",\r\n            onClick: onClick\r\n        })\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplayElements/GoLiveButton.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplayElements/PeerIdInput.js":
/*!******************************************************************************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplayElements/PeerIdInput.js ***!
  \******************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"PeerIdInput\": () => (/* binding */ PeerIdInput)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass PeerIdInput extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement { \r\n    constructor() {\r\n        super({\r\n            id: \"PeerIdInput\",\r\n            type: \"input\"\r\n        })\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/MultiplayerPanel/MultiplayerPanelElements/GoLiveDisplay/GoLiveDisplayElements/PeerIdInput.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/Player.js":
/*!*********************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/Player.js ***!
  \*********************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"Player\": () => (/* binding */ Player)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass Player extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(onPlay, onPause, onRewind) {\r\n        super({\r\n            style: {\r\n                display: \"flex\",\r\n                flexDirection: \"row\"\r\n            }\r\n        })\r\n\r\n        this.play = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"&#9654;\",\r\n            style: {\r\n                padding: \"3px\",\r\n                cursor: \"pointer\",\r\n                display: \"block\"\r\n            },\r\n            onClick: onPlay,\r\n        })\r\n        this.play.element.className = \"play-option\";\r\n\r\n        this.pause = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"&#9208;\",\r\n            style: {\r\n                padding: \"3px\",\r\n                cursor: \"pointer\",\r\n                display: \"none\"\r\n            },\r\n            onClick: onPause,\r\n        })\r\n        this.pause.element.className = \"pause-option\";\r\n\r\n        this.rewind = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"&#9194;\",\r\n            style: {\r\n                padding: \"3px\",\r\n                cursor: \"pointer\"\r\n            },\r\n            onClick: onRewind,\r\n        })\r\n        this.rewind.element.className = \"rewind-option\";\r\n\r\n        this.appendChildList([\r\n            this.play,\r\n            this.pause,\r\n            this.rewind\r\n        ])\r\n    }\r\n\r\n    setState(state) {\r\n        if(this.play) {\r\n            if(state === \"play\"){\r\n                this.play.element.style.display = 'none';\r\n                this.pause.element.style.display = 'block';\r\n                this.toggle('block', 'none');\r\n            } else {\r\n                this.pause.element.style.display = 'none';\r\n                this.play.element.style.display = 'block';\r\n            }\r\n        }\r\n    }\r\n\r\n    toggle(playState, pauseState) {\r\n        let me = this.play.element;\r\n        let playOptions = document.querySelectorAll(\".play-option\");\r\n        let pauseOptions = document.querySelectorAll(\".pause-option\");\r\n        playOptions.forEach((item, index) => {\r\n            if(item !== me) {\r\n                item.style.display = playState\r\n                pauseOptions[index].style.display = pauseState;\r\n            }\r\n        })\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/Player.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/PlaylistPanel.js":
/*!****************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/PlaylistPanel.js ***!
  \****************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"PlaylistPanel\": () => (/* binding */ PlaylistPanel)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _VideoElement_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./VideoElement.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/VideoElement.js\");\n\r\n\r\n\r\nclass PlaylistPanel extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(){\r\n        super({\r\n            style: {\r\n                height: \"100%\",\r\n                display: \"none\"\r\n            }\r\n        })\r\n\r\n        this.updated = false;\r\n    } \r\n\r\n    addPlayList() {\r\n        if(!VIRTUAL_ENVIRONMENT.playlist || VIRTUAL_ENVIRONMENT.playlist.length == 0) return;\r\n        VIRTUAL_ENVIRONMENT.playlist.forEach((video) => {\r\n            let item = new _VideoElement_js__WEBPACK_IMPORTED_MODULE_1__.VideoElement(video);\r\n            this.appendChild(item);\r\n        });\r\n    }\r\n\r\n    update() {\r\n        if(!this.updated && VIRTUAL_ENVIRONMENT.playlist) {\r\n            this.addPlayList();\r\n            this.updated = true;\r\n        }\r\n    }\r\n}\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/PlaylistPanel.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/VideoElement.js":
/*!***************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/VideoElement.js ***!
  \***************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"VideoElement\": () => (/* binding */ VideoElement)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _Player_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Player.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/Player.js\");\n\r\n\r\n\r\nclass VideoElement extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(videoItem){\r\n        super({\r\n            id: 'src-' + videoItem.url,\r\n            style: {\r\n                border: \"1px solid black\",\r\n                display: \"flex\",\r\n                flexDirection: \"row\",\r\n                justifyContent: \"space-between\",\r\n                margin: \"5px\",\r\n                padding: \"5px\",\r\n                borderRadius: \"5px\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                background: \"#e0e0e0\"\r\n            }    \r\n        })\r\n\r\n        this.videoItem = videoItem;\r\n\r\n        this.nameDisplay = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: videoItem.name,\r\n            style: {\r\n                padding: \"3px\"\r\n            }\r\n        });\r\n\r\n        this.player = new _Player_js__WEBPACK_IMPORTED_MODULE_1__.Player(\r\n            ()=>this.play(),\r\n            ()=>this.pause(),\r\n            ()=>this.rewind()\r\n        );\r\n\r\n        this.appendChildList([\r\n            this.nameDisplay,\r\n            this.player\r\n        ])\r\n    } \r\n\r\n    play() {\r\n        VIRTUAL_ENVIRONMENT.playVideo(this.videoItem.url);\r\n        this.player.setState(\"play\");\r\n    }\r\n\r\n    pause() {\r\n        VIRTUAL_ENVIRONMENT.pauseVideo(this.videoItem.url);\r\n        this.player.setState(\"pause\");\r\n    }\r\n\r\n    rewind() {\r\n        VIRTUAL_ENVIRONMENT.rewindVideo(this.videoItem.url);\r\n    }\r\n}\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuDisplay/MenuPanels/PlaylistPanel/VideoElement.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuFooter/MenuFooter.js":
/*!***********************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuFooter/MenuFooter.js ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MenuFooter\": () => (/* binding */ MenuFooter)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass MenuFooter extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor() {\r\n        super({\r\n            id: \"MenuFooter\",\r\n            style: {\r\n                background: \"#383838\",\r\n                textAlign: \"center\",\r\n                height: \"30px\",\r\n                transition: \"all 0.5s ease\",\r\n                overflow: \"hidden\"\r\n            },\r\n            \r\n        })\r\n\r\n        this.textInfo = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"Not Connected\",\r\n            style: {\r\n                color: \"white\"\r\n            }\r\n        })\r\n\r\n        this.disconnectButton = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: \"Disconnect\",\r\n            style: {\r\n                padding: \"20px\",\r\n                margin: \"20px\",\r\n                border: \"1px solid #e0e0e0\",\r\n                borderRadius: \"10px\",\r\n                background: \"radial-gradient(circle, rgba(256,235,235,1) 0%, rgba(256,215,215,1) 48%, rgba(256,230,230,1) 100%)\",\r\n                boxShadow: \"0 2px 2px #ff8888\",\r\n                textAlign: \"center\",\r\n                cursor: \"pointer\"\r\n            },\r\n            hover: {\r\n                background: \"#ffc8c8\"\r\n            },\r\n            onClick: ()=>{\r\n                VIRTUAL_ENVIRONMENT.remoteController.destroy();\r\n                delete VIRTUAL_ENVIRONMENT.remoteController.peer;\r\n                VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.multiplayerPanel.update();\r\n                VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuHeader.callPanelButton.toggleMenuHeader(\"call-panel\", \"none\");\r\n                VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.handleMenuPanelSelection(\"multiplayer\");\r\n            }\r\n        })\r\n\r\n        this.appendChildList([\r\n            this.textInfo,\r\n            this.disconnectButton\r\n        ])\r\n\r\n        this.element.addEventListener(\"mouseenter\", ()=>{\r\n            if(typeof VIRTUAL_ENVIRONMENT.remoteController.peer !== \"undefined\"){\r\n                this.element.style.height = \"150px\";\r\n            }\r\n        })\r\n\r\n        this.element.addEventListener(\"mouseleave\", ()=>{\r\n            this.element.style.height = \"30px\";\r\n        })\r\n    }\r\n\r\n    update() {\r\n        if(typeof VIRTUAL_ENVIRONMENT.remoteController.peer !== \"undefined\"){\r\n            const peerID = VIRTUAL_ENVIRONMENT.remoteController.peer.id;\r\n            if(peerID && peerID !== this.element.innerHTML) {\r\n                this.textInfo.element.innerHTML = \"Connected as: \" + peerID;\r\n            }\r\n        } else {\r\n            this.textInfo.element.innerHTML = \"Not Connected\";\r\n        }\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuFooter/MenuFooter.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuHeader/MenuHeader.js":
/*!***********************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuHeader/MenuHeader.js ***!
  \***********************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MenuHeader\": () => (/* binding */ MenuHeader)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _MenuHeaderElements_MenuHeaderButtons_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./MenuHeaderElements/MenuHeaderButtons.js */ \"./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuHeader/MenuHeaderElements/MenuHeaderButtons.js\");\n\r\n\r\n\r\n\r\nclass MenuHeader extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor() {\r\n        super({\r\n            id: \"MenuHeader\",\r\n            style: {\r\n                display: \"flex\",\r\n                flexDirection: \"row\",\r\n                boxShadow: \"0 4px 4px #888888\",\r\n                zIndex: \"100\",\r\n            }\r\n        })\r\n        \r\n        this.chatPanelButton = new _MenuHeaderElements_MenuHeaderButtons_js__WEBPACK_IMPORTED_MODULE_1__.MenuHeaderButtons(\"chat\");\r\n        this.multiplayerPanelButton = new _MenuHeaderElements_MenuHeaderButtons_js__WEBPACK_IMPORTED_MODULE_1__.MenuHeaderButtons(\"multiplayer\");\r\n        this.avatarPanelButton = new _MenuHeaderElements_MenuHeaderButtons_js__WEBPACK_IMPORTED_MODULE_1__.MenuHeaderButtons(\"option\");\r\n        this.videoPanelButton = new _MenuHeaderElements_MenuHeaderButtons_js__WEBPACK_IMPORTED_MODULE_1__.MenuHeaderButtons(\"playlist\");\r\n        this.callPanelButton = new _MenuHeaderElements_MenuHeaderButtons_js__WEBPACK_IMPORTED_MODULE_1__.MenuHeaderButtons(\"calling\", \"call-panel\", \"none\");\r\n        this.mapPanelButton = new _MenuHeaderElements_MenuHeaderButtons_js__WEBPACK_IMPORTED_MODULE_1__.MenuHeaderButtons(\"map\");\r\n\r\n        this.appendChildList([\r\n            this.chatPanelButton,\r\n            this.multiplayerPanelButton,\r\n            this.callPanelButton,\r\n            this.avatarPanelButton,\r\n            this.videoPanelButton,\r\n            this.mapPanelButton\r\n        ])\r\n\r\n    }\r\n\r\n    handleMenuHeaderSelection(panel) {\r\n        this.closeAllHeaders()\r\n        switch(panel) {\r\n            case \"chat\":\r\n                this.chatPanelButton.element.style.background = \"#c8c8c8\";\r\n                this.chatPanelButton.options.style.background = \"#c8c8c8\";\r\n                break;\r\n            case \"multiplayer\":\r\n                this.multiplayerPanelButton.element.style.background = \"#c8c8c8\";\r\n                this.multiplayerPanelButton.options.style.background = \"#c8c8c8\";\r\n                break;\r\n            case \"option\":\r\n                this.avatarPanelButton.element.style.background = \"#c8c8c8\";\r\n                this.avatarPanelButton.options.style.background = \"#c8c8c8\";\r\n                break;\r\n            case \"playlist\":\r\n                this.videoPanelButton.element.style.background = \"#c8c8c8\";\r\n                this.videoPanelButton.options.style.background = \"#c8c8c8\";\r\n            case \"calling\":\r\n                this.callPanelButton.element.style.background = \"#c8c8c8\";\r\n                this.callPanelButton.options.style.background = \"#c8c8c8\";\r\n                break;\r\n            case \"map\":\r\n                this.mapPanelButton.element.style.background = \"#c8c8c8\";\r\n                this.mapPanelButton.options.style.background = \"#c8c8c8\";\r\n        }\r\n    }\r\n\r\n    closeAllHeaders() {\r\n        this.chatPanelButton.element.style.background = \"#e0e0e0\";\r\n        this.chatPanelButton.options.style.background = \"#e0e0e0\";\r\n        this.multiplayerPanelButton.element.style.background = \"#e0e0e0\";\r\n        this.multiplayerPanelButton.options.style.background = \"#e0e0e0\";\r\n        this.avatarPanelButton.element.style.background = \"#e0e0e0\";\r\n        this.avatarPanelButton.options.style.background = \"#e0e0e0\";\r\n        this.videoPanelButton.element.style.background = \"#e0e0e0\";\r\n        this.videoPanelButton.options.style.background = \"#e0e0e0\";\r\n        this.callPanelButton.element.style.background = \"#e0e0e0\";\r\n        this.callPanelButton.options.style.background = \"#e0e0e0\";\r\n        this.mapPanelButton.element.style.background = \"#e0e0e0\";\r\n        this.mapPanelButton.options.style.background = \"#e0e0e0\";\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuHeader/MenuHeader.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuHeader/MenuHeaderElements/MenuHeaderButtons.js":
/*!*************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuHeader/MenuHeaderElements/MenuHeaderButtons.js ***!
  \*************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MenuHeaderButtons\": () => (/* binding */ MenuHeaderButtons)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass MenuHeaderButtons extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(text, className = null, display = null) {\r\n        super({\r\n            style: {\r\n                color: \"back\",\r\n                cursor: \"pointer\",\r\n                padding: \"5px\",\r\n                fontWeight: \"bold\",\r\n                width: \"100%\",\r\n                textAlign: \"center\",\r\n                transition: \"all 0.5s ease\"\r\n            },\r\n            hover: {\r\n                background: \"#d8d8d8\",\r\n                color: \"#3a3a3a\",\r\n            },\r\n            innerHTML: text\r\n        })\r\n\r\n        if(className) this.element.className = className;\r\n        if(display) this.element.style.display = display;\r\n\r\n        this.element.addEventListener(\"click\", () => {\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.handleMenuPanelSelection(text)\r\n        })\r\n    }\r\n\r\n    toggleMenuHeader(className, display) {\r\n        for (let menuHeader of document.getElementsByClassName(className)) \r\n            menuHeader.style.display = display;\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/BlockerScreen/Menu/MenuElements/MenuHeader/MenuHeaderElements/MenuHeaderButtons.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/Common/AlertBox.js":
/*!*********************************************************!*\
  !*** ./src/UserInterface/UiElements/Common/AlertBox.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"AlertBox\": () => (/* binding */ AlertBox)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass AlertBox extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(title, message, accept = {title: \"YES\", icon: \"\"}, cancel = {title: \"CANCEL\", icon: \"\"}, onAccept = null){\r\n        super({\r\n            id: \"AlertBox\",\r\n            style: { \r\n                position: 'absolute',\r\n                padding: '2px',\r\n                top: '30%',\r\n                left: 'calc(50% - 150px)',\r\n                width: '300px',\r\n                textAlign: 'center',\r\n                background: \"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(235,235,235,1) 48%, rgba(250,250,250,1) 100%)\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                border: \"1px solid #e0e0e0\",\r\n                zIndex: 100,\r\n                borderRadius: '10px'\r\n            }\r\n        })\r\n\r\n        this.title = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: title,\r\n            style: {\r\n                background: \"#d8d8d8\"\r\n            }\r\n        });\r\n\r\n        this.content = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            innerHTML: message\r\n        });\r\n\r\n        this.acceptButton = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            type: \"button\",\r\n            innerHTML: accept.title + \" \" + accept.icon,\r\n            style: {\r\n                padding: \"10px\",\r\n                margin: \"10px\",\r\n                border: \"1px solid #e0e0e0\",\r\n                borderRadius: \"10px\",\r\n                background: \"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(235,235,235,1) 48%, rgba(250,250,250,1) 100%)\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                textAlign: \"center\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.5s ease\",\r\n                width: '100px'\r\n            },\r\n            onClick: () => {\r\n                this.element.remove();\r\n                if(onAccept) onAccept();\r\n            }\r\n        })\r\n\r\n        this.cancelButton = new _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement({\r\n            type: \"button\",\r\n            innerHTML: cancel.title + \" \" + cancel.icon,\r\n            style: {\r\n                padding: \"10px\",\r\n                margin: \"10px\",\r\n                border: \"1px solid #e0e0e0\",\r\n                borderRadius: \"10px\",\r\n                background: \"radial-gradient(circle, rgba(255,255,255,1) 0%, rgba(235,235,235,1) 48%, rgba(250,250,250,1) 100%)\",\r\n                boxShadow: \"0 2px 2px #888888\",\r\n                textAlign: \"center\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.5s ease\",\r\n                width: '100px'\r\n            },\r\n            onClick: () => {\r\n                this.element.remove();\r\n            }\r\n        })\r\n\r\n        this.appendChildList([\r\n            this.title,\r\n            this.content,\r\n            this.acceptButton,\r\n            this.cancelButton\r\n        ])\r\n\r\n        document.body.appendChild(this.element);\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/Common/AlertBox.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/Common/Joystick.js":
/*!*********************************************************!*\
  !*** ./src/UserInterface/UiElements/Common/Joystick.js ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"Joystick\": () => (/* binding */ Joystick)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n\r\n\r\n\r\nclass Joystick extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(player){\r\n        super({\r\n            id: \"joystick\",\r\n            style: {\r\n                pointerEvents: \"auto\",\r\n                display: \"none\",\r\n                position: \"absolute\",\r\n                bottom: \"30px\",\r\n                left: \"20px\",\r\n                backgroundColor: \"transparent\",\r\n                width: \"120px\",\r\n                height: \"120px\",\r\n                zIndex: \"12\",\r\n                touchAction: \"manipulation\"\r\n            }\r\n        })\r\n\r\n        this.player = player;\r\n\r\n        this.params = {\r\n            fwdValue : 0,\r\n            bkdValue : 0,\r\n            rgtValue : 0,\r\n            lftValue : 0,\r\n            tempVector : new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_1__.Vector3(),\r\n            upVector : new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_1__.Vector3(0, 1, 0)\r\n        }\r\n\r\n        document.body.appendChild(this.element);\r\n    }\r\n\r\n    init() {\r\n        const options = {\r\n            zone: this.element,\r\n            color: \"gray\",\r\n            size: 120,\r\n            multitouch: true,\r\n            maxNumberOfNipples: 2,\r\n            mode: 'static',\r\n            restJoystick: true,\r\n            shape: 'circle',\r\n            // position: { top: 20, left: 20 },\r\n            position: { top: '60px', left: '60px' },\r\n            dynamicPage: true,\r\n        }\r\n       \r\n       \r\n        this.joyManager = nipplejs.create(options);\r\n\r\n        let me = this;\r\n      \r\n        this.joyManager['0'].on('move', function (evt, data) {\r\n            const forward = data.vector.y\r\n            const turn = data.vector.x\r\n    \r\n            if (forward > 0) {\r\n                me.params.bkdValue = me.player.speedFactor\r\n                me.params.fwdValue = 0\r\n                \r\n            } else if (forward < 0) {\r\n                me.params.fwdValue = me.player.speedFactor\r\n                me.params.bkdValue = 0\r\n            }\r\n    \r\n            if (turn > 0) {\r\n                me.params.lftValue = me.player.speedFactor\r\n                me.params.rgtValue = 0\r\n            } else if (turn < 0) {\r\n                me.params.lftValue = 0\r\n                me.params.rgtValue = me.player.speedFactor\r\n            }\r\n          })\r\n    \r\n        this.joyManager['0'].on('end', function (evt) {\r\n            me.params.bkdValue = 0\r\n            me.params.fwdValue = 0\r\n            me.params.lftValue = 0\r\n            me.params.rgtValue = 0\r\n        })\r\n    }\r\n\r\n    updatePlayer() {\r\n        // move the player\r\n        const angle = this.player.controls.getAzimuthalAngle();\r\n        this.player.setAnimationParameters(\"idle\");\r\n      \r\n        if (this.params.fwdValue > 0) {\r\n            this.params.tempVector.set(0, 0, -(this.params.fwdValue)).applyAxisAngle(this.params.upVector, angle);\r\n            this.player.position.addScaledVector(this.params.tempVector, 1);\r\n            this.player.horizontalVelocity.add(this.params.tempVector);\r\n            this.player.setAnimationParameters(\"walk\");\r\n        }\r\n      \r\n        if (this.params.bkdValue > 0) {\r\n            this.params.tempVector.set(0, 0, this.params.bkdValue).applyAxisAngle(this.params.upVector, angle);\r\n            this.player.position.addScaledVector(this.params.tempVector, 1);\r\n            this.player.horizontalVelocity.add(this.params.tempVector);\r\n            this.player.setAnimationParameters(\"walk\");\r\n        }\r\n      \r\n        if (this.params.lftValue > 0) {\r\n            this.params.tempVector.set(-(this.params.lftValue), 0, 0).applyAxisAngle(this.params.upVector, angle);\r\n            this.player.position.addScaledVector(this.params.tempVector, 1);\r\n            this.player.horizontalVelocity.add(this.params.tempVector);\r\n            this.player.setAnimationParameters(\"walk\");\r\n        }\r\n      \r\n        if (this.params.rgtValue > 0) {\r\n            this.params.tempVector.set(this.params.rgtValue, 0, 0).applyAxisAngle(this.params.upVector, angle);\r\n            this.player.position.addScaledVector(this.params.tempVector, 1);\r\n            this.player.horizontalVelocity.add(this.params.tempVector);\r\n            this.player.setAnimationParameters(\"walk\");\r\n        }\r\n \r\n        // reposition camera\r\n        this.player.camera.position.sub(this.player.controls.target);\r\n        this.player.controls.target.copy(this.player.position);\r\n        this.player.camera.position.add(this.player.position);\r\n    }\r\n\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/Common/Joystick.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/Common/NameTooltip.js":
/*!************************************************************!*\
  !*** ./src/UserInterface/UiElements/Common/NameTooltip.js ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"NameTooltip\": () => (/* binding */ NameTooltip)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass NameTooltip extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(title){\r\n        super({\r\n            attributes: {\r\n                className: 'label',\r\n                textContent: title\r\n            },\r\n            style: { \r\n                marginTop: '-1em',\r\n                padding: '5px',\r\n                opacity: '1',\r\n                background: 'gray',\r\n                color: 'white',\r\n                fontWeight: 'bold'\r\n            }\r\n        })  \r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/Common/NameTooltip.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/Common/RingtoneSystem.js":
/*!***************************************************************!*\
  !*** ./src/UserInterface/UiElements/Common/RingtoneSystem.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"RingToneSystem\": () => (/* binding */ RingToneSystem)\n/* harmony export */ });\nclass RingToneSystem {\r\n    constructor(){\r\n        this.audio = new Audio();\r\n    }\r\n\r\n    playCallTone() {\r\n        this.audio.load();\r\n        this.audio.src = '../../../resources/audios/ringtone.mp3';\r\n        this.audio.loop = true;\r\n        this.audio.play();\r\n    }\r\n\r\n    playNotifyTone() {\r\n        this.audio.load();\r\n        this.audio.src = '../../../resources/audios/notify.mp3';\r\n        this.audio.loop = false;\r\n        this.audio.play();\r\n    }\r\n\r\n    mute() {\r\n        this.audio.load();\r\n        this.audio.pause();\r\n        this.audio.currentTime = 0;\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/Common/RingtoneSystem.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/LoadingPage/loadingPage.js":
/*!*****************************************************************!*\
  !*** ./src/UserInterface/UiElements/LoadingPage/loadingPage.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"loadingBar\": () => (/* binding */ loadingBar),\n/* harmony export */   \"loadingPage\": () => (/* binding */ loadingPage)\n/* harmony export */ });\nconst loadingPage = function() {\r\n    const progressBarContainer = document.createElement(\"div\");\r\n    progressBarContainer.className = 'progress-bar-container';\r\n\r\n    Object.assign(progressBarContainer.style, {\r\n        position: 'absolute',\r\n        width: '100%',\r\n        height: '100%',\r\n        backgroundColor: \"rgba(0, 0, 0, 0.8)\",\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        zIndex: 1000\r\n    });\r\n\r\n    const title = document.createElement('label');\r\n    title.innerHTML = \"Loading....\";\r\n    Object.assign(title.style, {\r\n        color: 'rgba(256, 256, 256, 0.8)',\r\n        fontSize: \"x-small\"\r\n    });\r\n\r\n    const progress = document.createElement('progress');\r\n    progress.id = 'progress-bar';\r\n    progress.value = 0;\r\n    progress.max = 100;\r\n\r\n    Object.assign(progress.style, {\r\n        width: '30%',\r\n        marginTop: '0.5%',\r\n        height: '2%'\r\n    });\r\n\r\n    progressBarContainer.appendChild(title);\r\n    progressBarContainer.appendChild(progress);\r\n    document.body.appendChild(progressBarContainer);\r\n\r\n}\r\n\r\nconst loadingBar = function(manager) {\r\n    const progressBar = document.getElementById('progress-bar');\r\n    const progressBarContainer = document.querySelector('.progress-bar-container');\r\n    progressBarContainer.style.display = 'flex';\r\n\r\n    manager.onProgress = function(url, loaded, total) {\r\n        progressBar.value = loaded/total * 100;\r\n    }\r\n\r\n    manager.onLoad = function() {\r\n        progressBarContainer.style.display = 'none';\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/LoadingPage/loadingPage.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/PlayScreen/ControlsInstructions/ControlsInstructions.js":
/*!**********************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/PlayScreen/ControlsInstructions/ControlsInstructions.js ***!
  \**********************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ControlsInstructions\": () => (/* binding */ ControlsInstructions)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _ControlsInstructionsElements_ControlsDisplayBox_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ControlsInstructionsElements/ControlsDisplayBox.js */ \"./src/UserInterface/UiElements/PlayScreen/ControlsInstructions/ControlsInstructionsElements/ControlsDisplayBox.js\");\n\r\n\r\n\r\n\r\nclass ControlsInstructions extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(parent) {\r\n        super({\r\n            id: \"ControlInstructions\",\r\n            style: {\r\n                position: \"absolute\",\r\n                top: \"0\",\r\n                left: \"0\",\r\n                width: \"100%\",\r\n                color: \"rgba(256, 256, 256, 0.8)\",\r\n                display: \"flex\",\r\n                justifyContent: \"center\",\r\n                fontSize: \"x-small\"\r\n            }\r\n        })\r\n\r\n        this.controlsDisplayBox = new _ControlsInstructionsElements_ControlsDisplayBox_js__WEBPACK_IMPORTED_MODULE_1__.ControlsDisplayBox(this.element)\r\n        this.appendChild(this.controlsDisplayBox);\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/PlayScreen/ControlsInstructions/ControlsInstructions.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/PlayScreen/ControlsInstructions/ControlsInstructionsElements/ControlsDisplayBox.js":
/*!*************************************************************************************************************************!*\
  !*** ./src/UserInterface/UiElements/PlayScreen/ControlsInstructions/ControlsInstructionsElements/ControlsDisplayBox.js ***!
  \*************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"ControlsDisplayBox\": () => (/* binding */ ControlsDisplayBox)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n\r\n\r\nclass ControlsDisplayBox extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor(parent) {\r\n        super({\r\n            id: \"ControlsDisplayBox\",\r\n            style: {\r\n                background: \"rgba(0, 0, 0, 0.2)\",\r\n                padding: \"2px\",\r\n                border: \"1px solid rgba(256, 256, 256, 0.3)\"\r\n            },\r\n            innerHTML: \"<b>WASD</b> move, <b>SHIFT</b> run, <b>SPACE</b> jump, <b>V</b> view\",\r\n            parent: parent\r\n        })\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/PlayScreen/ControlsInstructions/ControlsInstructionsElements/ControlsDisplayBox.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/PlayScreen/PlayScreen.js":
/*!***************************************************************!*\
  !*** ./src/UserInterface/UiElements/PlayScreen/PlayScreen.js ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"PlayScreen\": () => (/* binding */ PlayScreen)\n/* harmony export */ });\n/* harmony import */ var _UiElement_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../UiElement.js */ \"./src/UserInterface/UiElements/UiElement.js\");\n/* harmony import */ var _ControlsInstructions_ControlsInstructions_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ControlsInstructions/ControlsInstructions.js */ \"./src/UserInterface/UiElements/PlayScreen/ControlsInstructions/ControlsInstructions.js\");\n\r\n\r\n\r\nclass PlayScreen extends _UiElement_js__WEBPACK_IMPORTED_MODULE_0__.UiElement {\r\n    constructor() {\r\n        super({\r\n            id: \"playScreen\",\r\n            style: {\r\n                position: \"absolute\",\r\n                top: \"0\",\r\n                width: \"100%\",\r\n                height: \"100%\",\r\n                display: \"none\",\r\n            },\r\n            onClick: () => {\r\n                if(VIRTUAL_ENVIRONMENT.touch) {\r\n                    VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleControlsUnlock();\r\n                }\r\n            }\r\n        })\r\n\r\n        this.controlsInstructions = new _ControlsInstructions_ControlsInstructions_js__WEBPACK_IMPORTED_MODULE_1__.ControlsInstructions(this);\r\n        this.appendChild(this.controlsInstructions);\r\n\r\n        document.body.appendChild(this.element);        \r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/PlayScreen/PlayScreen.js?");

/***/ }),

/***/ "./src/UserInterface/UiElements/UiElement.js":
/*!***************************************************!*\
  !*** ./src/UserInterface/UiElements/UiElement.js ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"UiElement\": () => (/* binding */ UiElement)\n/* harmony export */ });\nclass UiElement { \r\n    constructor(options) {\r\n        const defaultOptions = {\r\n            type: \"div\", \r\n            id: undefined,\r\n            style: {},\r\n            attributes: {},\r\n            hover: undefined,\r\n            onClick: undefined,\r\n            innerHTML: undefined\r\n        }\r\n\r\n        // set empty options to their default values\r\n        for (let option in defaultOptions) {\r\n            options[option] = typeof options[option] === 'undefined' ? defaultOptions[option] : options[option];\r\n        }\r\n\r\n        this.options = options;\r\n    \r\n        // Create the element and assign id\r\n        this.element = document.createElement(options.type);\r\n        if(typeof options.id !== \"undefined\") {\r\n            this.element.id = options.id;\r\n        }\r\n\r\n        // apply the style\r\n        Object.assign(this.element.style, options.style);\r\n\r\n        //aply attributes\r\n        Object.assign(this.element, options.attributes);\r\n        \r\n        // if something is defined in the hover, add event listeners\r\n        if(typeof options.hover !== \"undefined\"){\r\n            this.element.addEventListener(\"mouseenter\", () => {\r\n                Object.assign(this.element.style, options.hover);\r\n            })\r\n            this.element.addEventListener(\"mouseleave\", () => {\r\n                Object.assign(this.element.style, options.style);\r\n            })\r\n        }\r\n\r\n        // if something is defined in the onClick, add the event listener\r\n        if(typeof options.onClick !== \"undefined\"){\r\n            this.element.addEventListener(\"click\", options.onClick)\r\n        }\r\n        // this.element.addEventListener(\"click\", () => {console.log(this.element.id)})\r\n\r\n        if(typeof options.innerHTML !== \"undefined\"){\r\n            this.element.innerHTML = options.innerHTML;\r\n        }\r\n    }\r\n\r\n    appendChild(uiElement) {\r\n        this.element.appendChild(uiElement.element);\r\n    }\r\n\r\n    appendChildList(uiElementList) {\r\n        uiElementList.forEach(uiElement => {\r\n            this.element.appendChild(uiElement.element);\r\n        })\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/UserInterface/UiElements/UiElement.js?");

/***/ }),

/***/ "./src/VirtualEnvironment.js":
/*!***********************************!*\
  !*** ./src/VirtualEnvironment.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"VirtualEnvironment\": () => (/* binding */ VirtualEnvironment)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_renderers_CSS2DRenderer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/renderers/CSS2DRenderer.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/renderers/CSS2DRenderer.js\");\n/* harmony import */ var _entities_PlayerLocal_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./entities/PlayerLocal.js */ \"./src/entities/PlayerLocal.js\");\n/* harmony import */ var _terrain_TerrainController_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./terrain/TerrainController.js */ \"./src/terrain/TerrainController.js\");\n/* harmony import */ var _util_RemoteController_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./util/RemoteController.js */ \"./src/util/RemoteController.js\");\n/* harmony import */ var _UserInterface_UiController_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./UserInterface/UiController.js */ \"./src/UserInterface/UiController.js\");\n/* harmony import */ var _render_DefaultDirectionalLight_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./render/DefaultDirectionalLight.js */ \"./src/render/DefaultDirectionalLight.js\");\n/* harmony import */ var _render_DefaultComposer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./render/DefaultComposer.js */ \"./src/render/DefaultComposer.js\");\n/* harmony import */ var _util_localProxy_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./util/localProxy.js */ \"./src/util/localProxy.js\");\n/* harmony import */ var _UserInterface_UiElements_LoadingPage_loadingPage_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./UserInterface/UiElements/LoadingPage/loadingPage.js */ \"./src/UserInterface/UiElements/LoadingPage/loadingPage.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// import graphicTierButton from './UiElements/buttons/graphicTierButton.js';\r\n\r\nconst LOW = 0;\r\nconst MEDIUM = 1;\r\nconst HIGH = 2;\r\nconst ULTRA = 3;\r\nconst settings = [\"Low\", \"Medium\", \"High\", \"Ultra\"];\r\nconst DEFAULT = \"default\";\r\n\r\nlet shadowLight;\r\nconst clock = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Clock();\r\n\r\nclass VirtualEnvironment {\r\n    constructor() {\r\n        // ===== loading =====\r\n        this.loading();\r\n        \r\n        // until complete removal of the graphic tier setting, keep this section commented\r\n        this.graphicTier = 2; //localProxy.tier !== undefined ? localProxy.tier : 0;\r\n\r\n        // === controls option ===\r\n        this.touch = false;\r\n\r\n        // inject this n the window\r\n        window.VIRTUAL_ENVIRONMENT = this;\r\n\r\n        // ===== renderer =====\r\n        this.renderer = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.WebGLRenderer({ alpha: true });\r\n        this.renderer.setPixelRatio(1);\r\n        this.renderer.setSize(window.innerWidth-1, window.innerHeight-1);\r\n        this.renderer.shadowMap.enabled = true;\r\n        this.renderer.shadowMap.type = https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.VSMShadowMap;\r\n        document.body.appendChild(this.renderer.domElement);\r\n\r\n        // ===== 2D renderer =====\r\n        this.labelRenderer = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_renderers_CSS2DRenderer_js__WEBPACK_IMPORTED_MODULE_1__.CSS2DRenderer();\r\n        this.labelRenderer.setSize( window.innerWidth, window.innerHeight );\r\n        this.labelRenderer.domElement.style.position = 'absolute';\r\n        this.labelRenderer.domElement.style.top = '0px';\r\n        document.body.appendChild( this.labelRenderer.domElement );\r\n\r\n        // ===== scene =====\r\n        window.MAIN_SCENE = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Scene();\r\n        MAIN_SCENE.background = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Color(0x69e6f4);\r\n        MAIN_SCENE.fog = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Fog(0x69e6f4, 1600, 2000);\r\n\r\n        // ===== camera =====\r\n        this.camera = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);\r\n        this.camera.position.y = 1.6;\r\n        this.camera.lookAt(0, 1.7, -1);\r\n        this.dummyCamera = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);\r\n        this.dummyCamera.position.y = 1.6;\r\n        this.dummyCamera.lookAt(0, 1.7, -1);\r\n        this.cameraPosition = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n        this.cameraTarget = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n\r\n        // ===== lights =====\r\n        const light = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.HemisphereLight(0xffeeff, 0x777788, 1);\r\n        light.position.set(0.5, 1, 0.75);\r\n        MAIN_SCENE.add(light);\r\n\r\n        if (this.graphicTier !== LOW) {\r\n            shadowLight = new _render_DefaultDirectionalLight_js__WEBPACK_IMPORTED_MODULE_6__.DefaultDirectionalLight(this.graphicTier);\r\n            MAIN_SCENE.add(shadowLight);\r\n            MAIN_SCENE.add(shadowLight.target);\r\n        }\r\n\r\n        // ===== shaders =====\r\n        this.composer = new _render_DefaultComposer_js__WEBPACK_IMPORTED_MODULE_7__.DefaultComposer(this.renderer, MAIN_SCENE, this.camera);\r\n\r\n        // ===== graphic settings =====\r\n        this.setGraphicsSetting(this.graphicTier);\r\n        \r\n        // ===== UI =====\r\n        this.UI_CONTROLLER = new _UserInterface_UiController_js__WEBPACK_IMPORTED_MODULE_5__.UiController();\r\n\r\n        // ===== Terrain Controller\r\n        this.terrainController = new _terrain_TerrainController_js__WEBPACK_IMPORTED_MODULE_3__.TerrainController(this.loadingManager);\r\n\r\n        // ===== setup resize listener ==========\r\n        window.addEventListener('resize', () => onWindowResize(this.camera, this.renderer, this.labelRenderer), false);\r\n\r\n        function onWindowResize(camera, renderer, labelRenderer) {\r\n            camera.aspect = window.innerWidth / window.innerHeight;\r\n            camera.updateProjectionMatrix();\r\n            renderer.setSize(window.innerWidth, window.innerHeight);\r\n            labelRenderer.setSize(window.innerWidth, window.innerHeight);\r\n        }\r\n\r\n        // ===== setupMultiplayer =====\r\n        this.remoteController = new _util_RemoteController_js__WEBPACK_IMPORTED_MODULE_4__.RemoteController(this.loadingManager, MAIN_SCENE);\r\n\r\n    } // -- end constructor\r\n\r\n    loadTerrain(terrainPath, x, y, z, format, scaleFactor = 1){\r\n        this.terrainController.loadTerrain(terrainPath, MAIN_SCENE, x, y, z, format, scaleFactor);\r\n    }\r\n\r\n    generateTerrain(seed) {\r\n        this.terrainController.generateTerrain(seed);\r\n    }\r\n    \r\n    spawnPlayer(params) {\r\n        window.LOCAL_PLAYER = new _entities_PlayerLocal_js__WEBPACK_IMPORTED_MODULE_2__.PlayerLocal(params, this.dummyCamera, this.loadingManager);\r\n        MAIN_SCENE.add(LOCAL_PLAYER);\r\n    }\r\n\r\n    setShadowLightTier(graphicTier) {\r\n        if (shadowLight) {\r\n            MAIN_SCENE.remove(shadowLight.target);\r\n            MAIN_SCENE.remove(shadowLight);\r\n            shadowLight.dispose();\r\n            shadowLight.shadow.dispose();\r\n        }\r\n\r\n        if (graphicTier !== LOW) {\r\n            shadowLight = new _render_DefaultDirectionalLight_js__WEBPACK_IMPORTED_MODULE_6__.DefaultDirectionalLight(this.graphicTier);\r\n            MAIN_SCENE.add(shadowLight);\r\n            MAIN_SCENE.add(shadowLight.target);\r\n        } else {\r\n            shadowLight = undefined;\r\n        }\r\n    }\r\n\r\n    setGraphicsSetting(graphicTier) {\r\n        this.graphicTier = graphicTier;\r\n        this.setShadowLightTier(graphicTier);\r\n        this.composer.setGraphicsSetting(graphicTier, this.renderer, MAIN_SCENE);\r\n\r\n        const graphicTierButtonElement = document.getElementById(\"graphicTierButton\");\r\n        if(graphicTierButtonElement !== null) {\r\n            graphicTierButtonElement.innerHTML = \"Light: \" + settings[graphicTier];\r\n        }\r\n    }\r\n\r\n    newSolidGeometriesFromSource(url, x, y, z, scaleFactor){\r\n        this.terrainController.newSolidGeometriesFromSource(MAIN_SCENE, url, x, y, z, scaleFactor)\r\n    }\r\n\r\n    addVideoPlaylist(playlist, width, height, x, y, z, rotationY) {\r\n        this.videos = playlist.map(item => {\r\n            const video = document.createElement('video');\r\n            video.id = item.url; // give unique id to support multiple players\r\n            video.loop = true;\r\n            video.crossOrigin = \"anonymous\";\r\n            video.playsinline = true;\r\n            video.style.display = \"none\";\r\n\r\n            const source =  document.createElement('source')\r\n            source.src = item.url;\r\n            source.type = 'video/mp4';\r\n\r\n            video.appendChild(source);\r\n\r\n            return video;\r\n        })\r\n\r\n        this.playlist = playlist;\r\n\r\n        this.videoParams = {width: width, height: height, x: x, y: y, z: z, w: rotationY};\r\n\r\n        // this.playVideo(this.playlist[0].url);\r\n    }\r\n\r\n    playVideo(url) {\r\n        let video = this.videos.filter(item => item.id === url)[0];\r\n        if(!video) return;\r\n        document.body.appendChild(video);\r\n\r\n        let width = this.videoParams.width;\r\n        let height = this.videoParams.height;\r\n        let x = this.videoParams.x;\r\n        let y = this.videoParams.y;\r\n        let z = this.videoParams.z;\r\n        let rotationY = this.videoParams.w;\r\n\r\n        const mesh = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Mesh( \r\n            new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.PlaneGeometry( width, height ), \r\n            new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.MeshLambertMaterial({ \r\n                color: 0xffffff, \r\n                map: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.VideoTexture( video ) \r\n            }) \r\n        );\r\n        mesh.position.set(x, y, z)\r\n        mesh.rotateY(rotationY)\r\n\r\n        MAIN_SCENE.add( mesh )\r\n\r\n        video.play();\r\n    }\r\n\r\n    pauseVideo(url) {\r\n        let video = this.videos.filter(item => item.id === url)[0];\r\n        if(!video) return;\r\n        video.pause();\r\n    }\r\n\r\n    rewindVideo(url) {\r\n        let video = this.videos.filter(item => item.id === url)[0];\r\n        if(!video) return;\r\n        video.currentTime = 0;\r\n    }\r\n\r\n    newVideoDisplayPlane(url, width, height, x, y, z, rotationY) {\r\n        const video = document.createElement('video');\r\n        video.id = url; // give unique id to support multiple players\r\n        video.loop = true;\r\n        video.crossOrigin = \"anonymous\";\r\n        video.playsinline = true;\r\n        video.style.display = \"none\";\r\n\r\n        const source =  document.createElement('source')\r\n        source.src = url;\r\n        source.type = 'video/mp4';\r\n\r\n        video.appendChild(source);\r\n        document.body.appendChild(video)\r\n\r\n        document.onkeydown = function(e) {\r\n            if (e.keyCode == 80 && !this.videoHasPlayed) {\r\n                //p - play \r\n                video.play();\r\n                this.videoHasPlayed = true;\r\n            } else if (e.keyCode == 80 && this.videoHasPlayed) {\r\n                //p - pause\r\n                this.videoHasPlayed = false;\r\n                video.pause();\r\n            } else if (e.keyCode == 82) {\r\n                //r - rewind video\r\n                video.currentTime(0);\r\n            }\r\n\r\n        }\r\n\r\n        const mesh = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Mesh( \r\n            new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.PlaneGeometry( width, height ), \r\n            new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.MeshLambertMaterial({ \r\n                color: 0xffffff, \r\n                map: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.VideoTexture( video ) \r\n            }) \r\n        );\r\n        mesh.position.set(x,y,z)\r\n        mesh.rotateY(rotationY)\r\n\r\n        MAIN_SCENE.add( mesh )\r\n    }\r\n\r\n    increaseGraphicSettings() {\r\n        this.graphicTier += 1;\r\n        this.graphicTier %= 4;\r\n        _util_localProxy_js__WEBPACK_IMPORTED_MODULE_8__[\"default\"].tier = this.graphicTier;\r\n        this.setGraphicsSetting(this.graphicTier)\r\n    }\r\n\r\n    loading() {\r\n        // ===== loading manager =====\r\n        this.loadingManager = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.LoadingManager();\r\n\r\n        (0,_UserInterface_UiElements_LoadingPage_loadingPage_js__WEBPACK_IMPORTED_MODULE_9__.loadingPage)();\r\n        (0,_UserInterface_UiElements_LoadingPage_loadingPage_js__WEBPACK_IMPORTED_MODULE_9__.loadingBar)(this.loadingManager);\r\n    }\r\n\r\n    enableTouchControls(state) {\r\n        this.touch = state;\r\n    }\r\n\r\n    showMap(maps) {\r\n        this.maps = maps;\r\n    }\r\n    \r\n    update() {\r\n        const delta = Math.min(clock.getDelta(), 0.1);\r\n        if (this.terrainController.collider) {\r\n            \r\n            LOCAL_PLAYER.update(delta, this.terrainController.collider);\r\n            this.camera.position.copy(LOCAL_PLAYER.position);\r\n            \r\n            this.camera.position.copy(LOCAL_PLAYER.position);\r\n            const dir = this.dummyCamera.getWorldDirection(new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3());\r\n            this.camera.position.add(dir.multiplyScalar(LOCAL_PLAYER.controlVector.z));\r\n            this.camera.lookAt(LOCAL_PLAYER.position);\r\n            const invMat = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4();\r\n            const raycaster = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Raycaster(LOCAL_PLAYER.position.clone(), this.camera.position.clone().sub(LOCAL_PLAYER.position.clone()).normalize());\r\n            invMat.copy(this.terrainController.collider.matrixWorld).invert();\r\n            raycaster.ray.applyMatrix4(invMat);\r\n            const hit = this.terrainController.collider.geometry.boundsTree.raycastFirst(raycaster.ray);\r\n            if (hit) {\r\n                this.camera.position.copy(LOCAL_PLAYER.position);\r\n                const dir = this.dummyCamera.getWorldDirection(new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3());\r\n                this.camera.position.add(dir.multiplyScalar(Math.min(hit.point.distanceTo(LOCAL_PLAYER.position), LOCAL_PLAYER.controlVector.z * 1.25) * 0.8));\r\n                this.camera.lookAt(LOCAL_PLAYER.position);\r\n            }\r\n            this.cameraPosition.lerp(this.camera.position, LOCAL_PLAYER.controlVector.w);\r\n            this.cameraTarget.lerp(LOCAL_PLAYER.position, LOCAL_PLAYER.controlVector.w);\r\n            this.camera.position.copy(this.cameraPosition);\r\n            this.camera.lookAt(this.cameraTarget);\r\n            \r\n        }\r\n\r\n        this.remoteController.update(delta);\r\n\r\n        MAIN_SCENE.fog.needsUpdate = true;\r\n\r\n        if (this.graphicTier !== LOW) {\r\n            shadowLight.update(this.camera);\r\n        }\r\n        this.composer.update(this.camera);\r\n        if (this.graphicTier > LOW) {\r\n            this.renderer.setRenderTarget(this.composer.defaultTexture);\r\n            this.renderer.clear();\r\n            this.renderer.render(MAIN_SCENE, this.camera);\r\n            this.labelRenderer.render(MAIN_SCENE, this.camera);\r\n            this.renderer.setRenderTarget(this.composer.bloomTexture);\r\n            this.renderer.clear();\r\n            this.renderer.render(this.terrainController.bloomScene, this.camera);\r\n            this.labelRenderer.render(this.terrainController.bloomScene, this.camera);\r\n        }\r\n\r\n        this.renderer.setRenderTarget(null);\r\n        this.renderer.clear();\r\n        this.composer.render();\r\n\r\n        this.UI_CONTROLLER.update();\r\n    }\r\n\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/VirtualEnvironment.js?");

/***/ }),

/***/ "./src/entities/AvatarController.js":
/*!******************************************!*\
  !*** ./src/entities/AvatarController.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"AvatarController\": () => (/* binding */ AvatarController)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_renderers_CSS2DRenderer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/renderers/CSS2DRenderer.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/renderers/CSS2DRenderer.js\");\n/* harmony import */ var _UserInterface_UiElements_Common_NameTooltip_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../UserInterface/UiElements/Common/NameTooltip.js */ \"./src/UserInterface/UiElements/Common/NameTooltip.js\");\n/* harmony import */ var _UserInterface_UiElements_LoadingPage_loadingPage_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../UserInterface/UiElements/LoadingPage/loadingPage.js */ \"./src/UserInterface/UiElements/LoadingPage/loadingPage.js\");\n/* harmony import */ var _util_localProxy_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../util/localProxy.js */ \"./src/util/localProxy.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst DEFAULT_AVATAR_PATH = '//asset.airclass.io/public/avatars/joe.glb';\r\nconst DEFAULT_ANIMATION_PATH = '//asset.airclass.io/public/animations/joe@animation.glb';\r\n// const DEFAULT_AVATAR_PATH = '../../../resources/avatars/joe.glb';\r\n// const DEFAULT_ANIMATION_PATH = '../../../resources/animations/joe@animation.glb';\r\nconst DEFAULT_ANIMATION_MAPPING = { walk: 1, idle: 2, run: 3, jump: 5, fall: 4 };\r\nconst DEFAULT_SIZE = 0.2;\r\n\r\nclass AvatarController extends https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Object3D {\r\n    constructor(manager) {//animationURL, avatarURL, keyMap\r\n        super();\r\n        this.loader = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_1__.GLTFLoader(manager);\r\n        this.manager = manager;\r\n        this.animations = {};\r\n        this.quaternion90deg = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Quaternion();\r\n        this.quaternion90deg.setFromAxisAngle( new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3( -1, 0, 0 ), -Math.PI / 2 );\r\n        this.peerName = 'guest';\r\n    }\r\n\r\n    spawnAvatar(params) {\r\n        params.avatarPath = typeof params.avatarPath === \"undefined\" ? DEFAULT_AVATAR_PATH : params.avatarPath;\r\n        params.animationPath = typeof params.animationPath === \"undefined\" ? DEFAULT_ANIMATION_PATH : params.animationPath;\r\n        params.animationMapping = typeof params.animationMapping === \"undefined\" ? DEFAULT_ANIMATION_MAPPING : params.animationMapping;\r\n        params.size = typeof params.size === \"undefined\" ? DEFAULT_SIZE : params.size;\r\n        this.params = params;\r\n        this.loadAvatar(params.avatarPath, () => this.loadAnimations(params.animationPath, params.animationMapping));\r\n    }\r\n\r\n    spawnRemoteAvatar(params) {\r\n        this.peerName = params.otherPlayer ? params.otherPlayer : 'guest';\r\n        this.spawnAvatar(params);\r\n    }\r\n\r\n    play(anim, time = 0.5) {\r\n        \r\n        if (anim !== this.current && (performance.now() - this.lastChange) >= 250) {\r\n            this.lastChange = performance.now();\r\n            \r\n            if (this.current !== \"none\" && typeof this.animations[this.current] !== 'undefined') {\r\n                this.animations[this.current].fadeOut(time);\r\n            }\r\n            \r\n            this.current = anim;\r\n            if(typeof this.animations[this.current] !== 'undefined'){\r\n                this.animations[this.current].enabled = true;\r\n                this.animations[this.current].reset();\r\n                this.animations[this.current].fadeIn(time);\r\n                this.animations[this.current].play();\r\n            }\r\n            \r\n            \r\n        }\r\n    }\r\n\r\n    update(delta, position, horizontalVelocity, anim, time = 0.5) {\r\n        \r\n        // use the mixer as only signal that everything is properly loaded\r\n        if(this.mixer){\r\n            this.position.copy(position);\r\n            this.updateFacingDirection(horizontalVelocity)\r\n            this.play(anim, time);\r\n            this.mixer.update(delta);\r\n        \r\n            // this part should not happen on every update, only when user changes the view\r\n            this.model.traverse(child => {\r\n                if (child.isMesh) {\r\n                    \r\n                    child.material.opacity = this.opacity;\r\n                    \r\n                    if (this.opacity < 1) {\r\n                        child.material.transparent = true;\r\n                    } else {\r\n                        child.material.transparent = false;\r\n                    }\r\n                }\r\n            })\r\n        }        \r\n    }\r\n\r\n    changeAvatar(avatarUrl, animationsUrl, animationMapping) {\r\n        (0,_UserInterface_UiElements_LoadingPage_loadingPage_js__WEBPACK_IMPORTED_MODULE_4__.loadingBar)(this.manager);\r\n        this.model.remove(this.username);\r\n        this.peerName = _util_localProxy_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].peerId ? _util_localProxy_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].peerId : 'guest';\r\n        this.loadAvatar(avatarUrl, () => this.loadAnimations(animationsUrl, animationMapping));\r\n    }\r\n\r\n    reloadAvatar() {\r\n        (0,_UserInterface_UiElements_LoadingPage_loadingPage_js__WEBPACK_IMPORTED_MODULE_4__.loadingBar)(this.manager);\r\n        this.model.remove(this.username);\r\n        this.peerName = _util_localProxy_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].peerId ? _util_localProxy_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].peerId : 'guest';\r\n        this.loadAvatar(this.params.avatarPath, () => this.loadAnimations(this.params.animationPath, this.params.animationMapping));\r\n    }\r\n\r\n    loadAvatar(avatarURL, loadAnimation) {\r\n        this.loader.load(avatarURL, (responseObject) => {\r\n            \r\n            MAIN_SCENE.remove(this.model)\r\n\r\n            this.radius = 2.5;\r\n            this.size = 30;\r\n\r\n            this.model = responseObject.scene;\r\n            this.model.scale.set(this.params.size, this.params.size, this.params.size);\r\n            this.model.traverse(child => {\r\n                if (child.isMesh) {\r\n                    child.castShadow = true;\r\n                    child.receiveShadow = true;\r\n                    child.frustumCulled = false;\r\n                }\r\n            });\r\n\r\n            const tooltip = new _UserInterface_UiElements_Common_NameTooltip_js__WEBPACK_IMPORTED_MODULE_3__.NameTooltip(this.peerName);\r\n            this.username = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_renderers_CSS2DRenderer_js__WEBPACK_IMPORTED_MODULE_2__.CSS2DObject( tooltip.element );\r\n            this.username.position.set( this.model.position.x,  this.model.position.y + 100, this.model.position.z);\r\n            this.model.add( this.username );\r\n            MAIN_SCENE.add(this.model);\r\n\r\n            loadAnimation(); \r\n        });\r\n    }\r\n\r\n    removeAvatar(){\r\n        this.model.remove(this.username);\r\n        MAIN_SCENE.remove(this.model);\r\n    }\r\n\r\n    loadAnimations(animationURL, animationMapping) {\r\n        this.loader.load(animationURL, (gltf) => {\r\n            if(typeof this.model == 'undefined') return;\r\n            this.current = \"none\";\r\n            this.animations = {\r\n                \"walk\": gltf.animations[animationMapping.walk],\r\n                \"idle\": gltf.animations[animationMapping.idle],\r\n                \"run\": gltf.animations[animationMapping.run],\r\n                \"jump\": gltf.animations[animationMapping.jump],\r\n                \"fall\": gltf.animations[animationMapping.fall]\r\n            };\r\n            this.mixer = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.AnimationMixer(this.model);\r\n            Object.entries(this.animations).forEach(([anim, clip]) => {\r\n                this.animations[anim] = this.mixer.clipAction(clip);\r\n            });\r\n            this.lastChange = performance.now() - 250;\r\n            this.delta = 0;\r\n            this.play(\"idle\", 0);\r\n            this.opacity = 1;\r\n        });\r\n    }\r\n\r\n    updateFacingDirection(horizontalVelocity) {\r\n        if(horizontalVelocity.length() > 0.001){\r\n            this.lookAt(this.position.x + horizontalVelocity.x, this.position.y + this.size / 2 + 1.25 , this.position.z + horizontalVelocity.z);\r\n            this.quaternion.multiply(this.quaternion90deg)\r\n        }\r\n\r\n        this.model.position.copy(this.position);\r\n        this.model.position.y -= this.size / 2 + 1.25;\r\n        this.model.quaternion.copy(this.quaternion);\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/entities/AvatarController.js?");

/***/ }),

/***/ "./src/entities/CapsuleEntity.js":
/*!***************************************!*\
  !*** ./src/entities/CapsuleEntity.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"CapsuleEntity\": () => (/* binding */ CapsuleEntity)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n\r\nclass CapsuleEntity extends https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Object3D {\r\n    constructor(radius, size) {\r\n        super();\r\n        this.box = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3();\r\n        this.velocity = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n        this.horizontalVelocity = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n        this.radius = radius;\r\n        this.size = size;\r\n        this.onGround = false;\r\n        this.gravity = -300;\r\n        this.segment = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3(new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3(), new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3(0, -size, 0.0));\r\n        this.friction = 0.975;\r\n    }\r\n    update(delta, collider) {\r\n        this.velocity.y += this.onGround ? 0 : delta * this.gravity;\r\n        this.position.addScaledVector(this.velocity, delta);\r\n        this.position.add(this.horizontalVelocity);\r\n        this.horizontalVelocity.multiplyScalar(this.friction);\r\n        this.updateMatrixWorld();\r\n        const tempBox = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3();\r\n        const tempMat = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4();\r\n        const tempSegment = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3();\r\n        tempBox.makeEmpty();\r\n        tempMat.copy(collider.matrixWorld).invert();\r\n        tempSegment.copy(this.segment);\r\n        tempSegment.start.applyMatrix4(this.matrixWorld).applyMatrix4(tempMat);\r\n        tempSegment.end.applyMatrix4(this.matrixWorld).applyMatrix4(tempMat);\r\n        tempBox.expandByPoint(tempSegment.start);\r\n        tempBox.expandByPoint(tempSegment.end);\r\n        tempBox.min.addScalar(-this.radius);\r\n        tempBox.max.addScalar(this.radius);\r\n        const tempVector = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n        const tempVector2 = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n        collider.geometry.boundsTree.shapecast({\r\n\r\n            intersectsBounds: box => box.intersectsBox(tempBox),\r\n\r\n            intersectsTriangle: tri => {\r\n\r\n                // check if the triangle is intersecting the capsule and adjust the\r\n                // capsule position if it is.\r\n                const triPoint = tempVector;\r\n                const capsulePoint = tempVector2;\r\n\r\n                const distance = tri.closestPointToSegment(tempSegment, triPoint, capsulePoint);\r\n                if (distance < this.radius) {\r\n\r\n                    const depth = this.radius - distance;\r\n                    const direction = capsulePoint.sub(triPoint).normalize();\r\n\r\n                    tempSegment.start.addScaledVector(direction, depth);\r\n                    tempSegment.end.addScaledVector(direction, depth);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        });\r\n        const newPosition = tempVector;\r\n        newPosition.copy(tempSegment.start).applyMatrix4(collider.matrixWorld);\r\n\r\n        const deltaVector = tempVector2;\r\n        deltaVector.subVectors(newPosition, this.position);\r\n        this.onGround = deltaVector.y > Math.abs(delta * this.velocity.y * 0.25);\r\n        const offset = Math.max(0.0, deltaVector.length() - 1e-5);\r\n        deltaVector.normalize().multiplyScalar(offset);\r\n        this.position.add(deltaVector);\r\n        if (!this.onGround) {\r\n\r\n            deltaVector.normalize();\r\n            this.velocity.addScaledVector(deltaVector, -deltaVector.dot(this.velocity));\r\n\r\n        } else {\r\n            this.velocity.set(0, 0, 0);\r\n        }\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/entities/CapsuleEntity.js?");

/***/ }),

/***/ "./src/entities/PlayerLocal.js":
/*!*************************************!*\
  !*** ./src/entities/PlayerLocal.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"PlayerLocal\": () => (/* binding */ PlayerLocal)\n/* harmony export */ });\n/* harmony import */ var _CapsuleEntity_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./CapsuleEntity.js */ \"./src/entities/CapsuleEntity.js\");\n/* harmony import */ var _util_PointerLockControls_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../util/PointerLockControls.js */ \"./src/util/PointerLockControls.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js\");\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n/* harmony import */ var _AvatarController_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./AvatarController.js */ \"./src/entities/AvatarController.js\");\n/* harmony import */ var _UserInterface_UiElements_Common_Joystick_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../UserInterface/UiElements/Common/Joystick.js */ \"./src/UserInterface/UiElements/Common/Joystick.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass PlayerLocal extends _CapsuleEntity_js__WEBPACK_IMPORTED_MODULE_0__.CapsuleEntity {\r\n    constructor(params, camera, loadingManager) {\r\n        super(5, 30);\r\n        this.spawnPoint = typeof params.spawn === \"undefined\" ? {x: 0, y:0, z:0} : params.spawn;\r\n        this.position.x = this.spawnPoint.x;\r\n        this.position.y = this.spawnPoint.y;\r\n        this.position.z = this.spawnPoint.z;\r\n\r\n\r\n        this.camera = camera;\r\n        this.fpsControls = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_3__.Vector4(0.01, Math.PI - 0.01, 0.01, 1);\r\n        this.thirdPersonControls = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_3__.Vector4(Math.PI / 3, Math.PI / 2 - 0.01, 40, 0.2);\r\n        this.controlVector = this.thirdPersonControls.clone();\r\n        this.targetControlVector = this.thirdPersonControls;\r\n        this.horizontalVelocity = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_3__.Vector3();\r\n        this.playerDirection = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_3__.Vector3();\r\n        this.positionChange = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_3__.Vector3();\r\n        this.keys = {};\r\n\r\n        this.speedFactor = 0.03; // 1 is the default walk speed\r\n        this.visible = false;\r\n        \r\n        this.avatarController = new _AvatarController_js__WEBPACK_IMPORTED_MODULE_4__.AvatarController(loadingManager);\r\n        this.avatarController.spawnAvatar(params);\r\n        this.setupControls(this.camera);\r\n    }\r\n\r\n    setupControls() {\r\n        if(VIRTUAL_ENVIRONMENT.touch) {\r\n            this.speedFactor = 0.03;\r\n            this.joystick = new _UserInterface_UiElements_Common_Joystick_js__WEBPACK_IMPORTED_MODULE_5__.Joystick(this);\r\n            this.joystick.init();\r\n            this.setupTouchControls()\r\n        }else {\r\n            this.speedFactor = 1;\r\n            this.setupKeyControls()\r\n        }\r\n    }\r\n\r\n    setupTouchControls() {\r\n        this.controls = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_2__.OrbitControls(this.camera, VIRTUAL_ENVIRONMENT.labelRenderer.domElement);\r\n        this.controls.minPolarAngle = 0.01; \r\n        this.controls.maxPolarAngle = Math.PI - 0.25;\r\n        this.controls.target.set( this.camera.position.x , this.camera.position.y, this.camera.position.z );\r\n        this.controls.update();\r\n    }\r\n\r\n    setupKeyControls() {\r\n        this.controls = new _util_PointerLockControls_js__WEBPACK_IMPORTED_MODULE_1__.PointerLockControls(this.camera, VIRTUAL_ENVIRONMENT.labelRenderer.domElement);\r\n        this.controls.sensitivityY = -0.002;\r\n        this.controls.minPolarAngle = 0.01; \r\n        this.controls.maxPolarAngle = Math.PI - 0.25;\r\n        MAIN_SCENE.add(this.controls.getObject());\r\n\r\n        document.addEventListener('keyup', (event) => {\r\n            delete this.keys[event.key.toLowerCase()];\r\n        });\r\n        document.addEventListener('keydown', (event) => {\r\n            if(this.controls.isLocked) {\r\n                if (event.key === \"v\") {\r\n                    if (this.targetControlVector === this.thirdPersonControls) {\r\n                        this.targetControlVector = this.fpsControls;\r\n                    } else {\r\n                        this.targetControlVector = this.thirdPersonControls;\r\n                    }\r\n                }\r\n                if (event.keyCode === 32 && event.target === document.body) {\r\n                    event.preventDefault();\r\n                }\r\n                this.keys[event.key.toLowerCase()] = true;\r\n            }\r\n        });\r\n\r\n        window.addEventListener('keydown', (event) => {\r\n\r\n        });\r\n\r\n        this.controls.addEventListener('unlock', () => {\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleControlsUnlock()\r\n        });\r\n    }\r\n    \r\n    getForwardVector() {\r\n        this.camera.getWorldDirection(this.playerDirection);\r\n        this.playerDirection.y = 0;\r\n        this.playerDirection.normalize();\r\n        this.playerDirection.multiplyScalar(-1);\r\n        return this.playerDirection;\r\n    }\r\n    \r\n    getSideVector() {\r\n        this.camera.getWorldDirection(this.playerDirection);\r\n        this.playerDirection.y = 0;\r\n        this.playerDirection.normalize();\r\n        this.playerDirection.cross(this.camera.up);\r\n        this.playerDirection.multiplyScalar(-1);\r\n        return this.playerDirection;\r\n    }\r\n\r\n    update(delta, collider) {\r\n        if(VIRTUAL_ENVIRONMENT.touch) {\r\n            this.updateTouchControl(delta, collider);\r\n        }else {\r\n            this.updateKeyControl(delta, collider);\r\n        }\r\n    }\r\n\r\n    updateTouchControl(delta, collider) {\r\n        if(!this.avatarController.model) return;\r\n        \r\n        this.joystick.updatePlayer();\r\n        this.controls.update();\r\n\r\n        for(let i=0; i<5; i++){\r\n            super.update(delta/5, collider);\r\n        }\r\n\r\n        if (this.position.y < -1000) {\r\n            this.position.set(this.spawnPoint.x, this.spawnPoint.y, this.spawnPoint.z);\r\n            this.velocity = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_3__.Vector3();\r\n        }\r\n\r\n        if(typeof this.avatarController !== \"undefined\"){\r\n            this.avatarController.update(delta, this.position, this.horizontalVelocity, this.currentAnimation, this.currentAnimationTime);\r\n            this.avatarController.opacity = (this.controlVector.z - 0.01) / (40 - 0.01);\r\n        }\r\n\r\n    }\r\n\r\n    updateKeyControl(delta, collider) {\r\n\r\n        if(Object.keys(this.keys).length > 0){\r\n            // speedFactor depending on the run/walk state\r\n            this.speedFactor = this.keys[\"shift\"] ? 3 : 1;\r\n\r\n            if (this.keys[\"w\"]) {\r\n                this.horizontalVelocity.add(this.getForwardVector(this.camera).multiplyScalar(this.speedFactor * delta));\r\n            }\r\n\r\n            if (this.keys[\"s\"]) {\r\n                this.horizontalVelocity.add(this.getForwardVector(this.camera).multiplyScalar(-this.speedFactor * delta));\r\n            }\r\n\r\n            if (this.keys[\"a\"]) {\r\n                this.horizontalVelocity.add(this.getSideVector(this.camera).multiplyScalar(-this.speedFactor * delta));\r\n            }\r\n\r\n            if (this.keys[\"d\"]) {\r\n                this.horizontalVelocity.add(this.getSideVector(this.camera).multiplyScalar(this.speedFactor * delta));\r\n            }\r\n            if (this.keys[\" \"] && this.onGround) {\r\n                this.velocity.y = 150.0;\r\n                this.setAnimationParameters(\"jump\", 0);\r\n            }\r\n        } else {\r\n            this.horizontalVelocity.multiplyScalar(0);\r\n        }\r\n\r\n        \r\n        for(let i=0; i<5; i++){\r\n            super.update(delta/5, collider);\r\n        }\r\n       \r\n\r\n        if (this.position.y < -1000) {\r\n            this.position.set(this.spawnPoint.x, this.spawnPoint.y, this.spawnPoint.z);\r\n            this.velocity = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_3__.Vector3();\r\n        }\r\n\r\n        this.updateCurrentAnimation()\r\n        if(typeof this.avatarController !== \"undefined\"){\r\n            this.avatarController.update(delta, this.position, this.horizontalVelocity, this.currentAnimation, this.currentAnimationTime);\r\n            this.avatarController.opacity = (this.controlVector.z - 0.01) / (40 - 0.01);\r\n        }\r\n\r\n        this.controlVector.lerp(this.targetControlVector, 0.1);\r\n    }\r\n\r\n    updateCurrentAnimation() {\r\n        if (this.lastPosition) {\r\n            this.positionChange.multiplyScalar(0.8);\r\n            this.positionChange.addScaledVector(this.position.clone().sub(this.lastPosition), 0.2);\r\n        }\r\n        this.lastPosition = this.position.clone();\r\n\r\n        if(this.onGround) {\r\n            if (this.keys[\"w\"] || this.keys[\"s\"] || this.keys[\"a\"] || this.keys[\"d\"]) {\r\n                if(this.keys[\"shift\"]){ \r\n                    this.setAnimationParameters(\"run\"); \r\n                } else { \r\n                    this.setAnimationParameters(\"walk\"); \r\n                }\r\n            } else {\r\n                this.setAnimationParameters(\"idle\");\r\n            }\r\n        } else {\r\n            if(this.positionChange.y < -3) {\r\n                this.setAnimationParameters(\"fall\", 0.25);\r\n            }\r\n        }\r\n    }\r\n\r\n    setAnimationParameters(anim, time = 0.5) {\r\n        this.currentAnimation = anim;\r\n        this.currentAnimationTime = time;\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/entities/PlayerLocal.js?");

/***/ }),

/***/ "./src/render/AOShader.js":
/*!********************************!*\
  !*** ./src/render/AOShader.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"AOShader\": () => (/* binding */ AOShader)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n\r\n\r\nvar AOShader = {\r\n\r\n    uniforms: {\r\n\r\n        'sceneDepth': { value: null },\r\n        'tDiffuse': { value: null },\r\n        'projectionMatrixInv': { value: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4() },\r\n        'viewMatrixInv': { value: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4() },\r\n        'viewMat': { value: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4() },\r\n        'projMat': { value: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4() },\r\n        'cameraPos': { value: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3() },\r\n        'resolution': { value: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2() },\r\n        'time': { value: 0.0 }\r\n    },\r\n\r\n    vertexShader: /* glsl */ `\r\n\t\tvarying vec2 vUv;\r\n\t\tvoid main() {\r\n\t\t\tvUv = uv;\r\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\t\t}`,\r\n\r\n    fragmentShader: /* glsl */ `\r\n\t\tuniform sampler2D sceneDepth;\r\n        uniform sampler2D tDiffuse;\r\n        uniform mat4 projectionMatrixInv;\r\n        uniform mat4 viewMatrixInv;\r\n        uniform mat4 viewMat;\r\n        uniform mat4 projMat;\r\n        uniform vec3 cameraPos;\r\n        uniform vec2 resolution;\r\n        uniform float time;\r\n        varying vec2 vUv;\r\n        #define NUM_SAMPLES 24\r\n        #define NUM_RINGS 11\r\n        #define PI2 6.283185307179586\r\n        float rand(vec2 n) { \r\n          return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\r\n        }\r\n        vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\r\n        float permute(float x){return floor(mod(((x*34.0)+1.0)*x, 289.0));}\r\n        vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\r\n        float taylorInvSqrt(float r){return 1.79284291400159 - 0.85373472095314 * r;}\r\n        \r\n        vec4 grad4(float j, vec4 ip){\r\n          const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\r\n          vec4 p,s;\r\n        \r\n          p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\r\n          p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\r\n          s = vec4(lessThan(p, vec4(0.0)));\r\n          p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www; \r\n        \r\n          return p;\r\n        }\r\n        \r\n        float snoise(vec4 v){\r\n          const vec2  C = vec2( 0.138196601125010504,  // (5 - sqrt(5))/20  G4\r\n                                0.309016994374947451); // (sqrt(5) - 1)/4   F4\r\n        // First corner\r\n          vec4 i  = floor(v + dot(v, C.yyyy) );\r\n          vec4 x0 = v -   i + dot(i, C.xxxx);\r\n        \r\n        // Other corners\r\n        \r\n        // Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\r\n          vec4 i0;\r\n        \r\n          vec3 isX = step( x0.yzw, x0.xxx );\r\n          vec3 isYZ = step( x0.zww, x0.yyz );\r\n        //  i0.x = dot( isX, vec3( 1.0 ) );\r\n          i0.x = isX.x + isX.y + isX.z;\r\n          i0.yzw = 1.0 - isX;\r\n        \r\n        //  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\r\n          i0.y += isYZ.x + isYZ.y;\r\n          i0.zw += 1.0 - isYZ.xy;\r\n        \r\n          i0.z += isYZ.z;\r\n          i0.w += 1.0 - isYZ.z;\r\n        \r\n          // i0 now contains the unique values 0,1,2,3 in each channel\r\n          vec4 i3 = clamp( i0, 0.0, 1.0 );\r\n          vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\r\n          vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\r\n        \r\n          //  x0 = x0 - 0.0 + 0.0 * C \r\n          vec4 x1 = x0 - i1 + 1.0 * C.xxxx;\r\n          vec4 x2 = x0 - i2 + 2.0 * C.xxxx;\r\n          vec4 x3 = x0 - i3 + 3.0 * C.xxxx;\r\n          vec4 x4 = x0 - 1.0 + 4.0 * C.xxxx;\r\n        \r\n        // Permutations\r\n          i = mod(i, 289.0); \r\n          float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\r\n          vec4 j1 = permute( permute( permute( permute (\r\n                     i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\r\n                   + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\r\n                   + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\r\n                   + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\r\n        // Gradients\r\n        // ( 7*7*6 points uniformly over a cube, mapped onto a 4-octahedron.)\r\n        // 7*7*6 = 294, which is close to the ring size 17*17 = 289.\r\n        \r\n          vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\r\n        \r\n          vec4 p0 = grad4(j0,   ip);\r\n          vec4 p1 = grad4(j1.x, ip);\r\n          vec4 p2 = grad4(j1.y, ip);\r\n          vec4 p3 = grad4(j1.z, ip);\r\n          vec4 p4 = grad4(j1.w, ip);\r\n        \r\n        // Normalise gradients\r\n          vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\r\n          p0 *= norm.x;\r\n          p1 *= norm.y;\r\n          p2 *= norm.z;\r\n          p3 *= norm.w;\r\n          p4 *= taylorInvSqrt(dot(p4,p4));\r\n        \r\n        // Mix contributions from the five corners\r\n          vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\r\n          vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\r\n          m0 = m0 * m0;\r\n          m1 = m1 * m1;\r\n          return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\r\n                       + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\r\n        \r\n        }\r\n        float FBM(vec4 p) {\r\n          float value = 0.0;\r\n          float amplitude = 0.5;\r\n          float frequency = 0.0;\r\n          for (int i = 0; i < 6; ++i) {\r\n            value += amplitude * snoise(p);\r\n            p *= 2.0;\r\n            amplitude *= 0.5;\r\n          }\r\n          return value;\r\n        }\r\n        vec2 poissonDisk[NUM_SAMPLES];\r\n    \r\n    \r\n                    void initPoissonSamples(vec2 randomSeed ) {\r\n                        float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\r\n                        float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\r\n    \r\n                        // jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/\r\n                        float angle = rand( randomSeed ) * PI2;\r\n                        float radius = INV_NUM_SAMPLES;\r\n                        float radiusStep = radius;\r\n    \r\n                        for( int i = 0; i < NUM_SAMPLES; i ++ ) {\r\n                            poissonDisk[i] = vec2( cos( angle ), sin( angle ) ) * pow( radius, 0.75 );\r\n                            radius += radiusStep;\r\n                            angle += ANGLE_STEP;\r\n                        }\r\n                    }\r\n        float linearize_depth(float d,float zNear,float zFar)\r\n        {\r\n            return zNear * zFar / (zFar + d * (zNear - zFar));\r\n        }\r\n        vec3 WorldPosFromDepth(float depth, vec2 coord) {\r\n          float z = depth * 2.0 - 1.0;\r\n          vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);\r\n          vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;\r\n          // Perspective division\r\n          viewSpacePosition /= viewSpacePosition.w;\r\n          vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;\r\n          return worldSpacePosition.xyz;\r\n      }\r\n      vec3 computeNormal(vec3 worldPos, vec2 vUv) {\r\n        vec2 downUv = vUv + vec2(0.0, 1.0 / resolution.y);\r\n        vec3 downPos = WorldPosFromDepth( texture2D(sceneDepth, downUv).x, downUv);\r\n        vec2 rightUv = vUv + vec2(1.0 / resolution.x, 0.0);;\r\n        vec3 rightPos = WorldPosFromDepth(texture2D(sceneDepth, rightUv).x, rightUv);\r\n        vec2 upUv = vUv - vec2(0.0, 1.0 / resolution.y);\r\n        vec3 upPos = WorldPosFromDepth(texture2D(sceneDepth, upUv).x, upUv);\r\n        vec2 leftUv = vUv - vec2(1.0 / resolution.x, 0.0);;\r\n        vec3 leftPos = WorldPosFromDepth(texture2D(sceneDepth, leftUv).x, leftUv);\r\n        int hChoice;\r\n        int vChoice;\r\n        if (length(leftPos - worldPos) < length(rightPos - worldPos)) {\r\n          hChoice = 0;\r\n        } else {\r\n          hChoice = 1;\r\n        }\r\n        if (length(upPos - worldPos) < length(downPos - worldPos)) {\r\n          vChoice = 0;\r\n        } else {\r\n          vChoice = 1;\r\n        }\r\n        vec3 hVec;\r\n        vec3 vVec;\r\n        if (hChoice == 0 && vChoice == 0) {\r\n          hVec = leftPos - worldPos;\r\n          vVec = upPos - worldPos;\r\n        } else if (hChoice == 0 && vChoice == 1) {\r\n          hVec = leftPos - worldPos;\r\n          vVec = worldPos - downPos;\r\n        } else if (hChoice == 1 && vChoice == 1) {\r\n          hVec = rightPos - worldPos;\r\n          vVec = downPos - worldPos;\r\n        } else if (hChoice == 1 && vChoice == 0) {\r\n          hVec = rightPos - worldPos;\r\n          vVec = worldPos - upPos;\r\n        }\r\n        return normalize(cross(hVec, vVec));\r\n      }\r\n\t\tvoid main() {\r\n            vec4 texel = texture2D( tDiffuse, vUv );\r\n            float d = texture2D( sceneDepth, vUv ).x;\r\n            float depth = linearize_depth(d, 0.1, 2000.0);\r\n            float depth_Diff = 0.0;\r\n            float count = 0.0;\r\n            vec3 worldPos = WorldPosFromDepth(d, vUv);\r\n            vec3 fogDirection = normalize(worldPos - cameraPos);\r\n            vec3 fogOrigin = cameraPos;\r\n            float fogDepth = length(worldPos - fogOrigin);\r\n            // f(p) = fbm( p + fbm( p ) )\r\n            vec4 noiseSampleCoord = vec4(worldPos * 0.00025, time * 0.02);\r\n            float noiseSample = FBM(noiseSampleCoord + FBM(noiseSampleCoord)) * 0.5 + 0.5;\r\n            fogDepth *= mix(noiseSample, 1.0, clamp((fogDepth - 5000.0) / 5000.0, 0.0, 1.0));\r\n            fogDepth *= fogDepth;\r\n            float fogDensity = 0.000025;\r\n            float heightFactor = 0.1;\r\n            float fogFactor = heightFactor * exp(-fogOrigin.y * fogDensity) * (\r\n                1.0 - exp(-fogDepth * fogDirection.y * fogDensity)) / fogDirection.y;\r\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\r\n            initPoissonSamples(worldPos.xy + worldPos.z);\r\n            for(int i = 0; i < NUM_SAMPLES; i++) {\r\n                    // color += weight * texture2D(uSampler, vTextureCoord + vec2(0.002 * i, 0.002 * j)).xyz;\r\n                    vec2 sampleCoord = vUv + vec2((1.0 / resolution.x), (1.0 / resolution.y)) * poissonDisk[i] * 16.0;\r\n                    float tempdiff = (depth - linearize_depth(texture2D(sceneDepth, sampleCoord).x, 0.1, 2000.0));\r\n                        tempdiff /= depth;\r\n                        if (tempdiff * depth < depth * 0.1 && tempdiff < 2.0) {\r\n                            if (tempdiff < 0.05) {\r\n                                depth_Diff += tempdiff;\r\n                            } else {\r\n                                depth_Diff += tempdiff * (1.0 - ((tempdiff - 0.05) / 0.05));\r\n                            }\r\n                            count += 1.0;\r\n                        }\r\n              }\r\n            depth_Diff /= count;\r\n            depth_Diff = max(min(depth_Diff, 0.05), 0.0);\r\n            gl_FragColor = vec4(mix(texel.rgb * vec3(1.0 - 20.0 * depth_Diff), vec3(0.804, 0.754, 0.838), fogFactor), 1.0);\r\n\r\n\t\t}`\r\n\r\n};\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/render/AOShader.js?");

/***/ }),

/***/ "./src/render/BloomAddShader.js":
/*!**************************************!*\
  !*** ./src/render/BloomAddShader.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"BloomAddShader\": () => (/* binding */ BloomAddShader)\n/* harmony export */ });\nvar BloomAddShader = {\r\n\r\n    uniforms: {\r\n\r\n        'sceneDiffuse': { value: null },\r\n        'tDiffuse': { value: null },\r\n        'bloomAmt': { value: null }\r\n    },\r\n\r\n    vertexShader: /* glsl */ `\r\n\t\tvarying vec2 vUv;\r\n\t\tvoid main() {\r\n\t\t\tvUv = uv;\r\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\t\t}`,\r\n\r\n    fragmentShader: /* glsl */ `\r\n\t\tuniform float opacity;\r\n        uniform float bloomAmt;\r\n\t\tuniform sampler2D sceneDiffuse;\r\n        uniform sampler2D tDiffuse;\r\n\t\tvarying vec2 vUv;\r\n\t\tvoid main() {\r\n\t\t\tvec4 texel = texture2D( sceneDiffuse, vUv );\r\n            vec4 bloomTexel = texture2D( tDiffuse, vUv );\r\n            gl_FragColor = texel + bloomTexel;\r\n\t\t}`\r\n\r\n};\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/render/BloomAddShader.js?");

/***/ }),

/***/ "./src/render/BloomShader.js":
/*!***********************************!*\
  !*** ./src/render/BloomShader.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"BloomShader\": () => (/* binding */ BloomShader)\n/* harmony export */ });\nvar BloomShader = {\r\n\r\n    uniforms: {\r\n\r\n        'sceneDiffuse': { value: null },\r\n        'sceneDepth': { value: null },\r\n        'bloomDiffuse': { value: null },\r\n        'bloomDepth': { value: null }\r\n    },\r\n\r\n    vertexShader: /* glsl */ `\r\n\t\tvarying vec2 vUv;\r\n\t\tvoid main() {\r\n\t\t\tvUv = uv;\r\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\t\t}`,\r\n\r\n    fragmentShader: /* glsl */ `\r\n\t\tuniform float opacity;\r\n\t\tuniform sampler2D sceneDiffuse;\r\n        uniform sampler2D bloomDiffuse;\r\n        uniform sampler2D sceneDepth;\r\n        uniform sampler2D bloomDepth;\r\n\t\tvarying vec2 vUv;\r\n\t\tvoid main() {\r\n\t\t\tvec4 texel = texture2D( bloomDiffuse, vUv );\r\n            float bloomDepthAmt = texture2D( bloomDepth, vUv ).x;\r\n            float sceneDepthAmt = texture2D( sceneDepth, vUv ).x;\r\n            if (bloomDepthAmt <= sceneDepthAmt) {\r\n                gl_FragColor = texel;\r\n            } else {\r\n                gl_FragColor = vec4(vec3(0.0), 1.0);\r\n            }\r\n\t\t}`\r\n\r\n};\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/render/BloomShader.js?");

/***/ }),

/***/ "./src/render/BoxBlurShader.js":
/*!*************************************!*\
  !*** ./src/render/BoxBlurShader.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"BoxBlurShader\": () => (/* binding */ BoxBlurShader)\n/* harmony export */ });\nvar BoxBlurShader = {\r\n\r\n    uniforms: {\r\n\r\n        'tDiffuse': { value: null },\r\n        'resolution': { value: null }\r\n\r\n    },\r\n\r\n    vertexShader: /* glsl */ `\r\n\t\tvarying vec2 vUv;\r\n\t\tvoid main() {\r\n\t\t\tvUv = uv;\r\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\t\t}`,\r\n\r\n    fragmentShader: /* glsl */ `\r\n\t\tuniform float opacity;\r\n\t\tuniform sampler2D tDiffuse;\r\n        uniform vec2 resolution;\r\n\t\tvarying vec2 vUv;\r\n\t\tvoid main() {\r\n            const float directions = 16.0;\r\n            const float quality = 6.0;\r\n            const float size = 16.0;\r\n            const float pi = 3.14159;\r\n            vec2 radius = size/resolution;\r\n\t\t\tvec4 color = texture2D( tDiffuse, vUv );\r\n            for(float d =0.0; d < pi * 2.0; d+=(pi * 2.0) / directions) {\r\n                for(float i = 1.0/quality; i<=1.0; i+=1.0/quality) {\r\n                    color += texture2D(tDiffuse, vUv+vec2(cos(d), sin(d)) * radius * i);\r\n                }\r\n            }\r\n            color /= quality * directions - 15.0;\r\n\t\t\tgl_FragColor = color;\r\n\t\t}`\r\n\r\n};\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/render/BoxBlurShader.js?");

/***/ }),

/***/ "./src/render/DefaultComposer.js":
/*!***************************************!*\
  !*** ./src/render/DefaultComposer.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"DefaultComposer\": () => (/* binding */ DefaultComposer)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_EffectComposer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/EffectComposer.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/EffectComposer.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_RenderPass_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/RenderPass.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/RenderPass.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_ShaderPass_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/ShaderPass.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/ShaderPass.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_FilmPass_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/FilmPass.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/FilmPass.js\");\n/* harmony import */ var https_unpkg_com_three_0_137_0_examples_jsm_postprocessing_SMAAPass_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! https://unpkg.com/three@0.137.0/examples/jsm/postprocessing/SMAAPass.js */ \"https://unpkg.com/three@0.137.0/examples/jsm/postprocessing/SMAAPass.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_shaders_FXAAShader_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/shaders/FXAAShader.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/shaders/FXAAShader.js\");\n/* harmony import */ var _BloomShader_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./BloomShader.js */ \"./src/render/BloomShader.js\");\n/* harmony import */ var _BoxBlurShader_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./BoxBlurShader.js */ \"./src/render/BoxBlurShader.js\");\n/* harmony import */ var _BloomAddShader_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./BloomAddShader.js */ \"./src/render/BloomAddShader.js\");\n/* harmony import */ var _FogShader_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./FogShader.js */ \"./src/render/FogShader.js\");\n/* harmony import */ var _AOShader_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./AOShader.js */ \"./src/render/AOShader.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst LOW = 0;\r\nconst MEDIUM = 1;\r\nconst HIGH = 2;\r\nconst ULTRA = 3;\r\n\r\nlet bloomPass, boxBlur, bloomAddPass, aoPass, fogPass, smaaPass, fxaaPass, filmPass, renderPass, bloomTexture;\r\n\r\nclass DefaultComposer extends https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_EffectComposer_js__WEBPACK_IMPORTED_MODULE_1__.EffectComposer {\r\n    constructor(renderer, scene, camera) {\r\n        super(renderer);\r\n\r\n        bloomPass = new(class BloomPass extends https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_ShaderPass_js__WEBPACK_IMPORTED_MODULE_3__.ShaderPass {})(_BloomShader_js__WEBPACK_IMPORTED_MODULE_7__.BloomShader);\r\n        boxBlur = new(class BlurPass extends https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_ShaderPass_js__WEBPACK_IMPORTED_MODULE_3__.ShaderPass {})(_BoxBlurShader_js__WEBPACK_IMPORTED_MODULE_8__.BoxBlurShader);\r\n        bloomAddPass = new(class AddPass extends https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_ShaderPass_js__WEBPACK_IMPORTED_MODULE_3__.ShaderPass {})(_BloomAddShader_js__WEBPACK_IMPORTED_MODULE_9__.BloomAddShader);\r\n        aoPass = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_ShaderPass_js__WEBPACK_IMPORTED_MODULE_3__.ShaderPass(_AOShader_js__WEBPACK_IMPORTED_MODULE_11__.AOShader);\r\n        fogPass = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_ShaderPass_js__WEBPACK_IMPORTED_MODULE_3__.ShaderPass(_FogShader_js__WEBPACK_IMPORTED_MODULE_10__.FogShader);\r\n        fxaaPass = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_ShaderPass_js__WEBPACK_IMPORTED_MODULE_3__.ShaderPass(https_cdn_skypack_dev_three_0_136_0_examples_jsm_shaders_FXAAShader_js__WEBPACK_IMPORTED_MODULE_6__.FXAAShader);\r\n        // Postprocessing gets rid of MSAA so SMAA is used instead\r\n        smaaPass = new https_unpkg_com_three_0_137_0_examples_jsm_postprocessing_SMAAPass_js__WEBPACK_IMPORTED_MODULE_5__.SMAAPass(window.innerWidth, window.innerHeight);\r\n        filmPass = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_FilmPass_js__WEBPACK_IMPORTED_MODULE_4__.FilmPass(0.05, 0, 0, false);\r\n        renderPass = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_RenderPass_js__WEBPACK_IMPORTED_MODULE_2__.RenderPass(scene, camera);\r\n        this.addPass(bloomPass);\r\n        this.addPass(boxBlur);\r\n        this.addPass(bloomAddPass);\r\n        this.addPass(aoPass);\r\n        this.addPass(smaaPass);\r\n        this.addPass(fxaaPass);\r\n        this.addPass(renderPass);\r\n        // Full Scene Render Target\r\n\r\n        this.defaultTexture = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.WebGLRenderTarget(window.innerWidth, window.innerHeight, {\r\n            minFilter: https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.LinearFilter,\r\n            magFilter: https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.NearestFilter\r\n        });\r\n        this.defaultTexture.depthTexture = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.DepthTexture(window.innerWidth, window.innerHeight, https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.FloatType);\r\n\r\n        // Bloom Scene (Only Glowing Objects) Render Target\r\n        this.bloomTexture = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.WebGLRenderTarget(window.innerWidth, window.innerHeight, {\r\n            minFilter: https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.LinearFilter,\r\n            magFilter: https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.NearestFilter\r\n        });\r\n        this.bloomTexture.depthTexture = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.DepthTexture(window.innerWidth, window.innerHeight, https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.FloatType);\r\n\r\n        this.setGraphicsSetting = function(tier, renderer, scene) {\r\n            switch (tier) {\r\n                case ULTRA:\r\n                    aoPass.enabled = true;\r\n                    smaaPass.enabled = true;\r\n                    fxaaPass.enabled = false;\r\n                    bloomPass.enabled = true;\r\n                    boxBlur.enabled = true;\r\n                    bloomAddPass.enabled = true;\r\n                    renderPass.enabled = false;\r\n                    renderer.shadowMap.enabled = true;\r\n                    scene.fog.color = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Color(0x69e6f4);\r\n                    scene.fog.near = 1600;\r\n                    scene.fog.far = 2000;\r\n                    break;\r\n\r\n                case HIGH:\r\n                    aoPass.enabled = false;\r\n                    smaaPass.enabled = true;\r\n                    fxaaPass.enabled = false;\r\n                    bloomPass.enabled = true;\r\n                    boxBlur.enabled = true;\r\n                    bloomAddPass.enabled = true;\r\n                    renderPass.enabled = false;\r\n                    renderer.shadowMap.enabled = true;\r\n                    scene.fog.color = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Color(0.8, 0.8, 0.8);\r\n                    scene.fog.near = 100;\r\n                    scene.fog.far = 1500;\r\n                    break;\r\n\r\n                case MEDIUM:\r\n                    aoPass.enabled = false;\r\n                    smaaPass.enabled = false;\r\n                    fxaaPass.enabled = true;\r\n                    bloomPass.enabled = true;\r\n                    boxBlur.enabled = true;\r\n                    bloomAddPass.enabled = true;\r\n                    renderPass.enabled = false;\r\n                    renderer.shadowMap.enabled = true;\r\n                    scene.fog.color = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Color(0.8, 0.8, 0.8);\r\n                    scene.fog.near = 100;\r\n                    scene.fog.far = 1500;\r\n                    break;\r\n\r\n                case LOW:\r\n                    aoPass.enabled = false;\r\n                    smaaPass.enabled = false;\r\n                    fxaaPass.enabled = false;\r\n                    bloomPass.enabled = false;\r\n                    boxBlur.enabled = false;\r\n                    bloomAddPass.enabled = false;\r\n                    renderPass.enabled = true;\r\n                    renderer.shadowMap.enabled = false;\r\n                    scene.fog.color = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Color(0.8, 0.8, 0.8);\r\n                    scene.fog.near = 100;\r\n                    scene.fog.far = 1500;\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    update(camera) {\r\n        bloomPass.uniforms[\"sceneDiffuse\"].value = this.defaultTexture.texture;\r\n        bloomPass.uniforms[\"bloomDiffuse\"].value = this.bloomTexture.texture;\r\n        bloomPass.uniforms[\"sceneDepth\"].value = this.defaultTexture.depthTexture;\r\n        bloomPass.uniforms[\"bloomDepth\"].value = this.bloomTexture.depthTexture;\r\n        boxBlur.uniforms[\"resolution\"].value = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2(window.innerWidth, window.innerHeight);\r\n        bloomAddPass.uniforms[\"sceneDiffuse\"].value = this.defaultTexture.texture;\r\n        bloomAddPass.uniforms[\"bloomAmt\"].value = 1.0;\r\n        fogPass.uniforms[\"sceneDepth\"].value = this.defaultTexture.depthTexture;\r\n        camera.updateMatrixWorld();\r\n        fogPass.uniforms[\"projectionMatrixInv\"].value = camera.projectionMatrixInverse;\r\n        fogPass.uniforms[\"viewMatrixInv\"].value = camera.matrixWorld;\r\n        fogPass.uniforms[\"cameraPos\"].value = camera.position;\r\n        fogPass.uniforms[\"time\"].value = performance.now() / 1000;\r\n        aoPass.uniforms[\"sceneDepth\"].value = this.defaultTexture.depthTexture;\r\n        aoPass.uniforms[\"projectionMatrixInv\"].value = camera.projectionMatrixInverse;\r\n        aoPass.uniforms[\"viewMatrixInv\"].value = camera.matrixWorld;\r\n        aoPass.uniforms[\"viewMat\"].value = camera.matrixWorldInverse;\r\n        aoPass.uniforms[\"projMat\"].value = camera.projectionMatrix;\r\n        aoPass.uniforms[\"cameraPos\"].value = camera.position;\r\n        aoPass.uniforms[\"time\"].value = performance.now() / 1000;\r\n        aoPass.uniforms[\"resolution\"].value = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2(window.innerWidth, window.innerHeight);\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/render/DefaultComposer.js?");

/***/ }),

/***/ "./src/render/DefaultDirectionalLight.js":
/*!***********************************************!*\
  !*** ./src/render/DefaultDirectionalLight.js ***!
  \***********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"DefaultDirectionalLight\": () => (/* binding */ DefaultDirectionalLight)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n\r\n\r\nconst LOW = 0;\r\nconst MEDIUM = 1;\r\nconst HIGH = 2;\r\nconst ULTRA = 3;\r\n\r\nclass DefaultDirectionalLight extends https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.DirectionalLight {\r\n    constructor(graphicTier) {\r\n        super(0x8888ff, 1);\r\n\r\n        // default values\r\n        this.position.set(90, 360, 170 * 3);\r\n        this.castShadow = true;\r\n        this.shadow.camera.near = 0.1;\r\n        this.shadow.camera.far = 1000;\r\n        this.shadow.camera.right = 400;\r\n        this.shadow.camera.left = -400;\r\n        this.shadow.camera.top = 400;\r\n        this.shadow.camera.bottom = -400;\r\n        this.shadow.radius = 4;\r\n\r\n        switch (graphicTier) {\r\n            case ULTRA:\r\n                this.shadow.mapSize.width = 2048;\r\n                this.shadow.mapSize.height = 2048;\r\n                this.shadow.bias = -0.001;\r\n                break;\r\n\r\n            case HIGH:\r\n                this.shadow.mapSize.width = 1024;\r\n                this.shadow.mapSize.height = 1024;\r\n                this.shadow.bias = -0.0025;\r\n                break;\r\n\r\n            case MEDIUM:\r\n                this.shadow.mapSize.width = 512;\r\n                this.shadow.mapSize.height = 512;\r\n                this.shadow.bias = -0.005;\r\n                break;\r\n        }\r\n    }\r\n    update(camera) {\r\n        this.position.x = camera.position.x + 90;\r\n        this.position.y = 360;\r\n        this.position.z = camera.position.z + 170 * 3;\r\n        this.target.position.x = camera.position.x;\r\n        this.target.position.y = 0;\r\n        this.target.position.z = camera.position.z;\r\n        this.shadow.camera.updateProjectionMatrix();\r\n        this.updateMatrix();\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/render/DefaultDirectionalLight.js?");

/***/ }),

/***/ "./src/render/FogShader.js":
/*!*********************************!*\
  !*** ./src/render/FogShader.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"FogShader\": () => (/* binding */ FogShader)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n\r\n\r\nvar FogShader = {\r\n\r\n    uniforms: {\r\n\r\n        'sceneDepth': { value: null },\r\n        'tDiffuse': { value: null },\r\n        'projectionMatrixInv': { value: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4() },\r\n        'viewMatrixInv': { value: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4() },\r\n        'cameraPos': { value: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3() },\r\n        'time': { value: 0.0 }\r\n    },\r\n\r\n    vertexShader: /* glsl */ `\r\n\t\tvarying vec2 vUv;\r\n\t\tvoid main() {\r\n\t\t\tvUv = uv;\r\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\t\t}`,\r\n\r\n    fragmentShader: /* glsl */ `\r\n\t\tuniform sampler2D sceneDepth;\r\n        uniform sampler2D tDiffuse;\r\n        uniform mat4 projectionMatrixInv;\r\n        uniform mat4 viewMatrixInv;\r\n        uniform vec3 cameraPos;\r\n        uniform float time;\r\n        varying vec2 vUv;\r\n        vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}\r\n        float permute(float x){return floor(mod(((x*34.0)+1.0)*x, 289.0));}\r\n        vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}\r\n        float taylorInvSqrt(float r){return 1.79284291400159 - 0.85373472095314 * r;}\r\n        \r\n        vec4 grad4(float j, vec4 ip){\r\n          const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\r\n          vec4 p,s;\r\n        \r\n          p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\r\n          p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\r\n          s = vec4(lessThan(p, vec4(0.0)));\r\n          p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www; \r\n        \r\n          return p;\r\n        }\r\n        \r\n        float snoise(vec4 v){\r\n          const vec2  C = vec2( 0.138196601125010504,  // (5 - sqrt(5))/20  G4\r\n                                0.309016994374947451); // (sqrt(5) - 1)/4   F4\r\n        // First corner\r\n          vec4 i  = floor(v + dot(v, C.yyyy) );\r\n          vec4 x0 = v -   i + dot(i, C.xxxx);\r\n        \r\n        // Other corners\r\n        \r\n        // Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\r\n          vec4 i0;\r\n        \r\n          vec3 isX = step( x0.yzw, x0.xxx );\r\n          vec3 isYZ = step( x0.zww, x0.yyz );\r\n        //  i0.x = dot( isX, vec3( 1.0 ) );\r\n          i0.x = isX.x + isX.y + isX.z;\r\n          i0.yzw = 1.0 - isX;\r\n        \r\n        //  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\r\n          i0.y += isYZ.x + isYZ.y;\r\n          i0.zw += 1.0 - isYZ.xy;\r\n        \r\n          i0.z += isYZ.z;\r\n          i0.w += 1.0 - isYZ.z;\r\n        \r\n          // i0 now contains the unique values 0,1,2,3 in each channel\r\n          vec4 i3 = clamp( i0, 0.0, 1.0 );\r\n          vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\r\n          vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\r\n        \r\n          //  x0 = x0 - 0.0 + 0.0 * C \r\n          vec4 x1 = x0 - i1 + 1.0 * C.xxxx;\r\n          vec4 x2 = x0 - i2 + 2.0 * C.xxxx;\r\n          vec4 x3 = x0 - i3 + 3.0 * C.xxxx;\r\n          vec4 x4 = x0 - 1.0 + 4.0 * C.xxxx;\r\n        \r\n        // Permutations\r\n          i = mod(i, 289.0); \r\n          float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\r\n          vec4 j1 = permute( permute( permute( permute (\r\n                     i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\r\n                   + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\r\n                   + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\r\n                   + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\r\n        // Gradients\r\n        // ( 7*7*6 points uniformly over a cube, mapped onto a 4-octahedron.)\r\n        // 7*7*6 = 294, which is close to the ring size 17*17 = 289.\r\n        \r\n          vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\r\n        \r\n          vec4 p0 = grad4(j0,   ip);\r\n          vec4 p1 = grad4(j1.x, ip);\r\n          vec4 p2 = grad4(j1.y, ip);\r\n          vec4 p3 = grad4(j1.z, ip);\r\n          vec4 p4 = grad4(j1.w, ip);\r\n        \r\n        // Normalise gradients\r\n          vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\r\n          p0 *= norm.x;\r\n          p1 *= norm.y;\r\n          p2 *= norm.z;\r\n          p3 *= norm.w;\r\n          p4 *= taylorInvSqrt(dot(p4,p4));\r\n        \r\n        // Mix contributions from the five corners\r\n          vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\r\n          vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\r\n          m0 = m0 * m0;\r\n          m1 = m1 * m1;\r\n          return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\r\n                       + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\r\n        \r\n        }\r\n        float FBM(vec4 p) {\r\n          float value = 0.0;\r\n          float amplitude = 0.5;\r\n          float frequency = 0.0;\r\n          for (int i = 0; i < 6; ++i) {\r\n            value += amplitude * snoise(p);\r\n            p *= 2.0;\r\n            amplitude *= 0.5;\r\n          }\r\n          return value;\r\n        }\r\n        float linearize_depth(float d,float zNear,float zFar)\r\n        {\r\n            return zNear * zFar / (zFar + d * (zNear - zFar));\r\n        }\r\n        vec3 WorldPosFromDepth(float depth, vec2 coord) {\r\n          float z = depth * 2.0 - 1.0;\r\n          vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);\r\n          vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;\r\n          // Perspective division\r\n          viewSpacePosition /= viewSpacePosition.w;\r\n          vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;\r\n          return worldSpacePosition.xyz;\r\n      }\r\n\t\tvoid main() {\r\n            vec4 texel = texture2D( tDiffuse, vUv );\r\n            float depth = texture2D( sceneDepth, vUv ).x;\r\n            vec3 worldPos = WorldPosFromDepth(depth, vUv);\r\n            vec3 fogDirection = normalize(worldPos - cameraPos);\r\n            vec3 fogOrigin = cameraPos;\r\n            float fogDepth = length(worldPos - fogOrigin);\r\n            // f(p) = fbm( p + fbm( p ) )\r\n            vec4 noiseSampleCoord = vec4(worldPos * 0.00025, time * 0.02);\r\n            float noiseSample = FBM(noiseSampleCoord + FBM(noiseSampleCoord)) * 0.5 + 0.5;\r\n            fogDepth *= mix(noiseSample, 1.0, clamp((fogDepth - 5000.0) / 5000.0, 0.0, 1.0));\r\n            fogDepth *= fogDepth;\r\n            float fogDensity = 0.000025;\r\n            float heightFactor = 0.1;\r\n            float fogFactor = heightFactor * exp(-fogOrigin.y * fogDensity) * (\r\n                1.0 - exp(-fogDepth * fogDirection.y * fogDensity)) / fogDirection.y;\r\n            fogFactor = clamp(fogFactor, 0.0, 1.0);\r\n            gl_FragColor = vec4(mix(texel.rgb, vec3(0.8, 0.8, 0.8), fogFactor), 1.0);\r\n            /*if (length(worldPos) < 50.0) {\r\n              gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\r\n            } else {\r\n              gl_FragColor = texel;\r\n            }*/\r\n\r\n\t\t}`\r\n\r\n};\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/render/FogShader.js?");

/***/ }),

/***/ "./src/terrain/TerrainController.js":
/*!******************************************!*\
  !*** ./src/terrain/TerrainController.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"TerrainController\": () => (/* binding */ TerrainController)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_FBXLoader_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FBXLoader.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FBXLoader.js\");\n/* harmony import */ var https_cdn_skypack_dev_three_0_136_0_examples_jsm_utils_BufferGeometryUtils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! https://cdn.skypack.dev/three@0.136.0/examples/jsm/utils/BufferGeometryUtils.js */ \"https://cdn.skypack.dev/three@0.136.0/examples/jsm/utils/BufferGeometryUtils.js\");\n/* harmony import */ var _util_three_mesh_bvh_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../util/three-mesh-bvh.js */ \"./src/util/three-mesh-bvh.js\");\n/* harmony import */ var _TerrainGenerator_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./TerrainGenerator.js */ \"./src/terrain/TerrainGenerator.js\");\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass TerrainController {\r\n    \r\n    constructor(manager){\r\n        this.FBXLoader = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_FBXLoader_js__WEBPACK_IMPORTED_MODULE_2__.FBXLoader(manager);\r\n        this.GLTFLoader = new https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_GLTFLoader_js__WEBPACK_IMPORTED_MODULE_1__.GLTFLoader(manager);\r\n        this.terrain = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Object3D();\r\n        this.collider;\r\n        this.bloomScene = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Scene();\r\n        this.geometries = [];\r\n        \r\n    }\r\n\r\n    generateTerrain(seed) {\r\n        this.terrainGenerator = new _TerrainGenerator_js__WEBPACK_IMPORTED_MODULE_5__.TerrainGenerator(seed);\r\n        this.terrain = this.terrainGenerator.generateTerrain()\r\n    }\r\n\r\n    loadTerrain(URL, scene, x, y, z, format, scaleFactor){\r\n        switch (format) {\r\n            case \"fbx\":\r\n                this.FBXLoader.load(URL, (responseObject) => {\r\n                    this.handleLoadedTerrain(responseObject, scene, x, y, z, scaleFactor);\r\n                })\r\n                break;\r\n        \r\n            case \"glb\":\r\n                this.GLTFLoader.load(URL, (responseObject) => {\r\n                    this.handleLoadedTerrain(responseObject.scene, scene, x, y, z, scaleFactor);\r\n                })\r\n                break;\r\n        }\r\n    }\r\n\r\n    handleLoadedTerrain(terrain, scene, x, y, z, scaleFactor) {\r\n        console.log(terrain)\r\n        this.terrain = terrain;\r\n        this.terrain.position.set(x, y, z);\r\n        this.terrain.scale.set(scaleFactor, scaleFactor, scaleFactor)\r\n        this.terrain.traverse(object => {\r\n            if (object.isMesh) {\r\n                object.castShadow = true;\r\n                object.receiveShadow = true;\r\n                object.material.roughness = 1;\r\n                if (object.material.map) {\r\n                    object.material.map.anisotropy = 16;\r\n                    object.material.map.needsUpdate = true;\r\n                }\r\n                const cloned = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Mesh(object.geometry, object.material);\r\n                object.getWorldPosition(cloned.position);\r\n                if (object.material.emissive && (object.material.emissive.r > 0 || object.material.emissive.g > 0 || object.material.color.b > 0)) {\r\n                    this.bloomScene.attach(cloned);\r\n                }\r\n            }\r\n            if (object.isLight) {\r\n                object.parent.remove(object);\r\n            }\r\n        });\r\n\r\n        scene.add(this.terrain);\r\n        this.generateCollider(scene);\r\n    }\r\n\r\n    generateCollider(scene){\r\n        console.log(\"loading collider\")\r\n        this.terrain.traverse(object => {\r\n            if (object.geometry && object.visible) {\r\n                const cloned = object.geometry.clone();\r\n                cloned.applyMatrix4(object.matrixWorld);\r\n                for (const key in cloned.attributes) {\r\n                    if (key !== 'position') { cloned.deleteAttribute(key); }\r\n                }\r\n                this.geometries.push(cloned);\r\n            }\r\n        });\r\n        const mergedGeometry = https_cdn_skypack_dev_three_0_136_0_examples_jsm_utils_BufferGeometryUtils_js__WEBPACK_IMPORTED_MODULE_3__.mergeBufferGeometries(this.geometries, false);\r\n        mergedGeometry.boundsTree = new _util_three_mesh_bvh_js__WEBPACK_IMPORTED_MODULE_4__.MeshBVH(mergedGeometry, { lazyGeneration: false });\r\n        this.collider = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Mesh(mergedGeometry);\r\n        this.collider.material.wireframe = true;\r\n        this.collider.material.opacity = 0.5;\r\n        this.collider.material.transparent = true;\r\n        this.collider.visible = false; // toggle this value to see the collider\r\n        scene.add(this.collider);\r\n\r\n        /* The following lines of code are used to debug the BVH collider. \r\n         * Uncomment these lines to visualize the BVH collider. \r\n         * More information on Bounding Volume Hierarchy (BVH):\r\n         * https://en.wikipedia.org/wiki/Bounding_volume_hierarchy\r\n        */\r\n       \r\n        // const visualizer = new MeshBVHVisualizer(this.collider, 10);\r\n        // visualizer.visible = true;\r\n        // visualizer.update();\r\n        // scene.add(visualizer);\r\n    }\r\n\r\n    newSolidGeometriesFromSource(scene, url, x, y, z, scaleFactor) {\r\n        this.GLTFLoader.load(url, (responseObject) => {\r\n            setTimeout(() => {   \r\n                console.log(\"load new stuff\")\r\n                responseObject.scene.scale.set(3.75 * scaleFactor, 3.75 * scaleFactor, 3.75 * scaleFactor)\r\n                responseObject.scene.position.set(x,y,z)\r\n                scene.add(responseObject.scene)\r\n    \r\n                responseObject.scene.traverse((object) => {\r\n                    if(object.geometry && object.visible && object.position) {\r\n                        const cloned = object.geometry.clone();\r\n                        cloned.scale(3.75 * scaleFactor, 3.75 * scaleFactor, 3.75 * scaleFactor)\r\n                        cloned.translate(x, y + (-1 * scaleFactor),z)\r\n                        console.log(object.matrixWorld)\r\n                        object.updateMatrixWorld();\r\n                        cloned.applyMatrix4(object.matrixWorld);\r\n                        for (const key in cloned.attributes) {\r\n                            if (key !== 'position') { cloned.deleteAttribute(key); }\r\n                        }\r\n                        \r\n                        this.geometries.push(cloned);\r\n                    }\r\n                })\r\n                \r\n                this.generateCollider(scene)\r\n            }, 2000);\r\n            \r\n        })\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/terrain/TerrainController.js?");

/***/ }),

/***/ "./src/terrain/TerrainGenerator.js":
/*!*****************************************!*\
  !*** ./src/terrain/TerrainGenerator.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"TerrainGenerator\": () => (/* binding */ TerrainGenerator)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n/* harmony import */ var https_threejs_org_examples_jsm_math_ImprovedNoise_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! https://threejs.org/examples/jsm/math/ImprovedNoise.js */ \"https://threejs.org/examples/jsm/math/ImprovedNoise.js\");\n\r\n\r\n\r\nconst worldWidth = 256, worldDepth = 256;\r\n\r\nconst seedRandom = function(seed) {\r\n    var x = Math.sin(seed++) * 10000;\r\n    return x - Math.floor(x);\r\n}\r\n\r\nclass TerrainGenerator {\r\n    constructor(seed){\r\n        this.worldSeed = seed;\r\n    }\r\n\r\n    generateTerrain() {\r\n        const loader = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.TextureLoader();\r\n        loader.load('../../resources/textures/sand.jpg', (sand) => {\r\n            sand.wrapS = sand.wrapT = https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RepeatWrapping;\r\n            loader.load('../../resources/textures/grass.jpg', (grass) => {\r\n                loader.load('../../resources/textures/stone.jpg', (rock) => {\r\n                    loader.load('../../resources/textures/snow.jpg', (t4) => {\r\n                        \r\n                        const blend = this.generateBlendedMaterial([\r\n                            {texture: sand},\r\n                            {texture: grass, levels: [0, 10, 200, 225]},\r\n                            {texture: rock, levels: [200, 225, 275, 300]},\r\n                            {texture: t4, levels: [275, 300, 500, 500]},\r\n                            {texture: rock, glsl: 'slope > 0.6 ? 0.0 : 1.0 - smoothstep(0.3, 0.6, slope) + 0.2'},\r\n                        ]);\r\n\r\n                        const terrain = this.terrain({material: blend, seed: this.worldSeed})\r\n                        VIRTUAL_ENVIRONMENT.terrainController.terrain = terrain;\r\n                        MAIN_SCENE.add(terrain)\r\n                        VIRTUAL_ENVIRONMENT.terrainController.generateCollider(MAIN_SCENE);\r\n                    });\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    terrain(options) {\r\n        const defaultOptions = {\r\n            after: null,\r\n            easing: function(x){return x},\r\n            heightmap: this.diamondSquare,\r\n            material: null,\r\n            maxHeight: 350,\r\n            minHeight: -400,\r\n            optimization: 0,\r\n            frequency: 2.5,\r\n            steps: 8,\r\n            stretch: true,\r\n            turbulent: false,\r\n            useBufferGeometry: false,\r\n            xSegments: 127,\r\n            xSize: 4096,\r\n            ySegments: 127,\r\n            ySize: 4096,\r\n            _mesh: null, // internal only\r\n            seed: 100,\r\n        };\r\n        for (let opt in defaultOptions) {\r\n            options[opt] = typeof options[opt] === 'undefined' ? defaultOptions[opt] : options[opt];\r\n        }\r\n\r\n        // build the material\r\n        options.material = options.material || new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.MeshBasicMaterial({ color: 0xee6633 });\r\n    \r\n        const plane = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.PlaneGeometry(options.xSize, options.ySize, options.xSegments, options.ySegments)\r\n        // Planes are initialized on the XY plane, so rotate the plane to make it lie flat.\r\n        plane.rotateX(-Math.PI/2);\r\n    \r\n        // Create the terrain mesh.\r\n        var mesh = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Mesh( plane, options.material );\r\n        mesh.castShadow = true;\r\n        mesh.receiveShadow = true;\r\n    \r\n        // Assign elevation data to the terrain plane from a heightmap or function.\r\n        if (typeof options.heightmap === 'function') {\r\n            options.heightmap(mesh.geometry.attributes.position.array, options);\r\n        }\r\n        else {\r\n            console.warn('An invalid value was passed for `options.heightmap`: ' + options.heightmap);\r\n        }\r\n        this.normalize(mesh, options);\r\n    \r\n        return mesh;\r\n    };\r\n\r\n    /**\r\n     * Generate random terrain using the Diamond-Square method.\r\n     *\r\n     * Based on https://github.com/srchea/Terrain-Generation/blob/master/js/classes/TerrainGeneration.js\r\n     *\r\n     * @param {THREE.Vector3[]} positionArray\r\n     *   The vertex array for plane geometry to modify with heightmap data. This\r\n     *   method sets the `z` property of each vertex.\r\n     * @param {Object} options\r\n     *   A map of settings that control how the terrain is constructed and\r\n     *   displayed. Valid values are the same as those for the `options` parameter\r\n     *   of {@link TerrainGenerator.terrain}().\r\n     */\r\n    diamondSquare(positionArray, options) {\r\n        // Set the segment length to the smallest power of 2 that is greater than\r\n        // the number of vertices in either dimension of the plane (next power of two)\r\n        var segments = Math.pow(2, Math.ceil(Math.log(Math.max(options.xSegments, options.ySegments) + 1)/Math.log(2)))\r\n    \r\n        // Initialize heightmap\r\n        var size = segments + 1,\r\n            heightmap = [],\r\n            smoothing = 1000,\r\n            i,\r\n            j,\r\n            xLength = options.xSegments + 1,\r\n            yLength = options.ySegments + 1;\r\n        for (i = 0; i <= segments; i++) {\r\n            heightmap[i] = new Float64Array(segments+1);\r\n        }\r\n    \r\n        // Generate heightmap\r\n        for (var l = segments; l >= 2; l /= 2) {\r\n            var half = Math.round(l*0.5),\r\n                whole = Math.round(l),\r\n                x,\r\n                y,\r\n                avg,\r\n                d,\r\n                e;\r\n            smoothing /= 2;\r\n            // square\r\n            for (x = 0; x < segments; x += whole) {\r\n                for (y = 0; y < segments; y += whole) {\r\n                    d = seedRandom(options.seed+x+y) * smoothing * 2 - smoothing;\r\n                    avg = heightmap[x][y] +            // top left\r\n                          heightmap[x+whole][y] +      // top right\r\n                          heightmap[x][y+whole] +      // bottom left\r\n                          heightmap[x+whole][y+whole]; // bottom right\r\n                    avg *= 0.25;\r\n                    heightmap[x+half][y+half] = avg + d;\r\n                }\r\n            }\r\n            // diamond\r\n            for (x = 0; x < segments; x += half) {\r\n                for (y = (x+half) % l; y < segments; y += l) {\r\n                    d = seedRandom(options.seed+x+y*100) * smoothing * 2 - smoothing;\r\n                    avg = heightmap[(x-half+size)%size][y] + // middle left\r\n                          heightmap[(x+half)%size][y] +      // middle right\r\n                          heightmap[x][(y+half)%size] +      // middle top\r\n                          heightmap[x][(y-half+size)%size];  // middle bottom\r\n                    avg *= 0.25;\r\n                    avg += d;\r\n                    heightmap[x][y] = avg;\r\n                    // top and right edges\r\n                    if (x === 0) heightmap[segments][y] = avg;\r\n                    if (y === 0) heightmap[x][segments] = avg;\r\n                }\r\n            }\r\n        }\r\n    \r\n        // Apply heightmap\r\n        let index = 1;\r\n        for (i = 0; i < xLength; i++) {\r\n            for (j = 0; j < yLength; j++) {\r\n                positionArray[index] += heightmap[i][j];\r\n                index += 3;\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Get a 2D array of heightmap values from a 1D array of plane vertices.\r\n     *\r\n     * @param {THREE.Vector3[]} vertices\r\n     *   A 1D array containing the vertices of the plane geometry representing the\r\n     *   terrain, where the z-value of the vertices represent the terrain's\r\n     *   heightmap.\r\n     * @param {Object} options\r\n     *   A map of settings defining properties of the terrain. The only properties\r\n     *   that matter here are `xSegments` and `ySegments`, which represent how many\r\n     *   vertices wide and deep the terrain plane is, respectively (and therefore\r\n     *   also the dimensions of the returned array).\r\n     *\r\n     * @return {Number[][]}\r\n     *   A 2D array representing the terrain's heightmap.\r\n     */\r\n    toArray2D(vertices, options) {\r\n        var tgt = new Array(options.xSegments + 1),\r\n            xLength = options.xSegments + 1,\r\n            yLength = options.ySegments + 1,\r\n            i, j;\r\n        for (i = 0; i < xLength; i++) {\r\n            tgt[i] = new Float64Array(options.ySegments + 1);\r\n            for (j = 0; j < yLength; j++) {\r\n                tgt[i][j] = vertices[j * xLength + i].z;\r\n            }\r\n        }\r\n        return tgt;\r\n    };\r\n\r\n    /**\r\n     * Convert an image-based heightmap into vertex-based height data.\r\n     *\r\n     * @param {THREE.Vector3[]} g\r\n     *   The vertex array for plane geometry to modify with heightmap data. This\r\n     *   method sets the `z` property of each vertex.\r\n     * @param {Object} options\r\n     *   A map of settings that control how the terrain is constructed and\r\n     *   displayed. Valid values are the same as those for the `options` parameter\r\n     *   of {@link TerrainGenerator.terrain}().\r\n     */\r\n    fromHeightmap(g, options) {\r\n        var canvas = document.createElement('canvas'),\r\n            context = canvas.getContext('2d'),\r\n            rows = options.ySegments + 1,\r\n            cols = options.xSegments + 1,\r\n            spread = options.maxHeight - options.minHeight;\r\n        canvas.width = cols;\r\n        canvas.height = rows;\r\n        context.drawImage(options.heightmap, 0, 0, canvas.width, canvas.height);\r\n        var data = context.getImageData(0, 0, canvas.width, canvas.height).data;\r\n        for (var row = 0; row < rows; row++) {\r\n            for (var col = 0; col < cols; col++) {\r\n                var i = row * cols + col,\r\n                    idx = i * 4;\r\n                g[i].z = (data[idx] + data[idx+1] + data[idx+2]) / 765 * spread + options.minHeight;\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set the height of plane vertices from a 1D array of heightmap values.\r\n     *\r\n     * @param {THREE.Vector3[]} vertices\r\n     *   A 1D array containing the vertices of the plane geometry representing the\r\n     *   terrain, where the z-value of the vertices represent the terrain's\r\n     *   heightmap.\r\n     * @param {Number[]} src\r\n     *   A 1D array representing a heightmap to apply to the terrain.\r\n     */\r\n    fromArray1D(vertices, src) {\r\n        for (var i = 0, l = Math.min(vertices.length, src.length); i < l; i++) {\r\n            vertices[i].z = src[i];\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Normalize the terrain after applying a heightmap or filter.\r\n     *\r\n     * This applies turbulence, steps, and height clamping; calls the `after`\r\n     * callback; updates normals and the bounding sphere; and marks vertices as\r\n     * dirty.\r\n     *\r\n     * @param {THREE.Mesh} mesh\r\n     *   The terrain mesh.\r\n     * @param {Object} options\r\n     *   A map of settings that control how the terrain is constructed and\r\n     *   displayed. Valid options are the same as for {@link TerrainGenerator.terrain}().\r\n     */\r\n    normalize(mesh, options) {\r\n        if (options.steps > 1) {\r\n            this.step(mesh.geometry.attributes.position.array, options.steps);\r\n            this.smooth(mesh.geometry.attributes.position.array, options, 3);\r\n        }\r\n        // Keep the terrain within the allotted height range if necessary, and do easing.\r\n        this.clamp(mesh.geometry.attributes.position.array, options);\r\n\r\n        // Mark the geometry as having changed and needing updates.\r\n        mesh.geometry.verticesNeedUpdate = true;\r\n        mesh.geometry.normalsNeedUpdate = true;\r\n        mesh.geometry.computeBoundingSphere();\r\n        mesh.geometry.computeVertexNormals();\r\n    };\r\n\r\n    /**\r\n     * Rescale the heightmap of a terrain to keep it within the maximum range.\r\n     *\r\n     * @param {THREE.Vector3[]} g\r\n     *   The vertex array for plane geometry to modify with heightmap data. This\r\n     *   method sets the `z` property of each vertex.\r\n     * @param {Object} options\r\n     *   A map of settings that control how the terrain is constructed and\r\n     *   displayed. Valid values are the same as those for the `options` parameter\r\n     *   of {@link TerrainGenerator.terrain}() but only `maxHeight`, `minHeight`, and `easing`\r\n     *   are used.\r\n     */\r\n    clamp(positionArray, options) {\r\n        var min = Infinity,\r\n            max = -Infinity,\r\n            l = positionArray.length / 3;\r\n        for (i = 0; i < l; i++) {\r\n            if (positionArray[i*3+1] < min) min = positionArray[i*3+1];\r\n            if (positionArray[i*3+1] > 500) positionArray[i*3+1] = 500;\r\n        }\r\n        if(min < 0){\r\n            min =  Math.abs(min);\r\n            for (i = 0; i < l; i++) {\r\n                positionArray[i*3+1] += min\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Partition a terrain into flat steps.\r\n     *\r\n     * @param {THREE.Vector3[]} g\r\n     *   The vertex array for plane geometry to modify with heightmap data. This\r\n     *   method sets the `z` property of each vertex.\r\n     * @param {Number} [levels]\r\n     *   The number of steps to divide the terrain into. Defaults to\r\n     *   (g.length/2)^(1/4).\r\n     */\r\n    step(positionArray, levels) {\r\n        // Calculate the max, min, and avg values for each bucket\r\n        var l = positionArray.length / 3,\r\n            inc = Math.floor(l / levels),\r\n            heights = new Array(l),\r\n            buckets = new Array(levels);\r\n\r\n        for (i = 0; i < l; i++) {\r\n            heights[i] = positionArray[(i*3)+1];\r\n        }\r\n\r\n        \r\n        heights.sort(function(a, b) { return a - b; });\r\n                // console.log(heights)\r\n        for (i = 0; i < levels; i++) {\r\n            // Bucket by population (bucket size) not range size\r\n            var subset = heights.slice(i*inc, (i+1)*inc),\r\n                sum = 0,\r\n                bl = subset.length;\r\n            for (j = 0; j < bl; j++) {\r\n                sum += subset[j];\r\n            }\r\n            buckets[i] = {\r\n                min: subset[0],\r\n                max: subset[subset.length-1],\r\n                avg: sum / bl,\r\n            };\r\n        }\r\n        console.log(buckets)\r\n\r\n        // Set the height of each vertex to the average height of its bucket\r\n        for (i = 0; i < l; i++) {\r\n            var startHeight = positionArray[(i*3)+1];\r\n            for (j = 0; j < levels; j++) {\r\n                if (startHeight >= buckets[j].min && startHeight <= buckets[j].max) {\r\n                    positionArray[(i*3)+1] = buckets[j].avg;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Smooth the terrain by setting each point to the mean of its neighborhood.\r\n     *\r\n     * @param {THREE.Vector3[]} g\r\n     *   The vertex array for plane geometry to modify with heightmap data. This\r\n     *   method sets the `z` property of each vertex.\r\n     * @param {Object} options\r\n     *   A map of settings that control how the terrain is constructed and\r\n     *   displayed. Valid values are the same as those for the `options` parameter\r\n     *   of {@link TerrainGenerator.terrain}().\r\n     * @param {Number} [weight=0]\r\n     *   How much to weight the original vertex height against the average of its\r\n     *   neighbors.\r\n     */\r\n    smooth(positionArray, options, weight) {\r\n        var heightmap = new Float64Array(positionArray.length);\r\n        for (var i = 0, xLength = options.xSegments + 1, yLength = options.ySegments + 1; i < xLength; i++) {\r\n            for (var j = 0; j < yLength; j++) {\r\n                var sum = 0,\r\n                    c = 0;\r\n                for (var n = -1; n <= 1; n++) {\r\n                    for (var m = -1; m <= 1; m++) {\r\n                        var key = (j+n)*xLength + i + m;\r\n                        if (typeof positionArray[key] !== 'undefined' && i+m >= 0 && j+n >= 0 && i+m < xLength && j+n < yLength) {\r\n                            sum += positionArray[(key*3)+1];\r\n                            c++;\r\n                        }\r\n                    }\r\n                }\r\n                heightmap[j*xLength + i] = sum / c;\r\n            }\r\n        }\r\n        weight = weight || 0;\r\n        var w = 1 / (1 + weight);\r\n        for (var k = 0, l = positionArray.length; k < l; k++) {\r\n            positionArray[k*3+1] = (heightmap[k] + positionArray[k*3+1] * weight) * w;\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Generate a material that blends together textures based on vertex height.\r\n     *\r\n     * Inspired by http://www.chandlerprall.com/2011/06/blending-webgl-textures/\r\n     *\r\n     * Usage:\r\n     *\r\n     *    // Assuming the textures are already loaded\r\n     *    var material = THREE.Terrain.generateBlendedMaterial([\r\n     *      {texture: THREE.ImageUtils.loadTexture('img1.jpg')},\r\n     *      {texture: THREE.ImageUtils.loadTexture('img2.jpg'), levels: [-80, -35, 20, 50]},\r\n     *      {texture: THREE.ImageUtils.loadTexture('img3.jpg'), levels: [20, 50, 60, 85]},\r\n     *      {texture: THREE.ImageUtils.loadTexture('img4.jpg'), glsl: '1.0 - smoothstep(65.0 + smoothstep(-256.0, 256.0, vPosition.x) * 10.0, 80.0, vPosition.z)'},\r\n     *    ]);\r\n     *\r\n     * This material tries to behave exactly like a MeshLambertMaterial other than\r\n     * the fact that it blends multiple texture maps together, although\r\n     * ShaderMaterials are treated slightly differently by Three.js so YMMV. Note\r\n     * that this means the texture will appear black unless there are lights\r\n     * shining on it.\r\n     *\r\n     * @param {Object[]} textures\r\n     *   An array of objects specifying textures to blend together and how to blend\r\n     *   them. Each object should have a `texture` property containing a\r\n     *   `THREE.Texture` instance. There must be at least one texture and the first\r\n     *   texture does not need any other properties because it will serve as the\r\n     *   base, showing up wherever another texture isn't blended in. Other textures\r\n     *   must have either a `levels` property containing an array of four numbers\r\n     *   or a `glsl` property containing a single GLSL expression evaluating to a\r\n     *   float between 0.0 and 1.0. For the `levels` property, the four numbers\r\n     *   are, in order: the height at which the texture will start blending in, the\r\n     *   height at which it will be fully blended in, the height at which it will\r\n     *   start blending out, and the height at which it will be fully blended out.\r\n     *   The `vec3 vPosition` variable is available to `glsl` expressions; it\r\n     *   contains the coordinates in Three-space of the texel currently being\r\n     *   rendered.\r\n     * @param {Three.Material} material\r\n     *   An optional base material. You can use this to pick a different base\r\n     *   material type such as `MeshStandardMaterial` instead of the default\r\n     *   `MeshLambertMaterial`.\r\n     */\r\n    generateBlendedMaterial(textures, material) {\r\n        // Convert numbers to strings of floats so GLSL doesn't barf on \"1\" instead of \"1.0\"\r\n        function glslifyNumber(n) {\r\n            return n === (n|0) ? n+'.0' : n+'';\r\n        }\r\n\r\n        var declare = '',\r\n            assign = '',\r\n            t0Repeat = textures[0].texture.repeat,\r\n            t0Offset = textures[0].texture.offset;\r\n        for (var i = 0, l = textures.length; i < l; i++) {\r\n            // Update textures\r\n            textures[i].texture.wrapS = textures[i].wrapT = https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RepeatWrapping;\r\n            textures[i].texture.needsUpdate = true;\r\n\r\n            // Shader fragments\r\n            // Declare each texture, then mix them together.\r\n            declare += 'uniform sampler2D texture_' + i + ';\\n';\r\n            \r\n            // skip the first texture as it is the background\r\n            if (i !== 0) {\r\n            \r\n                var v = textures[i].levels, // Vertex heights at which to blend textures in and out\r\n                    p = textures[i].glsl, // Or specify a GLSL expression that evaluates to a float between 0.0 and 1.0 indicating how opaque the texture should be at this texel\r\n                    useLevels = typeof v !== 'undefined', // Use levels if they exist; otherwise, use the GLSL expression\r\n                    tiRepeat = textures[i].texture.repeat,\r\n                    tiOffset = textures[i].texture.offset;\r\n                if (useLevels) {\r\n                    // Must fade in; can't start and stop at the same point.\r\n                    // So, if levels are too close, move one of them slightly.\r\n                    if (v[1] - v[0] < 1) v[0] -= 1;\r\n                    if (v[3] - v[2] < 1) v[3] += 1;\r\n                    for (var j = 0; j < v.length; j++) {\r\n                        v[j] = glslifyNumber(v[j]);\r\n                    }\r\n                }\r\n\r\n                // The transparency of the new texture when it is layered on top of the existing color at this texel is\r\n                // (how far between the start-blending-in and fully-blended-in levels the current vertex is) +\r\n                // (how far between the start-blending-out and fully-blended-out levels the current vertex is)\r\n                // So the opacity is 1.0 minus that.\r\n                var blendAmount = !useLevels ? p : '1.0 - smoothstep(' + v[0] + ', ' + v[1] + ', vPosition.y) + smoothstep(' + v[2] + ', ' + v[3] + ',vPosition.y )';\r\n                \r\n                \r\n                assign +=   '        color = mix( ' +\r\n                            'texture2D( texture_' + i + ', MyvUv * vec2( ' + glslifyNumber(tiRepeat.x) + ', ' + glslifyNumber(tiRepeat.y) + ' ) + vec2( ' + glslifyNumber(tiOffset.x) + ', ' + glslifyNumber(tiOffset.y) + ' ) ), ' +\r\n                            'color, ' +\r\n                            'max(min(' + blendAmount + ', 1.0), 0.0)' +\r\n                            ');\\n';\r\n            }\r\n        }\r\n\r\n        var fragBlend = 'float slope = acos(max(min(dot(myNormal, vec3(0.0, 1.0, 0.0)), 1.0), -1.0));\\n' +\r\n            '    diffuseColor = vec4( diffuse, opacity );\\n' +\r\n            '    vec4 color = texture2D( texture_0, MyvUv * vec2( ' + glslifyNumber(t0Repeat.x) + ', ' + glslifyNumber(t0Repeat.y) + ' ) + vec2( ' + glslifyNumber(t0Offset.x) + ', ' + glslifyNumber(t0Offset.y) + ' ) ); // base\\n' +\r\n                assign +\r\n            '    diffuseColor = color;\\n';\r\n\r\n        var fragPars = declare + '\\n' +\r\n                'varying vec2 MyvUv;\\n' +\r\n                'varying vec3 vPosition;\\n' +\r\n                'varying vec3 myNormal;\\n';\r\n\r\n        var mat = material || new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.MeshLambertMaterial();\r\n        mat.onBeforeCompile = function(shader) {\r\n            // Patch vertexShader to setup MyUv, vPosition, and myNormal\r\n            shader.vertexShader = shader.vertexShader.replace('#include <common>',\r\n                'varying vec2 MyvUv;\\nvarying vec3 vPosition;\\nvarying vec3 myNormal;\\n#include <common>');\r\n            shader.vertexShader = shader.vertexShader.replace('#include <uv_vertex>',\r\n                'MyvUv = uv;\\nvPosition = position;\\nmyNormal = normal;\\n#include <uv_vertex>');\r\n\r\n            shader.fragmentShader = shader.fragmentShader.replace('#include <common>', fragPars + '\\n#include <common>');\r\n            shader.fragmentShader = shader.fragmentShader.replace('#include <map_fragment>', fragBlend);\r\n\r\n            // Add our custom texture uniforms\r\n            for (var i = 0, l = textures.length; i < l; i++) {\r\n                shader.uniforms['texture_' + i] = {\r\n                    type: 't',\r\n                    value: textures[i].texture,\r\n                };\r\n            }\r\n        };\r\n\r\n        return mat;\r\n    };\r\n}\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/terrain/TerrainGenerator.js?");

/***/ }),

/***/ "./src/util/PointerLockControls.js":
/*!*****************************************!*\
  !*** ./src/util/PointerLockControls.js ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"PointerLockControls\": () => (/* binding */ PointerLockControls)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n\r\n\r\nconst _euler = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Euler(0, 0, 0, 'YXZ');\r\nconst _vector = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n\r\nconst _changeEvent = { type: 'change' };\r\nconst _lockEvent = { type: 'lock' };\r\nconst _unlockEvent = { type: 'unlock' };\r\n\r\nconst _PI_2 = Math.PI / 2;\r\n\r\nclass PointerLockControls extends https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.EventDispatcher {\r\n\r\n    constructor(camera, domElement) {\r\n\r\n        super();\r\n\r\n        if (domElement === undefined) {\r\n\r\n            console.warn('THREE.PointerLockControls: The second parameter \"domElement\" is now mandatory.');\r\n            domElement = document.body;\r\n\r\n        }\r\n\r\n        this.domElement = domElement;\r\n        this.isLocked = false;\r\n\r\n        // Set to constrain the pitch of the camera\r\n        // Range is 0 to Math.PI radians\r\n        this.minPolarAngle = 0; // radians\r\n        this.maxPolarAngle = Math.PI; // radians\r\n        this.sensitivityX = 0.002;\r\n        this.sensitivityY = 0.002;\r\n        const scope = this;\r\n\r\n        function onMouseMove(event) {\r\n\r\n            if (scope.isLocked === false) return;\r\n\r\n            const movementX = event.movementX || event.mozMovementX || event.webkitMovementX || 0;\r\n            const movementY = event.movementY || event.mozMovementY || event.webkitMovementY || 0;\r\n\r\n            _euler.setFromQuaternion(camera.quaternion);\r\n            _euler.y -= movementX * scope.sensitivityX;\r\n            _euler.x -= movementY * scope.sensitivityY;\r\n\r\n            _euler.x = Math.max(_PI_2 - scope.maxPolarAngle, Math.min(_PI_2 - scope.minPolarAngle, _euler.x));\r\n\r\n            camera.quaternion.setFromEuler(_euler);\r\n\r\n            scope.dispatchEvent(_changeEvent);\r\n\r\n        }\r\n\r\n        function onPointerlockChange() {\r\n\r\n            if (scope.domElement.ownerDocument.pointerLockElement === scope.domElement) {\r\n\r\n                scope.dispatchEvent(_lockEvent);\r\n\r\n                scope.isLocked = true;\r\n\r\n            } else {\r\n\r\n                scope.dispatchEvent(_unlockEvent);\r\n\r\n                scope.isLocked = false;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        function onPointerlockError() {\r\n\r\n            console.error('THREE.PointerLockControls: Unable to use Pointer Lock API');\r\n\r\n        }\r\n\r\n        this.connect = function() {\r\n\r\n            scope.domElement.ownerDocument.addEventListener('mousemove', onMouseMove);\r\n            scope.domElement.ownerDocument.addEventListener('pointerlockchange', onPointerlockChange);\r\n            scope.domElement.ownerDocument.addEventListener('pointerlockerror', onPointerlockError);\r\n\r\n        };\r\n\r\n        this.disconnect = function() {\r\n\r\n            scope.domElement.ownerDocument.removeEventListener('mousemove', onMouseMove);\r\n            scope.domElement.ownerDocument.removeEventListener('pointerlockchange', onPointerlockChange);\r\n            scope.domElement.ownerDocument.removeEventListener('pointerlockerror', onPointerlockError);\r\n\r\n        };\r\n\r\n        this.dispose = function() {\r\n\r\n            this.disconnect();\r\n\r\n        };\r\n\r\n        this.getObject = function() { // retaining this method for backward compatibility\r\n\r\n            return camera;\r\n\r\n        };\r\n\r\n        this.getDirection = function() {\r\n\r\n            const direction = new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3(0, 0, -1);\r\n\r\n            return function(v) {\r\n\r\n                return v.copy(direction).applyQuaternion(camera.quaternion);\r\n\r\n            };\r\n\r\n        }();\r\n\r\n        this.moveForward = function(distance) {\r\n\r\n            // move forward parallel to the xz-plane\r\n            // assumes camera.up is y-up\r\n\r\n            _vector.setFromMatrixColumn(camera.matrix, 0);\r\n\r\n            _vector.crossVectors(camera.up, _vector);\r\n\r\n            camera.position.addScaledVector(_vector, distance);\r\n\r\n        };\r\n\r\n        this.moveRight = function(distance) {\r\n\r\n            _vector.setFromMatrixColumn(camera.matrix, 0);\r\n\r\n            camera.position.addScaledVector(_vector, distance);\r\n\r\n        };\r\n\r\n        this.lock = function() {\r\n\r\n            this.domElement.requestPointerLock();\r\n\r\n        };\r\n\r\n        this.unlock = function() {\r\n\r\n            scope.domElement.ownerDocument.exitPointerLock();\r\n\r\n        };\r\n\r\n        this.connect();\r\n\r\n    }\r\n\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/util/PointerLockControls.js?");

/***/ }),

/***/ "./src/util/RemoteController.js":
/*!**************************************!*\
  !*** ./src/util/RemoteController.js ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"RemoteController\": () => (/* binding */ RemoteController)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js\");\n/* harmony import */ var _localProxy_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./localProxy.js */ \"./src/util/localProxy.js\");\n/* harmony import */ var _peerjs_groups_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./peerjs-groups.js */ \"./src/util/peerjs-groups.js\");\n/* harmony import */ var _entities_AvatarController_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../entities/AvatarController.js */ \"./src/entities/AvatarController.js\");\n/* harmony import */ var _UserInterface_UiElements_Common_AlertBox_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../UserInterface/UiElements/Common/AlertBox.js */ \"./src/UserInterface/UiElements/Common/AlertBox.js\");\n\r\n\r\n\r\n\r\n\r\n\r\nconst SIGNALLING_OPTIONS =  {\r\n    secure: 'wss://',\r\n    host: 'spacetime-peerserver.herokuapp.com',\r\n    port: 443\r\n};\r\nlet connected = false;\r\nlet group;\r\nlet joinRequests = [];\r\n\r\nclass RemoteController {\r\n    constructor(manager) {\r\n        this.connections = [];\r\n        this.manager = manager;\r\n        this.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\r\n        if(!this.getUserMedia) console.log('Your browser doesn\\'t support getUserMedia.');\r\n\r\n        // ==== comment below for production ====///\r\n        _localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList = null;\r\n        _localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].peerId = null;\r\n        \r\n        /* The following lines check if the user has a peerID in the local storage\r\n         * and automatically creates a new peer if it finds one. This is a good feature for\r\n         * production but is very annoying when testing. please leave like this until next\r\n         * merge into the main branch.\r\n         */ \r\n        // if(typeof localProxy.peerId !== 'undefined'){\r\n        //     this.peer = new Peer(localProxy.peerId);\r\n        //     console.log(\"[info] Trying to create peer: \" + localProxy.peerId)\r\n        //     this.peer.on('open', () => {\r\n        //         this.onConnectionOpen()\r\n        //     })\r\n        // }\r\n    }\r\n\r\n    createPeerWithId(peerId){\r\n        _localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].peerId = peerId;\r\n        this.peer = new Peer(peerId);\r\n        this.peer.on('open', () => {\r\n            this.onConnectionOpen();\r\n        });\r\n\r\n        // listen for a call\r\n        this.answer();\r\n    }\r\n\r\n    onConnectionOpen() {\r\n        this.addMessageToChatBox(\"[info] Peer created with id: \"+_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].peerId);\r\n        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.multiplayerPanel.update();\r\n\r\n        // listen for new connection\r\n        this.peer.on('connection', (newConnection) => {\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.multiplayerPanel.connectionsManagementDisplay.handleNewConnection(newConnection);\r\n            this.onConnectionConnect(newConnection)\r\n        })\r\n\r\n        this.initFriendList()\r\n    }\r\n\r\n    initFriendList() {\r\n        // try connect to friends\r\n        if(_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList){\r\n            _localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList.forEach(friend => {\r\n                this.connectToPeer(friend)\r\n            })\r\n        }\r\n        else {\r\n            _localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList = [];\r\n        }\r\n    }\r\n\r\n    onConnectionConnect(newConnection) {\r\n        this.addMessageToChatBox('[info] new connection to peer: ' + newConnection.peer)\r\n        \r\n        this.connections.push(newConnection);\r\n        \r\n        // not sure why this is needed but if we dont give the connection some time it wont send the message\r\n        setTimeout(() => {\r\n            newConnection.send(this.jsonMessageFormatter(\"spawn\"));\r\n        }, 1000);\r\n        \r\n\r\n        // listen to new data\r\n        newConnection.on('data', (data) => {\r\n            this.onReceiveData(newConnection, data)\r\n        })\r\n\r\n        newConnection.on('close', ()=>{\r\n            this.onConnectionClose(newConnection);\r\n        })\r\n    }\r\n\r\n    onReceiveData(connection, data) {      \r\n        let jsonData;\r\n        try {\r\n            jsonData = JSON.parse(data);\r\n        } catch (error) {\r\n            console.error(\"[RemoteController:onReceiveData] Error while parsing data to JSON.\\nData: \"+data);\r\n        }\r\n        if(typeof jsonData.type !== 'undefined') {\r\n            switch(jsonData.type) {\r\n                \r\n                case \"spawn\":\r\n                    if(jsonData.pathname === window.location.pathname) {\r\n                        this.addMessageToChatBox(\"[info] Spawning: \"+connection.peer);\r\n\r\n                        // Spawn the other player\r\n                        connection.avatarController = new _entities_AvatarController_js__WEBPACK_IMPORTED_MODULE_3__.AvatarController(this.manager);\r\n                        connection.avatarController.spawnRemoteAvatar({otherPlayer: connection.peer})\r\n                    }\r\n\r\n                case \"stream\":\r\n                    /* To maintain synchronization in the environment, we do not update the avatar controller every time we receive the stream information.\r\n                     * Instead we simply update the connections data and the update method will tak care of updating the avatarController only once per render cycle. */\r\n                    this.handleNewTransform(connection, jsonData);\r\n                    break;\r\n                \r\n                case \"chat\": \r\n                    this.addMessageToChatBox(\"[\"+connection.peer+\"] \"+jsonData.message)\r\n                    break;\r\n\r\n                case \"notify\":\r\n                    if(jsonData.command == \"answered\" && this.alertBox) this.alertBox.element.remove();\r\n                    if(jsonData.command == \"endcall\") {\r\n                        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.callPanel.closeCameraBox(connection.peer);\r\n                        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.callPanel.closeCameraBox(_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].peerId);\r\n                        this.currentCall = null;\r\n                    }\r\n                    VIRTUAL_ENVIRONMENT.UI_CONTROLLER.ringtoneSystem.playNotifyTone();\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    handleNewTransform(connection, jsonData) {\r\n        connection.transform = {\r\n            position: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3(jsonData.transform.position.x, jsonData.transform.position.y, jsonData.transform.position.z),\r\n            horizontalVelocity: new https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3(jsonData.transform.horizontalVelocity.x, 0, jsonData.transform.horizontalVelocity.z)\r\n        }\r\n        connection.animation = jsonData.animation\r\n\r\n        connection.needUpdate = true;\r\n    }\r\n\r\n    connectToPeer(peerId) {\r\n\r\n        let isValid = true;\r\n\r\n        // verify that we are not connecting to self\r\n        if(peerId === this.peer.id){\r\n            console.warn(\"[RemoteController:connectToPeer] You are trying to connect to your own peerId. Current id: \" + _localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].peerId);\r\n            isValid = false;\r\n        }\r\n\r\n        // verify that we do not already have a connection to this peer\r\n        this.connections.forEach(connection => {\r\n            if(connection.peer === peerId){\r\n                console.warn(\"[RemoteController:connectToPeer] You are trying to duplicate a connection to peer: \" + peerId);\r\n                isValid = false;\r\n            }\r\n        })\r\n\r\n        if(isValid) {\r\n            this.addMessageToChatBox(\"[info] Trying connection to peer: \" + peerId);\r\n            const newConnection = this.peer.connect(peerId);\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.multiplayerPanel.connectionsManagementDisplay.handleNewConnection(newConnection);\r\n\r\n            // on new connection establish\r\n            newConnection.on('open', () => {\r\n                this.onConnectionConnect(newConnection);\r\n            })\r\n\r\n            // kill the attempt after a certain delay\r\n            setTimeout(() => {\r\n                if(!newConnection.open){ \r\n                    VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleConnectionClose(newConnection.peer)\r\n                    newConnection.close();\r\n                }\r\n            }, 3000);\r\n        }\r\n    }\r\n\r\n    onConnectionClose(connection) {\r\n        if(typeof connection.avatarController !== \"undefined\"){\r\n            connection.avatarController.removeAvatar();\r\n        }\r\n        const index = this.connections.indexOf(connection);\r\n        this.connections.splice(index,1);\r\n        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleConnectionClose(connection.peer)\r\n        this.addMessageToChatBox('[info] disconnected from peer: ' + connection.peer);\r\n    }\r\n    \r\n    disconnectPeer(peerId) {\r\n        this.connections.forEach((connection, index) => {\r\n            if(connection.peer === peerId) {\r\n                connection.close();\r\n            }\r\n        })\r\n        \r\n    }\r\n\r\n    sendChatMessage(message) {\r\n        let formatted = (0,_peerjs_groups_js__WEBPACK_IMPORTED_MODULE_2__.escapeHTML)(message);\r\n        if (connected) {\r\n            group.send(formatted);\r\n        } else {\r\n            this.connections.forEach(connection => {\r\n                connection.send('{\"type\":\"chat\",\"message\":\"'+formatted+'\"}');\r\n            })\r\n        }\r\n        if(typeof this.peer !== \"undefined\"){\r\n            this.addMessageToChatBox(\"[\"+this.peer.id+\"] \"+formatted)\r\n        } else {\r\n            this.addMessageToChatBox(\"[info] You must connect to send messages in chat\")\r\n        }\r\n    }\r\n\r\n    addMessageToChatBox(message) {\r\n        const formatted = (0,_peerjs_groups_js__WEBPACK_IMPORTED_MODULE_2__.escapeHTML)(message);\r\n        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.handleNewMessage(formatted)\r\n    }\r\n\r\n    update(delta) {\r\n        this.connections.forEach(connection => {\r\n            if(connection.needUpdate) {\r\n                const position = LOCAL_PLAYER.position;\r\n                const horizontalVelocity = LOCAL_PLAYER.horizontalVelocity;\r\n\r\n                connection.send(this.jsonMessageFormatter(\"stream\"));\r\n\r\n                if(typeof connection.transform !== 'undefined' && connection.avatarController){\r\n                    connection.avatarController.update(delta, connection.transform.position, connection.transform.horizontalVelocity, connection.animation[0], connection.animation[1])\r\n                }\r\n\r\n                connection.needUpdate = false;\r\n            }\r\n        })\r\n    }\r\n\r\n    updateFriendList() {\r\n        let tempList = _localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList;\r\n        this.connections.forEach(connection => {\r\n            let peerId = connection.peer;\r\n            if(_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList.indexOf(peerId) <= -1) {\r\n                tempList.push(peerId);\r\n            }\r\n        })\r\n        _localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].friendList = tempList;\r\n    }\r\n\r\n    call(peerId) {\r\n        let me = this;\r\n        this.getUserMedia({video: true, audio: true}, function(stream) {\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.callPanel.addCameraBox(_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].peerId, stream, \"muted\");\r\n            var call = me.peer.call(peerId, stream);\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.callPanel.notifyCall(call.peer);\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.ringtoneSystem.playCallTone();\r\n            call.on('stream', function(incomingStream) {\r\n                if(!me.currentCall) {\r\n                    me.currentCall = call;\r\n                    VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.callPanel.addCameraBox(call.peer, incomingStream)\r\n                }\r\n            });\r\n          }, function(err) {\r\n                console.log('Failed to get local stream' ,err);\r\n          });\r\n    }\r\n\r\n    answer() {\r\n        let me = this;\r\n        this.peer.on('call', function(call) {\r\n            me.alertBox = new _UserInterface_UiElements_Common_AlertBox_js__WEBPACK_IMPORTED_MODULE_4__.AlertBox('Information', `Receiving a call from ${call.peer}?`, {title: \"ACCEPT\", icon: \"&#128242;\"}, {title: \"DECLINE\", icon: \"&#128244;\"},  () => {\r\n                VIRTUAL_ENVIRONMENT.UI_CONTROLLER.ringtoneSystem.playCallTone();\r\n                VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuHeader.callPanelButton.toggleMenuHeader(\"call-panel\", \"block\");\r\n                VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.handleMenuPanelSelection(\"calling\");\r\n                me.getUserMedia({video: true, audio: true}, function(stream) {\r\n                VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.callPanel.addCameraBox(_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].peerId, stream, \"muted\")\r\n                call.answer(stream);\r\n                call.on('stream', function(incomingStream) {\r\n                    if(!me.currentCall) {\r\n                        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.ringtoneSystem.mute();\r\n                        me.currentCall = call;\r\n                        me.sendNotify(call.peer, 'answered');\r\n                        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.callPanel.addCameraBox(call.peer, incomingStream)\r\n                    }\r\n                });\r\n                call.on('close', function() {\r\n                    me.endcall();\r\n                });\r\n                }, function(err) {\r\n                    console.log('Failed to get local stream' ,err);\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    sendNotify(peerId, command) {\r\n        this.connections.forEach(connection => {\r\n            if(connection.peer === peerId) {\r\n                connection.send('{\"type\":\"notify\",\"command\":\"'+command+'\"}');\r\n            }\r\n        })\r\n    }\r\n\r\n    endcall() {\r\n        if(this.currentCall) {\r\n            let peerId = this.currentCall.peer;\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.callPanel.closeCameraBox(peerId);\r\n            VIRTUAL_ENVIRONMENT.UI_CONTROLLER.blockerScreen.menu.menuDisplay.callPanel.closeCameraBox(_localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].peerId);\r\n            this.currentCall.close();\r\n            this.currentCall = null;\r\n            this.sendNotify(peerId, 'endcall');\r\n        } \r\n        VIRTUAL_ENVIRONMENT.UI_CONTROLLER.ringtoneSystem.playNotifyTone();\r\n    }\r\n\r\n    jsonMessageFormatter(type) {\r\n        let jsonMessage = {type: type}\r\n        switch(type){\r\n            case \"spawn\":\r\n                jsonMessage.pathname = window.location.pathname;\r\n            case \"stream\":\r\n                jsonMessage.transform = {\r\n                    position: LOCAL_PLAYER.position,\r\n                    horizontalVelocity: LOCAL_PLAYER.horizontalVelocity\r\n                }; \r\n                jsonMessage.animation = [\r\n                    LOCAL_PLAYER.currentAnimation,\r\n                    LOCAL_PLAYER.currentAnimationTime\r\n                ];\r\n        }\r\n        return JSON.stringify(jsonMessage);\r\n    }\r\n\r\n    initializeNetworking() {\r\n        let me = this;\r\n        group = new _peerjs_groups_js__WEBPACK_IMPORTED_MODULE_2__.PeerGroup(\r\n            function (error) {\r\n                console.error(error.type + ': ' + error);\r\n                debugger;\r\n            },\r\n            SIGNALLING_OPTIONS\r\n        );\r\n    \r\n        group.addEventListener('connected', function (event) {\r\n            if(!event.administrator) {\r\n                alertBox(\"Information\", `Connected to ${event.sessionID}. Waiting for permission to join the conversation&hellip;`);\r\n            }\r\n        });\r\n\r\n        group.addEventListener('joined', function (event) {        \r\n            me.addMessageToChatBox(`[Info] You are now in room ${event.sessionID}`);\r\n        });\r\n\r\n        group.addEventListener('joinrequest', function (event) {\r\n            joinRequests.push(event.userID);\r\n            if (joinRequests.length == 1) {\r\n                alertBox(\"Wants to Join the Conversation\", `Do you want to accept ${event.userID}'s request to join?`, () => {\r\n                    var userID = joinRequests.shift();\r\n\t                group.acceptUser(userID);\r\n                });\r\n            }\r\n        });\r\n    \r\n        group.addEventListener('userpresent', function (event) {\r\n            me.addMessageToChatBox(`[${event.sessionID}] ${event.userID} is present.`);\r\n        });\r\n    \r\n        group.addEventListener('userleft', function (event) { \r\n            me.addMessageToChatBox(`[${event.sessionID}] ${event.userID} has left.`);\r\n        });\r\n    \r\n        group.addEventListener('message', function (event) {\r\n            me.addMessageToChatBox(`[${event.sessionID}][${event.userID}] ${event.message}`);\r\n        });\r\n    }\r\n\r\n    createRoom(sessionId) {\r\n        if(typeof this.peer !== \"undefined\") {\r\n            this.addMessageToChatBox(`[Info] accessing room ${sessionId}...`);\r\n            this.initializeNetworking();\r\n            connected = true;\r\n            group.connect(sessionId, _localProxy_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].peerId);\r\n            toggleConnectRoom(this);\r\n        } else {\r\n            this.addMessageToChatBox(\"[info] You must connect to create or join chat rooms\")\r\n        }\r\n    }\r\n\r\n    disconnectRoom() {\r\n        if(connected) {\r\n            group.disconnect();\r\n            connected = false;\r\n            this.addMessageToChatBox(`[${event.sessionID}] You left this conversation`);\r\n            toggleConnectRoom(this);\r\n        }\r\n    }\r\n\r\n    isConnected() {\r\n        return group && connected;\r\n    }\r\n\r\n    destroy() {\r\n        this.endcall();\r\n        this.peer.destroy();\r\n    }\r\n}\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/util/RemoteController.js?");

/***/ }),

/***/ "./src/util/localProxy.js":
/*!********************************!*\
  !*** ./src/util/localProxy.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\nconst localProxy = new Proxy(localStorage, {\r\n    get(_, prop) {\r\n        prop = \"__stm_\" + prop;\r\n        return localStorage[prop] ? JSON.parse(localStorage[prop]) : undefined;\r\n    },\r\n    set(_, prop, val) {\r\n        prop = \"__stm_\" + prop;\r\n        localStorage[prop] = JSON.stringify(val);\r\n        return true;\r\n    },\r\n    deleteProperty(_, prop) {\r\n        delete localStorage[prop];\r\n    }\r\n});\r\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (localProxy);\n\n//# sourceURL=webpack://webpack-demo/./src/util/localProxy.js?");

/***/ }),

/***/ "./src/util/peerjs-groups.js":
/*!***********************************!*\
  !*** ./src/util/peerjs-groups.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"PeerGroup\": () => (/* binding */ PeerGroup),\n/* harmony export */   \"escapeHTML\": () => (/* binding */ escapeHTML)\n/* harmony export */ });\n/* TODO\r\n *\t* Add function to get admin's user ID.\r\n *\t* Buffer messages when not connected to any other peers.\r\n *\t* Optionally replay the entire session history to late entrants?\r\n *\t* Disconnect peers who send malformed messages.\r\n *\t* Add method to get the userIDs present in the session.\r\n *\t* Document code.\r\n *\t* Handle peer getting disconnected from peer server.\r\n *  * Handle when the peer named after the session goes down.\r\n *\t* Mask sessionID with one time password.\r\n *\t* Verify users' identities somehow.\r\n *  * Anonymize connection labels.\r\n *\t* Add voice and video.\r\n */\r\n\r\n/**\tMappings between characters that need to be escaped in HTML code (to prevent cross-site\r\n\tscripting attacks) and their corresponding escape sequences, i.e. HTML character entities.\r\n\t@readonly\r\n*/\r\nconst ESCAPE_MAP = Object.freeze({\r\n\t'&': '&amp;',\r\n\t'<': '&lt;',\r\n\t'>': '&gt;',\r\n\t'\"': '&quot;',\r\n\t\"'\": '&#39;'\r\n});\r\n\r\n/**\tEscapes a string so that any HTML code contained within it is converted into plain\r\n\ttext.\r\n\t@param {(string|undefined)} input The text to make safe.\r\n*/\r\nconst escapeHTML = (input) => {\r\n\t'use strict';\r\n\tif (input !== undefined) {\r\n\t\treturn String(input).replace(/[&<>\"']/g, function (match) {\r\n\t\t\treturn ESCAPE_MAP[match];\r\n\t\t});\r\n\t} else {\r\n\t\treturn input;\r\n\t}\r\n}\r\n\r\n/**Describes an event fired by a {@link PeerGroup} object.\r\n@property {string} sessionID The name of the peer group that the event relates to.\r\n@property {string} userID The user ID of the peer whose action triggered the event.\r\n@property {boolean} administrator <code>true</code> if the peer described by the <code>userID</code>\r\nproperty is the peer group leader.\r\n@property {boolean} isPrivate <code>true</code> if the cause of the event is known\r\nonly to this peer and the peer that caused the event (e.g. receiving a private message),\r\nor <code>false</code> if all members of the peer group are likely aware of the state change.\r\n@property {any} [message] Additional details that vary according to the type\r\nof event. Contains application specific data for a <code>message</code> event and\r\na textual description (<code>string</code>) for other events.\r\n*/\r\nclass PeerGroupEvent extends Event {\r\n\t/**\tCreates a PeerGroupEvent.\r\n\t\t@param {string} type The name of the event type.\r\n\t\t@param {boolean} isAdmin <code>true</code> if the peer identified by the <code>userID</code>\r\n\t\tproperty is the peer group leader, and false otherwise.\r\n\t\tall members of the peer group are aware of the state change.\r\n\t\t@param {object} properties A dictionary of additional properties to add to\r\n\t\tthe object. As a minimum this should include the sessionID, userID and isPrivate properties.\r\n\t\t@package\r\n\t*/\r\n\tconstructor(type, isAdmin, properties) {\r\n\t\tsuper(type);\r\n\t\tObject.assign(this, properties);\r\n\t\tthis.administrator = isAdmin;\r\n\t}\r\n}\r\n\r\n/**\tPeerGroup (project name [Peer.js Groups]{@link https://github.com/ElizabethHudnott/peerjs-groups})\r\n\tis an abstraction layer over the [Peer.js]{@link https://github.com/peers} library\r\n\tthat allows peers to easily find and communicate with other peers that share\r\n\tan interest in a common group ID tag (e.g. a chat room name or a gaming session name).\r\n\t@see [Peer constructor in the Peer.js documentation]{@link https://elizabethhudnott.github.io/peerjs-groups/lib/doc/peer.html#peer}\r\n*/\r\nclass PeerGroup extends EventTarget {\r\n\t/**\t@event PeerGroup~connected\r\n\t\t@description Fired when a peer establishes a connection with the peer\r\n\t\tgroup leader (which may be itself). The event is fired on the peer that initiated\r\n\t\tthe connection. The peer doesn't receive any messages addressed to the peer group\r\n\t\tuntil after the {@link PeerGroup~event:joined} event has been fired.\r\n\t\t@type {PeerGroupEvent}\r\n\t*/\r\n\r\n\t/**\t@event PeerGroup~joined\r\n\t\t@description Fired when the local peer becomes a member of a peer group.\r\n\t\t@type {PeerGroupEvent}\r\n\t*/\r\n\r\n\t/**\t@event PeerGroup~userpresent\r\n\t\t@description Fired when another peer joins the peer group, or when the local peer\r\n\t\tjoins the peer group and discovers existing members.\r\n\t\t@type {PeerGroupEvent}\r\n\t*/\r\n\r\n\t/**\t@event PeerGroup~userleft\r\n\t\t@description Fired when the connection to another peer is severed.\r\n\t\t@type {PeerGroupEvent}\r\n\t*/\r\n\r\n\t/**\t@event PeerGroup~message\r\n\t\t@description Fired when this peer receives a message (either addressed to the peer\r\n\t\tgroup or private).\r\n\t\t@type {PeerGroupEvent}\r\n\t*/\r\n\r\n\t/**\t@event PeerGroup~joinrequest\r\n\t\t@description Fired when this peer is the peer group leader and another peer asks to\r\n\t\tjoin the peer group. If no event listeners have been added to listen for this event\r\n\t\tthen any peer that connects to the group will automatically be accepted as a new\r\n\t\tmember. If you add a listener and later remove it then no new peers will able to\r\n\t\tjoin the group until you add another listener (or invoke acceptUser in another context).\r\n\t\t@type {PeerGroupEvent}\r\n\t*/\r\n\r\n\t/**\t@event PeerGroup~ejected\r\n\t\t@description Fired when this peer is refused permission to join the requested peer\r\n\t\tgroup or when it's forcibly removed from the peer group.\r\n\t\t@type {PeerGroupEvent}\r\n\t*/\r\n\r\n\t/**@callback PeerGroup~ErrorCallback\r\n\t\t@param {Error} error The error that occurred.\r\n\t */\r\n\r\n\t/**\tConstructs a PeerGroup object.\r\n\t\t@param {PeerGroup~ErrorCallback} onError A function that will be invoked if a\r\n\t\tnetworking error occurs that Peer.js Groups cannot handle internally.\r\n\t\t@param {object} options The options passed to the Peer.js server.\r\n\t*/\r\n\tconstructor(onError, options) {\r\n\t\tsuper();\r\n\r\n\t\t/**\tAn identifier chosen to identify this peer.\r\n\t\t\t@type {string}\r\n\t\t*/\r\n\t\tvar userID;\r\n\r\n\t\t/**\tMaps from randomized peer names to [DataConnection]{@linkcode https://elizabethhudnott.github.io/peerjs-groups/lib/doc/peer.html#dataconnection} objects.\r\n\t\t\tRecords peers that are connected to this peer and belong to the peer group.\r\n\t\t*/\r\n\t\tvar connections = new Map();\r\n\r\n\t\t/**\tMaps from randomized peer names to [DataConnection]{@linkcode https://elizabethhudnott.github.io/peerjs-groups/lib/doc/peer.html#dataconnection} objects.\r\n\t\t\tRecords peers that are waiting for approval to join the peer group.\r\n\t\t\tOnly used on the leading peer.\r\n\t\t*/\r\n\t\tvar pending = new Map();\r\n\r\n\t\t/**\tSet of peer IDs we're in process of trying to connect to. */\r\n\t\tvar tryingToConnect = new Set();\r\n\r\n\t\t/**\tMaps from random peer name to chosen identities (unescaped). */\r\n\t\tvar peersToUsers = new Map();\r\n\r\n\t\t/**\tMaps from chosen identities (HTML escaped) to randomized peer names.  */\r\n\t\tvar usersToPeers = new Map();\r\n\r\n\t\t/**\tRecords the user identities that have been allowed to join the peer group. */\r\n\t\tvar acceptedUsers = new Set();\r\n\r\n\t\t/**\tRecords the user identities that have been prohibited from joining (or rejoining) the peer group. */\r\n\t\tvar rejectedUsers = new Set();\r\n\r\n\t\t/**\tThe [Peer]{@linkcode https://elizabethhudnott.github.io/peerjs-groups/lib/doc/peer.html#peer}\r\n\t\t\tobject for this machine.\r\n\t\t*/\r\n\t\tvar peer;\r\n\r\n\t\t/**\tThe name of the peer group to which this peer currently belongs.\r\n\t\t\t@type {string}\r\n\t\t*/\r\n\t\tvar sessionID;\r\n\r\n\t\t/**\tTrue if we've been accepted into the group and have tried to open connections\r\n\t\t\teach of the other peers and have waited for a response.\r\n\t\t*/\r\n\t\tvar joined = false;\r\n\r\n\t\t/**\tTrue if a joinrequest event listener has ever been added to this PeerGroup. */\r\n\t\tvar hasJoinRequestListenerAdded = false;\r\n\r\n\t\tconst me = this;\r\n\r\n\t\t/**\tDescribes the type of content contained in a message sent between peers.\r\n\t\t\t@enum\r\n\t\t*/\r\n\t\tconst MsgType = Object.freeze({\r\n\t\t\t/**\tData message. The meaning of the message is defined by your application.\r\n\t\t\t\tThe data is forwarded to the application via a {@link PeerGroup~event:message} event.\r\n\t\t\t*/\r\n\t\t\tDATA: 1,\r\n\t\t\t/**\tA message informing the receiving peer of the sending peer's user ID. */\r\n\t\t\tIDENTIFY: 2,\r\n\t\t\t/** A message informing the receiving peer of the peer IDs of the other peers\r\n\t\t\t\tthat belong to the peer group.\r\n\t\t\t*/\r\n\t\t\tPEER_LIST: 3,\r\n\t\t\t/**\tSimilar to a data message but sent to a single peer rather than to all\r\n\t\t\t\tpeers belonging to the peer group.\r\n\t\t\t*/\r\n\t\t\tPRIVATE_MSG: 4,\r\n\t\t\t/**\tSent when a peer is forcefully denied membership of the peer group. */\r\n\t\t\tCONNECT_ERROR: 5,\r\n\t\t});\r\n\r\n\t\t/**\t@typedef Message\r\n\t\t\t@description Members of this type are sent from one peer to another.\r\n\t\t\t@private\r\n\t\t*/\r\n\r\n\t\t/**\tDescribes the kinds of errors that can occur which need to be sent from one peer to another.\r\n\t\t\t@enum\r\n\t\t*/\r\n\t\tconst ErrorType = Object.freeze({\r\n\t\t\t/**\tA peer attempted to join a peer group with the same user ID as another\r\n\t\t\t\tpeer that already belongs to the peer group.\r\n\t\t\t*/\r\n\t\t\tDUPLICATE_USER_ID: 1,\r\n\t\t\t/**\tA peer was prevented from joining the peer group because of a human decision\r\n\t\t\t\tto reject it.\r\n\t\t\t*/\r\n\t\t\tPROHIBITED: 2\r\n\t\t});\r\n\r\n\t\t/**\tConstructs a Message.\r\n\t\t\tN.B. Do not convert this to a class. Peer.js doesn't support sending class instances.\r\n\t\t\t@param {MsgType} type Identifies the kind of message being sent.\r\n\t\t\t@param {any} data The message payload. For MsgType.DATA the data\r\n\t\t\tproperty contains the application level data.\r\n\t\t\t@return {Message} The constructed message.\r\n\t\t*/\r\n\t\tfunction makeMessage(type, data) {\r\n\t\t\treturn {\r\n\t\t\t\ttype: type,\r\n\t\t\t\tdata: data\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t/**\tCreates a PeerGroupEvent. */\r\n\t\tfunction createEvent(type, properties) {\r\n\t\t\tvar isAdmin = peer.id === sessionID && sessionID !== undefined;\r\n\t\t\treturn new PeerGroupEvent(type, isAdmin, properties);\r\n\t\t}\r\n\r\n\t\t/**\tRaises an error.\r\n\t\t\t@param {Error} error The error that has occurred.\r\n\t\t*/\r\n\t\tfunction throwError(error) {\r\n\t\t\tif (onError) {\r\n\t\t\t\tonError(error);\r\n\t\t\t} else {\r\n\t\t\t\tthrow error;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\tCalled when a peer initially establishes a network connection with the peer group leader.\r\n\t\t\tThis method is called on the peer that initiated the connection.\r\n\t\t\tThe new peer does not become a member of the peer group until application\r\n\t\t\taccepts the new peer.\r\n\t\t\t@param {string} id The name of the peer group.\r\n\t\t\t@fires PeerGroup#connected\r\n\t\t*/\r\n\t\tfunction connected(id) {\r\n\t\t\tsessionID = id;\r\n\t\t\tvar event = createEvent('connected', {\r\n\t\t\t\tsessionID: id,\r\n\t\t\t\tuserID: escapeHTML(userID),\r\n\t\t\t\tisPrivate: true\r\n\t\t\t});\r\n\t\t\tme.dispatchEvent(event);\r\n\t\t}\r\n\r\n\t\t/**\tCalled when the local peer becomes part of a peer group.\r\n\t\t\t@fires PeerGroup#joined\r\n\t\t*/\r\n\t\tfunction sessionEntered() {\r\n\t\t\tjoined = true;\r\n\t\t\tvar event = createEvent('joined', {\r\n\t\t\t\tsessionID: sessionID,\r\n\t\t\t\tuserID: escapeHTML(userID),\r\n\t\t\t\tisPrivate: false\r\n\t\t\t});\r\n\t\t\tme.dispatchEvent(event);\r\n\t\t}\r\n\r\n\t\t/**\tFinds the user ID of the peer at the other end of a connection.\r\n\t\t\t@param {DataConnection} connection The connection to analyse.\r\n\t\t\t@return {string} The user ID of the peer at the other end of a connection\r\n\t\t\tidentified by the connection parameter.\r\n\t\t*/\r\n\t\tfunction getUserID(connection) {\r\n\t\t\tvar label = connection.label;\r\n\t\t\tif (label === userID) {\r\n\t\t\t\treturn peersToUsers.get(connection.peer);\r\n\t\t\t} else {\r\n\t\t\t\treturn label;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\tSends a message to every member of the peer group.\r\n\t\t\t@param {Message} The message to send.\r\n\t\t*/\r\n\t\tfunction send(message) {\r\n\t\t\tfor (const connection of connections.values()) {\r\n\t\t\t\tconnection.send(message);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\tSends this peer's user ID to another peer.\r\n\t\t\t@param {DataConnection} connection A connection to the peer that should\r\n\t\t\treceive this peer's user ID.\r\n\t\t*/\r\n\t\tfunction sendIdentity(connection) {\r\n\t\t\tconnection.send(makeMessage(\r\n\t\t\t\tMsgType.IDENTIFY,\r\n\t\t\t\tuserID\r\n\t\t\t));\r\n\t\t}\r\n\r\n\t\t/**\tCalled when this peer receives a message from another peer.\r\n\t\t\t@param {Message} message The message received.\r\n\t\t\t@fires PeerGroup#userpresent\r\n\t\t\t@fires PeerGroup#ejected\r\n\t\t\t@fires PeerGroup#message\r\n\t\t*/\r\n\t\tfunction dataReceived(message) {\r\n\t\t\t//jshint validthis: true\r\n\t\t\tvar event;\r\n\t\t\tswitch (message.type) {\r\n\t\t\tcase MsgType.PEER_LIST:\r\n\t\t\t\t//Connect to the other peers in the peer group.\r\n\t\t\t\tif (this.peer === sessionID) {\r\n\t\t\t\t\tfor (const peerName of message.data) {\r\n\t\t\t\t\t\tif (peerName !== peer.id) {\r\n\t\t\t\t\t\t\tconnectTo(peerName);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase MsgType.IDENTIFY:\r\n\t\t\t\t//Record the user ID of another peer.\r\n\t\t\t\tvar remoteUserID = message.data;\r\n\t\t\t\tvar escapedUserID = escapeHTML(remoteUserID);\r\n\t\t\t\tpeersToUsers.set(this.peer, remoteUserID);\r\n\t\t\t\tusersToPeers.set(escapedUserID, this.peer);\r\n\t\t\t\ttryingToConnect.delete(this.peer);\r\n\t\t\t\tevent = createEvent('userpresent', {\r\n\t\t\t\t\tsessionID: sessionID,\r\n\t\t\t\t\tuserID: escapedUserID,\r\n\t\t\t\t\tisPrivate: false\r\n\t\t\t\t});\r\n\t\t\t\tme.dispatchEvent(event);\r\n\t\t\t\tif (!joined && tryingToConnect.size === 0) {\r\n\t\t\t\t\tsessionEntered();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase MsgType.CONNECT_ERROR:\r\n\t\t\t\t//We were either refused permission to join the peer group or kicked out.\r\n\t\t\t\tevent = createEvent('ejected', {\r\n\t\t\t\t\tsessionID: sessionID,\r\n\t\t\t\t\tuserID: userID,\r\n\t\t\t\t\terrorType: message.errorType,\r\n\t\t\t\t\tmessage: message.data,\r\n\t\t\t\t\tisPrivate: message.errorType === ErrorType.PROHIBITED? undefined : false\r\n\t\t\t\t});\r\n\t\t\t\tme.dispatchEvent(event);\r\n\t\t\t\tbreak;\r\n\t\t\tcase MsgType.DATA:\r\n\t\t\tcase MsgType.PRIVATE_MSG:\r\n\t\t\t\t//Forward the application level message to the application.\r\n\t\t\t\tevent = createEvent('message', {\r\n\t\t\t\t\tsessionID: sessionID,\r\n\t\t\t\t\tuserID: escapeHTML(getUserID(this)),\r\n\t\t\t\t\tmessage: message.data,\r\n\t\t\t\t\tisPrivate: message.type === MsgType.PRIVATE_MSG\r\n\t\t\t\t});\r\n\t\t\t\tme.dispatchEvent(event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\tCalled when this peer's connection to another member of the peer group is\r\n\t\t\tlost. Not called if this peer isn't a member of a peer group or if the\r\n\t\t\tdisconnect() function has been invoked.\r\n\t\t*/\r\n\t\tfunction connectionClosed() {\r\n\t\t\t//jshint validthis: true\r\n\t\t\tvar label = this.label;\r\n\t\t\tvar peerName = this.peer;\r\n\t\t\tvar disconnectedUser, event;\r\n\t\t\tif (label === userID) {\r\n\t\t\t\tdisconnectedUser = peersToUsers.get(peerName);\r\n\t\t\t} else {\r\n\t\t\t\tdisconnectedUser = label;\r\n\t\t\t}\r\n\t\t\tconnections.delete(peerName);\r\n\r\n\t\t\tif (disconnectedUser !== undefined) {\r\n\t\t\t\tevent = createEvent('userleft', {\r\n\t\t\t\t\tsessionID: sessionID,\r\n\t\t\t\t\tuserID: escapeHTML(disconnectedUser),\r\n\t\t\t\t\tisPrivate: false\r\n\t\t\t\t});\r\n\t\t\t\tme.dispatchEvent(event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\tCloses all existing connections and resets the state of the PeerGroup object. */\r\n\t\tfunction disconnect() {\r\n\t\t\tfor (const connection of connections.values()) {\r\n\t\t\t\tconnection.off('close', connectionClosed);\r\n\t\t\t\tconnection.close();\r\n\t\t\t}\r\n\t\t\tif (peer !== undefined) {\r\n\t\t\t\tpeer.destroy();\r\n\t\t\t}\r\n\t\t\tpeersToUsers.clear();\r\n\t\t\tusersToPeers.clear();\r\n\t\t\ttryingToConnect.clear();\r\n\t\t\tacceptedUsers.clear();\r\n\t\t\trejectedUsers.clear();\r\n\t\t}\r\n\r\n\t\t/**\tOpens a connection to another member of the peer group\r\n\t\t\t(a connection between two peers, neither or whom is the peer group leader).\r\n\t\t\t@param {string} peerName The peer ID of the peer to connect to.\r\n\t\t*/\r\n\t\tfunction connectTo(peerName) {\r\n\t\t\ttryingToConnect.add(peerName);\r\n\t\t\tvar connection = peer.connect(peerName, {\r\n\t\t\t\tlabel: userID,\r\n\t\t\t\tmetadata: {sessionID: sessionID},\r\n\t\t\t\treliable: true\r\n\t\t\t});\r\n\t\t\tconnection.on('data', dataReceived);\r\n\t\t\tconnection.on('error', function (error) {\r\n\t\t\t\ttryingToConnect.delete(this.peer);\r\n\t\t\t\tthrowError(error);\r\n\t\t\t});\r\n\t\t\tconnection.on('open', function () {\r\n\t\t\t\tconnections.set(peerName, connection);\r\n\t\t\t});\r\n\t\t\tconnection.on('close', connectionClosed);\r\n\t\t}\r\n\r\n\t\t/**\tSends an error message to another peer and then closes the connection.\r\n\t\t\t@param {DataConnection} connection The connection to the peer to disconnect from.\r\n\t\t\t@param {ErrorType} reason A code stating the reason for terminating the connection.\r\n\t\t\t@param {string} errorMessage A string explaining the reason for terminating the connection.\r\n\t\t*/\r\n\t\tfunction rejectConnection(connection, reason, errorMessage) {\r\n\t\t\tvar message = makeMessage(MsgType.CONNECT_ERROR, errorMessage);\r\n\t\t\tmessage.errorType = reason;\r\n\t\t\tconnection.send(message);\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tconnection.close();\r\n\t\t\t}, 2000);\r\n\t\t}\r\n\r\n\t\t/**\tConfigures this peer to act as the peer group leader. */\r\n\t\tfunction createSession () {\r\n\t\t\tif (peer !== undefined) {\r\n\t\t\t\tpeer.destroy();\r\n\t\t\t}\r\n\t\t\tpeer = new Peer(sessionID, options);\r\n\t\t\tpeer.on('error', function (error) {\r\n\t\t\t\tif (error.type === 'unavailable-id') {\r\n\t\t\t\t\tme.connect(sessionID);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrowError(error);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tpeer.on('open', function () {\r\n\t\t\t\tconnected(peer.id);\r\n\t\t\t\tsessionEntered();\r\n\t\t\t});\r\n\r\n\t\t\tpeer.on('connection', function (connection) {\r\n\t\t\t\tconnection.on('open', function () {\r\n\t\t\t\t\t//Rejected users are not welcome.\r\n\t\t\t\t\tvar newUserID = connection.label;\r\n\t\t\t\t\tif (rejectedUsers.has(newUserID)) {\r\n\t\t\t\t\t\trejectConnection(\r\n\t\t\t\t\t\t\tconnection,\r\n\t\t\t\t\t\t\tErrorType.PROHIBITED,\r\n\t\t\t\t\t\t\t`You\\'ve been banned from the session \"${sessionID}\".`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//No support currently for the same user being logged in from more than one place.\r\n\t\t\t\t\tvar existingPeerName = usersToPeers.get(newUserID);\r\n\t\t\t\t\tif (newUserID === userID ||\r\n\t\t\t\t\t\tconnections.has(existingPeerName) ||\r\n\t\t\t\t\t\tpending.has(existingPeerName)\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\trejectConnection(\r\n\t\t\t\t\t\t\tconnection,\r\n\t\t\t\t\t\t\tErrorType.DUPLICATE_USER_ID,\r\n\t\t\t\t\t\t\t`User ID \"${newUserID}\" is already taken.`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar peerName = connection.peer;\r\n\r\n\t\t\t\t\t//An existing peer might change it's user ID.\r\n\t\t\t\t\tvar existingUserID = peersToUsers.get(peerName);\r\n\t\t\t\t\tif (existingUserID !== undefined) {\r\n\t\t\t\t\t\tusersToPeers.delete(existingUserID);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//Respond to the connection request.\r\n\t\t\t\t\tpeersToUsers.set(peerName, newUserID);\r\n\t\t\t\t\tusersToPeers.set(escapeHTML(newUserID), peerName);\r\n\r\n\t\t\t\t\tpending.set(peerName, connection);\r\n\t\t\t\t\tconnection.on('error', onError);\r\n\r\n\t\t\t\t\tif (acceptedUsers.has(newUserID) || !hasJoinRequestListenerAdded) {\r\n\t\t\t\t\t\tme.acceptUser(newUserID);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconnection.on('close', function () {\r\n\t\t\t\t\t\t\tpending.delete(this.peer);\r\n\t\t\t\t\t\t\tpeersToUsers.delete(this.peer);\r\n\t\t\t\t\t\t\tusersToPeers.delete(escapeHTML(this.label));\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tvar event = createEvent('joinrequest', {\r\n\t\t\t\t\t\t\tsessionID: sessionID,\r\n\t\t\t\t\t\t\tuserID: escapeHTML(connection.label),\r\n\t\t\t\t\t\t\tisPrivate: true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tme.dispatchEvent(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t/**\tAttempts to connect to a peer group, or creates the group if it doesn't exist yet.\r\n\t\t\t@param {string} sessionIDToJoin The name of the peer group to try to join.\r\n\t\t\t@param {string} myUserID The identifier this peer would like to be known by.\r\n\t\t*/\r\n\t\tthis.connect = function(sessionIDToJoin, myUserID) {\r\n\t\t\tvar firstConnection;\r\n\r\n\t\t\tdisconnect();\r\n\t\t\tsessionID = sessionIDToJoin;\r\n\t\t\tuserID = myUserID;\r\n\t\t\tjoined = false;\r\n\r\n\t\t\tif (sessionID === undefined) {\r\n\t\t\t\tcreateSession();\r\n\t\t\t} else if (!PeerGroup.validSessionID.test(sessionIDToJoin)) {\r\n\t\t\t\tthrowError(new Error('Invalid session ID.'));\r\n\t\t\t} else {\r\n\r\n\t\t\t\tpeer = new Peer(options);\r\n\t\t\t\tpeer.on('error', function (error) {\r\n\t\t\t\t\tif (error.type === 'peer-unavailable') {\r\n\t\t\t\t\t\tif (error.message.slice(-sessionID.length) === sessionID) {\r\n\t\t\t\t\t\t\tcreateSession(sessionID, onError);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t/*Ignore. Been asked by the broker to connect to a peer\r\n\t\t\t\t\t\t\t  that's since gone offline. */\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrowError(error);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpeer.on('open', function () {\r\n\t\t\t\t\tfirstConnection = peer.connect(sessionID, {\r\n\t\t\t\t\t\tlabel: userID,\r\n\t\t\t\t\t\treliable: true\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tfirstConnection.on('data', dataReceived);\r\n\t\t\t\t\tfirstConnection.on('error', onError);\r\n\t\t\t\t\tfirstConnection.on('close', connectionClosed);\r\n\r\n\t\t\t\t\tfirstConnection.on('open', function () {\r\n\t\t\t\t\t\tconnections.set(sessionID, this);\r\n\t\t\t\t\t\tconnected(sessionID);\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpeer.on('connection', function (connection) {\r\n\t\t\t\t\tconnection.on('open', function () {\r\n\t\t\t\t\t\tif (connection.metadata.sessionID === sessionID) {\r\n\t\t\t\t\t\t\tvar newUserID = connection.label;\r\n\t\t\t\t\t\t\tvar peerName = connection.peer;\r\n\r\n\t\t\t\t\t\t\t//An existing peer might change it's user ID.\r\n\t\t\t\t\t\t\tvar existingUserID = peersToUsers.get(peerName);\r\n\t\t\t\t\t\t\tif (existingUserID !== undefined) {\r\n\t\t\t\t\t\t\t\tusersToPeers.delete(existingUserID);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t//Respond to the connection request.\r\n\t\t\t\t\t\t\tpeersToUsers.set(peerName, newUserID);\r\n\t\t\t\t\t\t\tusersToPeers.set(escapeHTML(newUserID), peerName);\r\n\r\n\t\t\t\t\t\t\tconnections.set(peerName, connection);\r\n\t\t\t\t\t\t\tsendIdentity(connection);\r\n\t\t\t\t\t\t\tconnection.on('data', dataReceived);\r\n\t\t\t\t\t\t\tconnection.on('error', onError);\r\n\t\t\t\t\t\t\tconnection.on('close', connectionClosed);\r\n\r\n\t\t\t\t\t\t\tvar event = createEvent('userpresent', {\r\n\t\t\t\t\t\t\t\tsessionID: sessionID,\r\n\t\t\t\t\t\t\t\tuserID: escapeHTML(newUserID),\r\n\t\t\t\t\t\t\t\tisPrivate: false\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tme.dispatchEvent(event);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconnection.close();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t} // end if sessionID is defined.\r\n\t\t}; // end of connect method.\r\n\r\n\t\t/**\tDisconnects from the peer group (if connected to one) or cancels any pending\r\n\t\t\tapplication to join a peer group.\r\n\t\t*/\r\n\t\tthis.disconnect = function () {\r\n\t\t\tdisconnect();\r\n\t\t};\r\n\r\n\t\t/**\tAuthorizes a peer to join the peer group.\r\n\t\t\t@param {string} newUserID The user ID of a peer (typically one that is waiting\r\n\t\t\tto join the peer group).\r\n\t\t*/\r\n\t\tthis.acceptUser = function(newUserID) {\r\n\t\t\tacceptedUsers.add(newUserID);\r\n\t\t\tvar peerName = usersToPeers.get(newUserID);\r\n\t\t\tvar connection = pending.get(peerName);\r\n\t\t\tif (connection === undefined) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tpending.delete(peerName);\r\n\t\t\tconnections.set(peerName, connection);\r\n\t\t\tconnection.on('data', dataReceived);\r\n\t\t\tconnection.on('close', connectionClosed);\r\n\r\n\t\t\tconnection.send(makeMessage(\r\n\t\t\t\tMsgType.PEER_LIST,\r\n\t\t\t\tArray.from(connections.keys())\r\n\t\t\t));\r\n\t\t\tsendIdentity(connection);\r\n\r\n\t\t\tvar event = createEvent('userpresent', {\r\n\t\t\t\tsessionID: sessionID,\r\n\t\t\t\tuserID: newUserID,\r\n\t\t\t\tisPrivate: false\r\n\t\t\t});\r\n\t\t\tme.dispatchEvent(event);\r\n\t\t};\r\n\r\n\t\t/**\tPrevents a peer with a given user ID from joining the peer group or removes\r\n\t\t\tan existing member from the peer group.\r\n\t\t\t@param {string} remoteUserID The user ID of a peer belonging to the\r\n\t\t\tpeer group or the user ID of a peer waiting to join the peer group.\r\n\t\t*/\r\n\t\tthis.rejectUser = function(remoteUserID) {\r\n\t\t\trejectedUsers.add(remoteUserID);\r\n\t\t\tvar peerName = usersToPeers.get(remoteUserID);\r\n\t\t\tpeersToUsers.delete(peerName);\r\n\t\t\tusersToPeers.delete(remoteUserID);\r\n\r\n\t\t\tvar connection = pending.get(peerName);\r\n\t\t\tif (connection === undefined) {\r\n\t\t\t\tconnection = connections.get(peerName);\r\n\t\t\t}\r\n\t\t\tif (connection !== undefined) {\r\n\t\t\t\trejectConnection(\r\n\t\t\t\t\tconnection,\r\n\t\t\t\t\tErrorType.PROHIBITED,\r\n\t\t\t\t\t`You've been banned from the session \"${sessionID}\".`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\tSends a message to all members of the peer group.\r\n\t\t\t@param {any} data The data to send.\r\n\t\t*/\r\n\t\tthis.send = function(data) {\r\n\t\t\tsend(makeMessage(\r\n\t\t\t\tMsgType.DATA,\r\n\t\t\t\tdata\r\n\t\t\t));\r\n\t\t};\r\n\r\n\t\t/**\tSends a message to a particular user.\r\n\t\t\t@param {string} destUser The user ID to send the data to.\r\n\t\t\t@param {any} data The data to send.\r\n\t\t*/\r\n\t\tthis.sendPrivate = function(destUser, data) {\r\n\t\t\tvar destPeerName = usersToPeers.get(destUser);\r\n\t\t\tif (destPeerName === undefined) {\r\n\t\t\t\tvar error = new Error(`No such user ${destUser}`);\r\n\t\t\t\tthrowError(error);\r\n\t\t\t} else {\r\n\t\t\t\tvar connection = connections.get(destPeerName);\r\n\t\t\t\tif (connection === undefined) {\r\n\t\t\t\t\tconnection = pending.get(destPeerName);\r\n\t\t\t\t}\r\n\t\t\t\tconnection.send(makeMessage(\r\n\t\t\t\t\tMsgType.PRIVATE_MSG,\r\n\t\t\t\t\tdata\r\n\t\t\t\t));\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t/**\tThe set of all user IDs belonging to peers currently in the peer group.\r\n\t\t*/\r\n\t\tObject.defineProperty(this, 'userIDs', {\r\n\t\t\tenumerable: true,\r\n\t\t\tget() {\r\n\t\t\t\tlet userIDs = new Set();\r\n\t\t\t\tuserIDs.add(escapeHTML(userID));\r\n\t\t\t\tfor (let peerID of connections.keys()) {\r\n\t\t\t\t\tuserIDs.add(escapeHTML(peersToUsers.get(peerID)));\r\n\t\t\t\t}\r\n\t\t\t\treturn userIDs;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.addEventListener = function (type, listener, options) {\r\n\t\t\tif (type === 'joinrequest') {\r\n\t\t\t\thasJoinRequestListenerAdded = true;\r\n\t\t\t}\r\n\t\t\tPeerGroup.prototype.addEventListener.call(this, type, listener, options);\r\n\t\t};\r\n\r\n\t} // End of PeerGroup constructor.\r\n\r\n\t/**\tSpecifies what string are valid session IDs.\r\n\t\t@return {string} A regular expression that matches valid session IDs.\r\n\t*/\r\n\tstatic get validSessionID() {\r\n\t\treturn /^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/;\r\n\t}\r\n}\r\n\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/util/peerjs-groups.js?");

/***/ }),

/***/ "./src/util/three-mesh-bvh.js":
/*!************************************!*\
  !*** ./src/util/three-mesh-bvh.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"AVERAGE\": () => (/* binding */ AVERAGE),\n/* harmony export */   \"CENTER\": () => (/* binding */ CENTER),\n/* harmony export */   \"CONTAINED\": () => (/* binding */ CONTAINED),\n/* harmony export */   \"FloatVertexAttributeTexture\": () => (/* binding */ FloatVertexAttributeTexture),\n/* harmony export */   \"INTERSECTED\": () => (/* binding */ INTERSECTED),\n/* harmony export */   \"IntVertexAttributeTexture\": () => (/* binding */ IntVertexAttributeTexture),\n/* harmony export */   \"MeshBVH\": () => (/* binding */ MeshBVH),\n/* harmony export */   \"MeshBVHUniformStruct\": () => (/* binding */ MeshBVHUniformStruct),\n/* harmony export */   \"MeshBVHVisualizer\": () => (/* binding */ MeshBVHVisualizer),\n/* harmony export */   \"NOT_INTERSECTED\": () => (/* binding */ NOT_INTERSECTED),\n/* harmony export */   \"SAH\": () => (/* binding */ SAH),\n/* harmony export */   \"UIntVertexAttributeTexture\": () => (/* binding */ UIntVertexAttributeTexture),\n/* harmony export */   \"VertexAttributeTexture\": () => (/* binding */ VertexAttributeTexture),\n/* harmony export */   \"acceleratedRaycast\": () => (/* binding */ acceleratedRaycast),\n/* harmony export */   \"computeBoundsTree\": () => (/* binding */ computeBoundsTree),\n/* harmony export */   \"disposeBoundsTree\": () => (/* binding */ disposeBoundsTree),\n/* harmony export */   \"estimateMemoryInBytes\": () => (/* binding */ estimateMemoryInBytes),\n/* harmony export */   \"getBVHExtremes\": () => (/* binding */ getBVHExtremes),\n/* harmony export */   \"getJSONStructure\": () => (/* binding */ getJSONStructure),\n/* harmony export */   \"getTriangleHitPointInfo\": () => (/* binding */ getTriangleHitPointInfo),\n/* harmony export */   \"shaderIntersectFunction\": () => (/* binding */ shaderIntersectFunction),\n/* harmony export */   \"shaderStructs\": () => (/* binding */ shaderStructs),\n/* harmony export */   \"validateBounds\": () => (/* binding */ validateBounds)\n/* harmony export */ });\n/* harmony import */ var https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! https://cdn.skypack.dev/pin/three@v0.135.0-pjGUcRG9Xt70OdXl97VF/mode=imports/optimized/three.js */ \"https://cdn.skypack.dev/pin/three@v0.135.0-pjGUcRG9Xt70OdXl97VF/mode=imports/optimized/three.js\");\n\r\n\r\n// Split strategy constants\r\nconst CENTER = 0;\r\nconst AVERAGE = 1;\r\nconst SAH = 2;\r\n\r\n// Traversal constants\r\nconst NOT_INTERSECTED = 0;\r\nconst INTERSECTED = 1;\r\nconst CONTAINED = 2;\r\n\r\n// SAH cost constants\r\n// TODO: hone these costs more. The relative difference between them should be the\r\n// difference in measured time to perform a triangle intersection vs traversing\r\n// bounds.\r\nconst TRIANGLE_INTERSECT_COST = 1.25;\r\nconst TRAVERSAL_COST = 1;\r\n\r\n\r\n// Build constants\r\nconst BYTES_PER_NODE = 6 * 4 + 4 + 4;\r\nconst IS_LEAFNODE_FLAG = 0xFFFF;\r\n\r\n// EPSILON for computing floating point error during build\r\n// https://en.wikipedia.org/wiki/Machine_epsilon#Values_for_standard_hardware_floating_point_arithmetics\r\nconst FLOAT32_EPSILON = Math.pow(2, -24);\r\n\r\nclass MeshBVHNode {\r\n\r\n    constructor() {\r\n\r\n        // internal nodes have boundingData, left, right, and splitAxis\r\n        // leaf nodes have offset and count (referring to primitives in the mesh geometry)\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction arrayToBox(nodeIndex32, array, target) {\r\n\r\n    target.min.x = array[nodeIndex32];\r\n    target.min.y = array[nodeIndex32 + 1];\r\n    target.min.z = array[nodeIndex32 + 2];\r\n\r\n    target.max.x = array[nodeIndex32 + 3];\r\n    target.max.y = array[nodeIndex32 + 4];\r\n    target.max.z = array[nodeIndex32 + 5];\r\n\r\n    return target;\r\n\r\n}\r\n\r\nfunction getLongestEdgeIndex(bounds) {\r\n\r\n    let splitDimIdx = -1;\r\n    let splitDist = -Infinity;\r\n\r\n    for (let i = 0; i < 3; i++) {\r\n\r\n        const dist = bounds[i + 3] - bounds[i];\r\n        if (dist > splitDist) {\r\n\r\n            splitDist = dist;\r\n            splitDimIdx = i;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return splitDimIdx;\r\n\r\n}\r\n\r\n// copys bounds a into bounds b\r\nfunction copyBounds(source, target) {\r\n\r\n    target.set(source);\r\n\r\n}\r\n\r\n// sets bounds target to the union of bounds a and b\r\nfunction unionBounds(a, b, target) {\r\n\r\n    let aVal, bVal;\r\n    for (let d = 0; d < 3; d++) {\r\n\r\n        const d3 = d + 3;\r\n\r\n        // set the minimum values\r\n        aVal = a[d];\r\n        bVal = b[d];\r\n        target[d] = aVal < bVal ? aVal : bVal;\r\n\r\n        // set the max values\r\n        aVal = a[d3];\r\n        bVal = b[d3];\r\n        target[d3] = aVal > bVal ? aVal : bVal;\r\n\r\n    }\r\n\r\n}\r\n\r\n// expands the given bounds by the provided triangle bounds\r\nfunction expandByTriangleBounds(startIndex, triangleBounds, bounds) {\r\n\r\n    for (let d = 0; d < 3; d++) {\r\n\r\n        const tCenter = triangleBounds[startIndex + 2 * d];\r\n        const tHalf = triangleBounds[startIndex + 2 * d + 1];\r\n\r\n        const tMin = tCenter - tHalf;\r\n        const tMax = tCenter + tHalf;\r\n\r\n        if (tMin < bounds[d]) {\r\n\r\n            bounds[d] = tMin;\r\n\r\n        }\r\n\r\n        if (tMax > bounds[d + 3]) {\r\n\r\n            bounds[d + 3] = tMax;\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n// compute bounds surface area\r\nfunction computeSurfaceArea(bounds) {\r\n\r\n    const d0 = bounds[3] - bounds[0];\r\n    const d1 = bounds[4] - bounds[1];\r\n    const d2 = bounds[5] - bounds[2];\r\n\r\n    return 2 * (d0 * d1 + d1 * d2 + d2 * d0);\r\n\r\n}\r\n\r\nfunction ensureIndex(geo, options) {\r\n\r\n    if (!geo.index) {\r\n\r\n        const vertexCount = geo.attributes.position.count;\r\n        const BufferConstructor = options.useSharedArrayBuffer ? SharedArrayBuffer : ArrayBuffer;\r\n        let index;\r\n        if (vertexCount > 65535) {\r\n\r\n            index = new Uint32Array(new BufferConstructor(4 * vertexCount));\r\n\r\n        } else {\r\n\r\n            index = new Uint16Array(new BufferConstructor(2 * vertexCount));\r\n\r\n        }\r\n\r\n        geo.setIndex(new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.BufferAttribute(index, 1));\r\n\r\n        for (let i = 0; i < vertexCount; i++) {\r\n\r\n            index[i] = i;\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\n// Computes the set of { offset, count } ranges which need independent BVH roots. Each\r\n// region in the geometry index that belongs to a different set of material groups requires\r\n// a separate BVH root, so that triangles indices belonging to one group never get swapped\r\n// with triangle indices belongs to another group. For example, if the groups were like this:\r\n//\r\n// [-------------------------------------------------------------]\r\n// |__________________|\r\n//   g0 = [0, 20]  |______________________||_____________________|\r\n//                      g1 = [16, 40]           g2 = [41, 60]\r\n//\r\n// we would need four BVH roots: [0, 15], [16, 20], [21, 40], [41, 60].\r\nfunction getRootIndexRanges(geo) {\r\n\r\n    if (!geo.groups || !geo.groups.length) {\r\n\r\n        return [{ offset: 0, count: geo.index.count / 3 }];\r\n\r\n    }\r\n\r\n    const ranges = [];\r\n    const rangeBoundaries = new Set();\r\n    for (const group of geo.groups) {\r\n\r\n        rangeBoundaries.add(group.start);\r\n        rangeBoundaries.add(group.start + group.count);\r\n\r\n    }\r\n\r\n    // note that if you don't pass in a comparator, it sorts them lexicographically as strings :-(\r\n    const sortedBoundaries = Array.from(rangeBoundaries.values()).sort((a, b) => a - b);\r\n    for (let i = 0; i < sortedBoundaries.length - 1; i++) {\r\n\r\n        const start = sortedBoundaries[i],\r\n            end = sortedBoundaries[i + 1];\r\n        ranges.push({ offset: (start / 3), count: (end - start) / 3 });\r\n\r\n    }\r\n\r\n    return ranges;\r\n\r\n}\r\n\r\n// computes the union of the bounds of all of the given triangles and puts the resulting box in target. If\r\n// centroidTarget is provided then a bounding box is computed for the centroids of the triangles, as well.\r\n// These are computed together to avoid redundant accesses to bounds array.\r\nfunction getBounds(triangleBounds, offset, count, target, centroidTarget = null) {\r\n\r\n    let minx = Infinity;\r\n    let miny = Infinity;\r\n    let minz = Infinity;\r\n    let maxx = -Infinity;\r\n    let maxy = -Infinity;\r\n    let maxz = -Infinity;\r\n\r\n    let cminx = Infinity;\r\n    let cminy = Infinity;\r\n    let cminz = Infinity;\r\n    let cmaxx = -Infinity;\r\n    let cmaxy = -Infinity;\r\n    let cmaxz = -Infinity;\r\n\r\n    const includeCentroid = centroidTarget !== null;\r\n    for (let i = offset * 6, end = (offset + count) * 6; i < end; i += 6) {\r\n\r\n        const cx = triangleBounds[i + 0];\r\n        const hx = triangleBounds[i + 1];\r\n        const lx = cx - hx;\r\n        const rx = cx + hx;\r\n        if (lx < minx) minx = lx;\r\n        if (rx > maxx) maxx = rx;\r\n        if (includeCentroid && cx < cminx) cminx = cx;\r\n        if (includeCentroid && cx > cmaxx) cmaxx = cx;\r\n\r\n        const cy = triangleBounds[i + 2];\r\n        const hy = triangleBounds[i + 3];\r\n        const ly = cy - hy;\r\n        const ry = cy + hy;\r\n        if (ly < miny) miny = ly;\r\n        if (ry > maxy) maxy = ry;\r\n        if (includeCentroid && cy < cminy) cminy = cy;\r\n        if (includeCentroid && cy > cmaxy) cmaxy = cy;\r\n\r\n        const cz = triangleBounds[i + 4];\r\n        const hz = triangleBounds[i + 5];\r\n        const lz = cz - hz;\r\n        const rz = cz + hz;\r\n        if (lz < minz) minz = lz;\r\n        if (rz > maxz) maxz = rz;\r\n        if (includeCentroid && cz < cminz) cminz = cz;\r\n        if (includeCentroid && cz > cmaxz) cmaxz = cz;\r\n\r\n    }\r\n\r\n    target[0] = minx;\r\n    target[1] = miny;\r\n    target[2] = minz;\r\n\r\n    target[3] = maxx;\r\n    target[4] = maxy;\r\n    target[5] = maxz;\r\n\r\n    if (includeCentroid) {\r\n\r\n        centroidTarget[0] = cminx;\r\n        centroidTarget[1] = cminy;\r\n        centroidTarget[2] = cminz;\r\n\r\n        centroidTarget[3] = cmaxx;\r\n        centroidTarget[4] = cmaxy;\r\n        centroidTarget[5] = cmaxz;\r\n\r\n    }\r\n\r\n}\r\n\r\n// A stand alone function for retrieving the centroid bounds.\r\nfunction getCentroidBounds(triangleBounds, offset, count, centroidTarget) {\r\n\r\n    let cminx = Infinity;\r\n    let cminy = Infinity;\r\n    let cminz = Infinity;\r\n    let cmaxx = -Infinity;\r\n    let cmaxy = -Infinity;\r\n    let cmaxz = -Infinity;\r\n\r\n    for (let i = offset * 6, end = (offset + count) * 6; i < end; i += 6) {\r\n\r\n        const cx = triangleBounds[i + 0];\r\n        if (cx < cminx) cminx = cx;\r\n        if (cx > cmaxx) cmaxx = cx;\r\n\r\n        const cy = triangleBounds[i + 2];\r\n        if (cy < cminy) cminy = cy;\r\n        if (cy > cmaxy) cmaxy = cy;\r\n\r\n        const cz = triangleBounds[i + 4];\r\n        if (cz < cminz) cminz = cz;\r\n        if (cz > cmaxz) cmaxz = cz;\r\n\r\n    }\r\n\r\n    centroidTarget[0] = cminx;\r\n    centroidTarget[1] = cminy;\r\n    centroidTarget[2] = cminz;\r\n\r\n    centroidTarget[3] = cmaxx;\r\n    centroidTarget[4] = cmaxy;\r\n    centroidTarget[5] = cmaxz;\r\n\r\n}\r\n\r\n\r\n// reorders `tris` such that for `count` elements after `offset`, elements on the left side of the split\r\n// will be on the left and elements on the right side of the split will be on the right. returns the index\r\n// of the first element on the right side, or offset + count if there are no elements on the right side.\r\nfunction partition(index, triangleBounds, offset, count, split) {\r\n\r\n    let left = offset;\r\n    let right = offset + count - 1;\r\n    const pos = split.pos;\r\n    const axisOffset = split.axis * 2;\r\n\r\n    // hoare partitioning, see e.g. https://en.wikipedia.org/wiki/Quicksort#Hoare_partition_scheme\r\n    while (true) {\r\n\r\n        while (left <= right && triangleBounds[left * 6 + axisOffset] < pos) {\r\n\r\n            left++;\r\n\r\n        }\r\n\r\n\r\n        // if a triangle center lies on the partition plane it is considered to be on the right side\r\n        while (left <= right && triangleBounds[right * 6 + axisOffset] >= pos) {\r\n\r\n            right--;\r\n\r\n        }\r\n\r\n        if (left < right) {\r\n\r\n            // we need to swap all of the information associated with the triangles at index\r\n            // left and right; that's the verts in the geometry index, the bounds,\r\n            // and perhaps the SAH planes\r\n\r\n            for (let i = 0; i < 3; i++) {\r\n\r\n                let t0 = index[left * 3 + i];\r\n                index[left * 3 + i] = index[right * 3 + i];\r\n                index[right * 3 + i] = t0;\r\n\r\n                let t1 = triangleBounds[left * 6 + i * 2 + 0];\r\n                triangleBounds[left * 6 + i * 2 + 0] = triangleBounds[right * 6 + i * 2 + 0];\r\n                triangleBounds[right * 6 + i * 2 + 0] = t1;\r\n\r\n                let t2 = triangleBounds[left * 6 + i * 2 + 1];\r\n                triangleBounds[left * 6 + i * 2 + 1] = triangleBounds[right * 6 + i * 2 + 1];\r\n                triangleBounds[right * 6 + i * 2 + 1] = t2;\r\n\r\n            }\r\n\r\n            left++;\r\n            right--;\r\n\r\n        } else {\r\n\r\n            return left;\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nconst BIN_COUNT = 32;\r\nconst binsSort = (a, b) => a.candidate - b.candidate;\r\nconst sahBins = new Array(BIN_COUNT).fill().map(() => {\r\n\r\n    return {\r\n\r\n        count: 0,\r\n        bounds: new Float32Array(6),\r\n        rightCacheBounds: new Float32Array(6),\r\n        leftCacheBounds: new Float32Array(6),\r\n        candidate: 0,\r\n\r\n    };\r\n\r\n});\r\nconst leftBounds = new Float32Array(6);\r\n\r\nfunction getOptimalSplit(nodeBoundingData, centroidBoundingData, triangleBounds, offset, count, strategy) {\r\n\r\n    let axis = -1;\r\n    let pos = 0;\r\n\r\n    // Center\r\n    if (strategy === CENTER) {\r\n\r\n        axis = getLongestEdgeIndex(centroidBoundingData);\r\n        if (axis !== -1) {\r\n\r\n            pos = (centroidBoundingData[axis] + centroidBoundingData[axis + 3]) / 2;\r\n\r\n        }\r\n\r\n    } else if (strategy === AVERAGE) {\r\n\r\n        axis = getLongestEdgeIndex(nodeBoundingData);\r\n        if (axis !== -1) {\r\n\r\n            pos = getAverage(triangleBounds, offset, count, axis);\r\n\r\n        }\r\n\r\n    } else if (strategy === SAH) {\r\n\r\n        const rootSurfaceArea = computeSurfaceArea(nodeBoundingData);\r\n        let bestCost = TRIANGLE_INTERSECT_COST * count;\r\n\r\n        // iterate over all axes\r\n        const cStart = offset * 6;\r\n        const cEnd = (offset + count) * 6;\r\n        for (let a = 0; a < 3; a++) {\r\n\r\n            const axisLeft = centroidBoundingData[a];\r\n            const axisRight = centroidBoundingData[a + 3];\r\n            const axisLength = axisRight - axisLeft;\r\n            const binWidth = axisLength / BIN_COUNT;\r\n\r\n            // If we have fewer triangles than we're planning to split then just check all\r\n            // the triangle positions because it will be faster.\r\n            if (count < BIN_COUNT / 4) {\r\n\r\n                // initialize the bin candidates\r\n                const truncatedBins = [...sahBins];\r\n                truncatedBins.length = count;\r\n\r\n                // set the candidates\r\n                let b = 0;\r\n                for (let c = cStart; c < cEnd; c += 6, b++) {\r\n\r\n                    const bin = truncatedBins[b];\r\n                    bin.candidate = triangleBounds[c + 2 * a];\r\n                    bin.count = 0;\r\n\r\n                    const {\r\n                        bounds,\r\n                        leftCacheBounds,\r\n                        rightCacheBounds,\r\n                    } = bin;\r\n                    for (let d = 0; d < 3; d++) {\r\n\r\n                        rightCacheBounds[d] = Infinity;\r\n                        rightCacheBounds[d + 3] = -Infinity;\r\n\r\n                        leftCacheBounds[d] = Infinity;\r\n                        leftCacheBounds[d + 3] = -Infinity;\r\n\r\n                        bounds[d] = Infinity;\r\n                        bounds[d + 3] = -Infinity;\r\n\r\n                    }\r\n\r\n                    expandByTriangleBounds(c, triangleBounds, bounds);\r\n\r\n                }\r\n\r\n                truncatedBins.sort(binsSort);\r\n\r\n                // remove redundant splits\r\n                let splitCount = count;\r\n                for (let bi = 0; bi < splitCount; bi++) {\r\n\r\n                    const bin = truncatedBins[bi];\r\n                    while (bi + 1 < splitCount && truncatedBins[bi + 1].candidate === bin.candidate) {\r\n\r\n                        truncatedBins.splice(bi + 1, 1);\r\n                        splitCount--;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                // find the appropriate bin for each triangle and expand the bounds.\r\n                for (let c = cStart; c < cEnd; c += 6) {\r\n\r\n                    const center = triangleBounds[c + 2 * a];\r\n                    for (let bi = 0; bi < splitCount; bi++) {\r\n\r\n                        const bin = truncatedBins[bi];\r\n                        if (center >= bin.candidate) {\r\n\r\n                            expandByTriangleBounds(c, triangleBounds, bin.rightCacheBounds);\r\n\r\n                        } else {\r\n\r\n                            expandByTriangleBounds(c, triangleBounds, bin.leftCacheBounds);\r\n                            bin.count++;\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                // expand all the bounds\r\n                for (let bi = 0; bi < splitCount; bi++) {\r\n\r\n                    const bin = truncatedBins[bi];\r\n                    const leftCount = bin.count;\r\n                    const rightCount = count - bin.count;\r\n\r\n                    // check the cost of this split\r\n                    const leftBounds = bin.leftCacheBounds;\r\n                    const rightBounds = bin.rightCacheBounds;\r\n\r\n                    let leftProb = 0;\r\n                    if (leftCount !== 0) {\r\n\r\n                        leftProb = computeSurfaceArea(leftBounds) / rootSurfaceArea;\r\n\r\n                    }\r\n\r\n                    let rightProb = 0;\r\n                    if (rightCount !== 0) {\r\n\r\n                        rightProb = computeSurfaceArea(rightBounds) / rootSurfaceArea;\r\n\r\n                    }\r\n\r\n                    const cost = TRAVERSAL_COST + TRIANGLE_INTERSECT_COST * (\r\n                        leftProb * leftCount + rightProb * rightCount\r\n                    );\r\n\r\n                    if (cost < bestCost) {\r\n\r\n                        axis = a;\r\n                        bestCost = cost;\r\n                        pos = bin.candidate;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            } else {\r\n\r\n                // reset the bins\r\n                for (let i = 0; i < BIN_COUNT; i++) {\r\n\r\n                    const bin = sahBins[i];\r\n                    bin.count = 0;\r\n                    bin.candidate = axisLeft + binWidth + i * binWidth;\r\n\r\n                    const bounds = bin.bounds;\r\n                    for (let d = 0; d < 3; d++) {\r\n\r\n                        bounds[d] = Infinity;\r\n                        bounds[d + 3] = -Infinity;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                // iterate over all center positions\r\n                for (let c = cStart; c < cEnd; c += 6) {\r\n\r\n                    const triCenter = triangleBounds[c + 2 * a];\r\n                    const relativeCenter = triCenter - axisLeft;\r\n\r\n                    // in the partition function if the centroid lies on the split plane then it is\r\n                    // considered to be on the right side of the split\r\n                    let binIndex = ~~(relativeCenter / binWidth);\r\n                    if (binIndex >= BIN_COUNT) binIndex = BIN_COUNT - 1;\r\n\r\n                    const bin = sahBins[binIndex];\r\n                    bin.count++;\r\n\r\n                    expandByTriangleBounds(c, triangleBounds, bin.bounds);\r\n\r\n                }\r\n\r\n                // cache the unioned bounds from right to left so we don't have to regenerate them each time\r\n                const lastBin = sahBins[BIN_COUNT - 1];\r\n                copyBounds(lastBin.bounds, lastBin.rightCacheBounds);\r\n                for (let i = BIN_COUNT - 2; i >= 0; i--) {\r\n\r\n                    const bin = sahBins[i];\r\n                    const nextBin = sahBins[i + 1];\r\n                    unionBounds(bin.bounds, nextBin.rightCacheBounds, bin.rightCacheBounds);\r\n\r\n                }\r\n\r\n                let leftCount = 0;\r\n                for (let i = 0; i < BIN_COUNT - 1; i++) {\r\n\r\n                    const bin = sahBins[i];\r\n                    const binCount = bin.count;\r\n                    const bounds = bin.bounds;\r\n\r\n                    const nextBin = sahBins[i + 1];\r\n                    const rightBounds = nextBin.rightCacheBounds;\r\n\r\n                    // dont do anything with the bounds if the new bounds have no triangles\r\n                    if (binCount !== 0) {\r\n\r\n                        if (leftCount === 0) {\r\n\r\n                            copyBounds(bounds, leftBounds);\r\n\r\n                        } else {\r\n\r\n                            unionBounds(bounds, leftBounds, leftBounds);\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                    leftCount += binCount;\r\n\r\n                    // check the cost of this split\r\n                    let leftProb = 0;\r\n                    let rightProb = 0;\r\n\r\n                    if (leftCount !== 0) {\r\n\r\n                        leftProb = computeSurfaceArea(leftBounds) / rootSurfaceArea;\r\n\r\n                    }\r\n\r\n                    const rightCount = count - leftCount;\r\n                    if (rightCount !== 0) {\r\n\r\n                        rightProb = computeSurfaceArea(rightBounds) / rootSurfaceArea;\r\n\r\n                    }\r\n\r\n                    const cost = TRAVERSAL_COST + TRIANGLE_INTERSECT_COST * (\r\n                        leftProb * leftCount + rightProb * rightCount\r\n                    );\r\n\r\n                    if (cost < bestCost) {\r\n\r\n                        axis = a;\r\n                        bestCost = cost;\r\n                        pos = bin.candidate;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n    } else {\r\n\r\n        console.warn(`MeshBVH: Invalid build strategy value ${ strategy } used.`);\r\n\r\n    }\r\n\r\n    return { axis, pos };\r\n\r\n}\r\n\r\n// returns the average coordinate on the specified axis of the all the provided triangles\r\nfunction getAverage(triangleBounds, offset, count, axis) {\r\n\r\n    let avg = 0;\r\n    for (let i = offset, end = offset + count; i < end; i++) {\r\n\r\n        avg += triangleBounds[i * 6 + axis * 2];\r\n\r\n    }\r\n\r\n    return avg / count;\r\n\r\n}\r\n\r\n// precomputes the bounding box for each triangle; required for quickly calculating tree splits.\r\n// result is an array of size tris.length * 6 where triangle i maps to a\r\n// [x_center, x_delta, y_center, y_delta, z_center, z_delta] tuple starting at index i * 6,\r\n// representing the center and half-extent in each dimension of triangle i\r\nfunction computeTriangleBounds(geo, fullBounds) {\r\n\r\n    const posAttr = geo.attributes.position;\r\n    const posArr = posAttr.array;\r\n    const index = geo.index.array;\r\n    const triCount = index.length / 3;\r\n    const triangleBounds = new Float32Array(triCount * 6);\r\n\r\n    // support for an interleaved position buffer\r\n    const bufferOffset = posAttr.offset || 0;\r\n    let stride = 3;\r\n    if (posAttr.isInterleavedBufferAttribute) {\r\n\r\n        stride = posAttr.data.stride;\r\n\r\n    }\r\n\r\n    for (let tri = 0; tri < triCount; tri++) {\r\n\r\n        const tri3 = tri * 3;\r\n        const tri6 = tri * 6;\r\n        const ai = index[tri3 + 0] * stride + bufferOffset;\r\n        const bi = index[tri3 + 1] * stride + bufferOffset;\r\n        const ci = index[tri3 + 2] * stride + bufferOffset;\r\n\r\n        for (let el = 0; el < 3; el++) {\r\n\r\n            const a = posArr[ai + el];\r\n            const b = posArr[bi + el];\r\n            const c = posArr[ci + el];\r\n\r\n            let min = a;\r\n            if (b < min) min = b;\r\n            if (c < min) min = c;\r\n\r\n            let max = a;\r\n            if (b > max) max = b;\r\n            if (c > max) max = c;\r\n\r\n            // Increase the bounds size by float32 epsilon to avoid precision errors when\r\n            // converting to 32 bit float. Scale the epsilon by the size of the numbers being\r\n            // worked with.\r\n            const halfExtents = (max - min) / 2;\r\n            const el2 = el * 2;\r\n            triangleBounds[tri6 + el2 + 0] = min + halfExtents;\r\n            triangleBounds[tri6 + el2 + 1] = halfExtents + (Math.abs(min) + halfExtents) * FLOAT32_EPSILON;\r\n\r\n            if (min < fullBounds[el]) fullBounds[el] = min;\r\n            if (max > fullBounds[el + 3]) fullBounds[el + 3] = max;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return triangleBounds;\r\n\r\n}\r\n\r\nfunction buildTree(geo, options) {\r\n\r\n    function triggerProgress(trianglesProcessed) {\r\n\r\n        if (onProgress) {\r\n\r\n            onProgress(trianglesProcessed / totalTriangles);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    // either recursively splits the given node, creating left and right subtrees for it, or makes it a leaf node,\r\n    // recording the offset and count of its triangles and writing them into the reordered geometry index.\r\n    function splitNode(node, offset, count, centroidBoundingData = null, depth = 0) {\r\n\r\n        if (!reachedMaxDepth && depth >= maxDepth) {\r\n\r\n            reachedMaxDepth = true;\r\n            if (verbose) {\r\n\r\n                console.warn(`MeshBVH: Max depth of ${ maxDepth } reached when generating BVH. Consider increasing maxDepth.`);\r\n                console.warn(geo);\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // early out if we've met our capacity\r\n        if (count <= maxLeafTris || depth >= maxDepth) {\r\n\r\n            triggerProgress(offset);\r\n            node.offset = offset;\r\n            node.count = count;\r\n            return node;\r\n\r\n        }\r\n\r\n        // Find where to split the volume\r\n        const split = getOptimalSplit(node.boundingData, centroidBoundingData, triangleBounds, offset, count, strategy);\r\n        if (split.axis === -1) {\r\n\r\n            triggerProgress(offset);\r\n            node.offset = offset;\r\n            node.count = count;\r\n            return node;\r\n\r\n        }\r\n\r\n        const splitOffset = partition(indexArray, triangleBounds, offset, count, split);\r\n\r\n        // create the two new child nodes\r\n        if (splitOffset === offset || splitOffset === offset + count) {\r\n\r\n            triggerProgress(offset);\r\n            node.offset = offset;\r\n            node.count = count;\r\n\r\n        } else {\r\n\r\n            node.splitAxis = split.axis;\r\n\r\n            // create the left child and compute its bounding box\r\n            const left = new MeshBVHNode();\r\n            const lstart = offset;\r\n            const lcount = splitOffset - offset;\r\n            node.left = left;\r\n            left.boundingData = new Float32Array(6);\r\n\r\n            getBounds(triangleBounds, lstart, lcount, left.boundingData, cacheCentroidBoundingData);\r\n            splitNode(left, lstart, lcount, cacheCentroidBoundingData, depth + 1);\r\n\r\n            // repeat for right\r\n            const right = new MeshBVHNode();\r\n            const rstart = splitOffset;\r\n            const rcount = count - lcount;\r\n            node.right = right;\r\n            right.boundingData = new Float32Array(6);\r\n\r\n            getBounds(triangleBounds, rstart, rcount, right.boundingData, cacheCentroidBoundingData);\r\n            splitNode(right, rstart, rcount, cacheCentroidBoundingData, depth + 1);\r\n\r\n        }\r\n\r\n        return node;\r\n\r\n    }\r\n\r\n    ensureIndex(geo, options);\r\n\r\n    // Compute the full bounds of the geometry at the same time as triangle bounds because\r\n    // we'll need it for the root bounds in the case with no groups and it should be fast here.\r\n    // We can't use the geometrying bounding box if it's available because it may be out of date.\r\n    const fullBounds = new Float32Array(6);\r\n    const cacheCentroidBoundingData = new Float32Array(6);\r\n    const triangleBounds = computeTriangleBounds(geo, fullBounds);\r\n    const indexArray = geo.index.array;\r\n    const maxDepth = options.maxDepth;\r\n    const verbose = options.verbose;\r\n    const maxLeafTris = options.maxLeafTris;\r\n    const strategy = options.strategy;\r\n    const onProgress = options.onProgress;\r\n    const totalTriangles = geo.index.count / 3;\r\n    let reachedMaxDepth = false;\r\n\r\n    const roots = [];\r\n    const ranges = getRootIndexRanges(geo);\r\n\r\n    if (ranges.length === 1) {\r\n\r\n        const range = ranges[0];\r\n        const root = new MeshBVHNode();\r\n        root.boundingData = fullBounds;\r\n        getCentroidBounds(triangleBounds, range.offset, range.count, cacheCentroidBoundingData);\r\n\r\n        splitNode(root, range.offset, range.count, cacheCentroidBoundingData);\r\n        roots.push(root);\r\n\r\n    } else {\r\n\r\n        for (let range of ranges) {\r\n\r\n            const root = new MeshBVHNode();\r\n            root.boundingData = new Float32Array(6);\r\n            getBounds(triangleBounds, range.offset, range.count, root.boundingData, cacheCentroidBoundingData);\r\n\r\n            splitNode(root, range.offset, range.count, cacheCentroidBoundingData);\r\n            roots.push(root);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return roots;\r\n\r\n}\r\n\r\nfunction buildPackedTree(geo, options) {\r\n\r\n    // boundingData  \t\t\t\t: 6 float32\r\n    // right / offset \t\t\t\t: 1 uint32\r\n    // splitAxis / isLeaf + count \t: 1 uint32 / 2 uint16\r\n    const roots = buildTree(geo, options);\r\n\r\n    let float32Array;\r\n    let uint32Array;\r\n    let uint16Array;\r\n    const packedRoots = [];\r\n    const BufferConstructor = options.useSharedArrayBuffer ? SharedArrayBuffer : ArrayBuffer;\r\n    for (let i = 0; i < roots.length; i++) {\r\n\r\n        const root = roots[i];\r\n        let nodeCount = countNodes(root);\r\n\r\n        const buffer = new BufferConstructor(BYTES_PER_NODE * nodeCount);\r\n        float32Array = new Float32Array(buffer);\r\n        uint32Array = new Uint32Array(buffer);\r\n        uint16Array = new Uint16Array(buffer);\r\n        populateBuffer(0, root);\r\n        packedRoots.push(buffer);\r\n\r\n    }\r\n\r\n    return packedRoots;\r\n\r\n    function countNodes(node) {\r\n\r\n        if (node.count) {\r\n\r\n            return 1;\r\n\r\n        } else {\r\n\r\n            return 1 + countNodes(node.left) + countNodes(node.right);\r\n\r\n        }\r\n\r\n    }\r\n\r\n    function populateBuffer(byteOffset, node) {\r\n\r\n        const stride4Offset = byteOffset / 4;\r\n        const stride2Offset = byteOffset / 2;\r\n        const isLeaf = !!node.count;\r\n        const boundingData = node.boundingData;\r\n        for (let i = 0; i < 6; i++) {\r\n\r\n            float32Array[stride4Offset + i] = boundingData[i];\r\n\r\n        }\r\n\r\n        if (isLeaf) {\r\n\r\n            const offset = node.offset;\r\n            const count = node.count;\r\n            uint32Array[stride4Offset + 6] = offset;\r\n            uint16Array[stride2Offset + 14] = count;\r\n            uint16Array[stride2Offset + 15] = IS_LEAFNODE_FLAG;\r\n            return byteOffset + BYTES_PER_NODE;\r\n\r\n        } else {\r\n\r\n            const left = node.left;\r\n            const right = node.right;\r\n            const splitAxis = node.splitAxis;\r\n\r\n            let nextUnusedPointer;\r\n            nextUnusedPointer = populateBuffer(byteOffset + BYTES_PER_NODE, left);\r\n\r\n            if ((nextUnusedPointer / 4) > Math.pow(2, 32)) {\r\n\r\n                throw new Error('MeshBVH: Cannot store child pointer greater than 32 bits.');\r\n\r\n            }\r\n\r\n            uint32Array[stride4Offset + 6] = nextUnusedPointer / 4;\r\n            nextUnusedPointer = populateBuffer(nextUnusedPointer, right);\r\n\r\n            uint32Array[stride4Offset + 7] = splitAxis;\r\n            return nextUnusedPointer;\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nclass SeparatingAxisBounds {\r\n\r\n    constructor() {\r\n\r\n        this.min = Infinity;\r\n        this.max = -Infinity;\r\n\r\n    }\r\n\r\n    setFromPointsField(points, field) {\r\n\r\n        let min = Infinity;\r\n        let max = -Infinity;\r\n        for (let i = 0, l = points.length; i < l; i++) {\r\n\r\n            const p = points[i];\r\n            const val = p[field];\r\n            min = val < min ? val : min;\r\n            max = val > max ? val : max;\r\n\r\n        }\r\n\r\n        this.min = min;\r\n        this.max = max;\r\n\r\n    }\r\n\r\n    setFromPoints(axis, points) {\r\n\r\n        let min = Infinity;\r\n        let max = -Infinity;\r\n        for (let i = 0, l = points.length; i < l; i++) {\r\n\r\n            const p = points[i];\r\n            const val = axis.dot(p);\r\n            min = val < min ? val : min;\r\n            max = val > max ? val : max;\r\n\r\n        }\r\n\r\n        this.min = min;\r\n        this.max = max;\r\n\r\n    }\r\n\r\n    isSeparated(other) {\r\n\r\n        return this.min > other.max || other.min > this.max;\r\n\r\n    }\r\n\r\n}\r\n\r\nSeparatingAxisBounds.prototype.setFromBox = (function() {\r\n\r\n    const p = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    return function setFromBox(axis, box) {\r\n\r\n        const boxMin = box.min;\r\n        const boxMax = box.max;\r\n        let min = Infinity;\r\n        let max = -Infinity;\r\n        for (let x = 0; x <= 1; x++) {\r\n\r\n            for (let y = 0; y <= 1; y++) {\r\n\r\n                for (let z = 0; z <= 1; z++) {\r\n\r\n                    p.x = boxMin.x * x + boxMax.x * (1 - x);\r\n                    p.y = boxMin.y * y + boxMax.y * (1 - y);\r\n                    p.z = boxMin.z * z + boxMax.z * (1 - z);\r\n\r\n                    const val = axis.dot(p);\r\n                    min = Math.min(val, min);\r\n                    max = Math.max(val, max);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.min = min;\r\n        this.max = max;\r\n\r\n    };\r\n\r\n})();\r\n\r\nconst areIntersecting = (function() {\r\n\r\n    const cacheSatBounds = new SeparatingAxisBounds();\r\n    return function areIntersecting(shape1, shape2) {\r\n\r\n        const points1 = shape1.points;\r\n        const satAxes1 = shape1.satAxes;\r\n        const satBounds1 = shape1.satBounds;\r\n\r\n        const points2 = shape2.points;\r\n        const satAxes2 = shape2.satAxes;\r\n        const satBounds2 = shape2.satBounds;\r\n\r\n        // check axes of the first shape\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            const sb = satBounds1[i];\r\n            const sa = satAxes1[i];\r\n            cacheSatBounds.setFromPoints(sa, points2);\r\n            if (sb.isSeparated(cacheSatBounds)) return false;\r\n\r\n        }\r\n\r\n        // check axes of the second shape\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            const sb = satBounds2[i];\r\n            const sa = satAxes2[i];\r\n            cacheSatBounds.setFromPoints(sa, points1);\r\n            if (sb.isSeparated(cacheSatBounds)) return false;\r\n\r\n        }\r\n\r\n    };\r\n\r\n})();\r\n\r\nconst closestPointLineToLine = (function() {\r\n\r\n    // https://github.com/juj/MathGeoLib/blob/master/src/Geometry/Line.cpp#L56\r\n    const dir1 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const dir2 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const v02 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    return function closestPointLineToLine(l1, l2, result) {\r\n\r\n        const v0 = l1.start;\r\n        const v10 = dir1;\r\n        const v2 = l2.start;\r\n        const v32 = dir2;\r\n\r\n        v02.subVectors(v0, v2);\r\n        dir1.subVectors(l1.end, l2.start);\r\n        dir2.subVectors(l2.end, l2.start);\r\n\r\n        // float d0232 = v02.Dot(v32);\r\n        const d0232 = v02.dot(v32);\r\n\r\n        // float d3210 = v32.Dot(v10);\r\n        const d3210 = v32.dot(v10);\r\n\r\n        // float d3232 = v32.Dot(v32);\r\n        const d3232 = v32.dot(v32);\r\n\r\n        // float d0210 = v02.Dot(v10);\r\n        const d0210 = v02.dot(v10);\r\n\r\n        // float d1010 = v10.Dot(v10);\r\n        const d1010 = v10.dot(v10);\r\n\r\n        // float denom = d1010*d3232 - d3210*d3210;\r\n        const denom = d1010 * d3232 - d3210 * d3210;\r\n\r\n        let d, d2;\r\n        if (denom !== 0) {\r\n\r\n            d = (d0232 * d3210 - d0210 * d3232) / denom;\r\n\r\n        } else {\r\n\r\n            d = 0;\r\n\r\n        }\r\n\r\n        d2 = (d0232 + d * d3210) / d3232;\r\n\r\n        result.x = d;\r\n        result.y = d2;\r\n\r\n    };\r\n\r\n})();\r\n\r\nconst closestPointsSegmentToSegment = (function() {\r\n\r\n    // https://github.com/juj/MathGeoLib/blob/master/src/Geometry/LineSegment.cpp#L187\r\n    const paramResult = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2();\r\n    const temp1 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const temp2 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    return function closestPointsSegmentToSegment(l1, l2, target1, target2) {\r\n\r\n        closestPointLineToLine(l1, l2, paramResult);\r\n\r\n        let d = paramResult.x;\r\n        let d2 = paramResult.y;\r\n        if (d >= 0 && d <= 1 && d2 >= 0 && d2 <= 1) {\r\n\r\n            l1.at(d, target1);\r\n            l2.at(d2, target2);\r\n\r\n            return;\r\n\r\n        } else if (d >= 0 && d <= 1) {\r\n\r\n            // Only d2 is out of bounds.\r\n            if (d2 < 0) {\r\n\r\n                l2.at(0, target2);\r\n\r\n            } else {\r\n\r\n                l2.at(1, target2);\r\n\r\n            }\r\n\r\n            l1.closestPointToPoint(target2, true, target1);\r\n            return;\r\n\r\n        } else if (d2 >= 0 && d2 <= 1) {\r\n\r\n            // Only d is out of bounds.\r\n            if (d < 0) {\r\n\r\n                l1.at(0, target1);\r\n\r\n            } else {\r\n\r\n                l1.at(1, target1);\r\n\r\n            }\r\n\r\n            l2.closestPointToPoint(target1, true, target2);\r\n            return;\r\n\r\n        } else {\r\n\r\n            // Both u and u2 are out of bounds.\r\n            let p;\r\n            if (d < 0) {\r\n\r\n                p = l1.start;\r\n\r\n            } else {\r\n\r\n                p = l1.end;\r\n\r\n            }\r\n\r\n            let p2;\r\n            if (d2 < 0) {\r\n\r\n                p2 = l2.start;\r\n\r\n            } else {\r\n\r\n                p2 = l2.end;\r\n\r\n            }\r\n\r\n            const closestPoint = temp1;\r\n            const closestPoint2 = temp2;\r\n            l1.closestPointToPoint(p2, true, temp1);\r\n            l2.closestPointToPoint(p, true, temp2);\r\n\r\n            if (closestPoint.distanceToSquared(p2) <= closestPoint2.distanceToSquared(p)) {\r\n\r\n                target1.copy(closestPoint);\r\n                target2.copy(p2);\r\n                return;\r\n\r\n            } else {\r\n\r\n                target1.copy(p);\r\n                target2.copy(closestPoint2);\r\n                return;\r\n\r\n            }\r\n\r\n        }\r\n\r\n    };\r\n\r\n})();\r\n\r\n\r\nconst sphereIntersectTriangle = (function() {\r\n\r\n    // https://stackoverflow.com/questions/34043955/detect-collision-between-sphere-and-triangle-in-three-js\r\n    const closestPointTemp = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const projectedPointTemp = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const planeTemp = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Plane();\r\n    const lineTemp = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3();\r\n    return function sphereIntersectTriangle(sphere, triangle) {\r\n\r\n        const { radius, center } = sphere;\r\n        const { a, b, c } = triangle;\r\n\r\n        // phase 1\r\n        lineTemp.start = a;\r\n        lineTemp.end = b;\r\n        const closestPoint1 = lineTemp.closestPointToPoint(center, true, closestPointTemp);\r\n        if (closestPoint1.distanceTo(center) <= radius) return true;\r\n\r\n        lineTemp.start = a;\r\n        lineTemp.end = c;\r\n        const closestPoint2 = lineTemp.closestPointToPoint(center, true, closestPointTemp);\r\n        if (closestPoint2.distanceTo(center) <= radius) return true;\r\n\r\n        lineTemp.start = b;\r\n        lineTemp.end = c;\r\n        const closestPoint3 = lineTemp.closestPointToPoint(center, true, closestPointTemp);\r\n        if (closestPoint3.distanceTo(center) <= radius) return true;\r\n\r\n        // phase 2\r\n        const plane = triangle.getPlane(planeTemp);\r\n        const dp = Math.abs(plane.distanceToPoint(center));\r\n        if (dp <= radius) {\r\n\r\n            const pp = plane.projectPoint(center, projectedPointTemp);\r\n            const cp = triangle.containsPoint(pp);\r\n            if (cp) return true;\r\n\r\n        }\r\n\r\n        return false;\r\n\r\n    };\r\n\r\n})();\r\n\r\nclass SeparatingAxisTriangle extends https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Triangle {\r\n\r\n    constructor(...args) {\r\n\r\n        super(...args);\r\n\r\n        this.isSeparatingAxisTriangle = true;\r\n        this.satAxes = new Array(4).fill().map(() => new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3());\r\n        this.satBounds = new Array(4).fill().map(() => new SeparatingAxisBounds());\r\n        this.points = [this.a, this.b, this.c];\r\n        this.sphere = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Sphere();\r\n        this.plane = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Plane();\r\n        this.needsUpdate = false;\r\n\r\n    }\r\n\r\n    intersectsSphere(sphere) {\r\n\r\n        return sphereIntersectTriangle(sphere, this);\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n        const a = this.a;\r\n        const b = this.b;\r\n        const c = this.c;\r\n        const points = this.points;\r\n\r\n        const satAxes = this.satAxes;\r\n        const satBounds = this.satBounds;\r\n\r\n        const axis0 = satAxes[0];\r\n        const sab0 = satBounds[0];\r\n        this.getNormal(axis0);\r\n        sab0.setFromPoints(axis0, points);\r\n\r\n        const axis1 = satAxes[1];\r\n        const sab1 = satBounds[1];\r\n        axis1.subVectors(a, b);\r\n        sab1.setFromPoints(axis1, points);\r\n\r\n        const axis2 = satAxes[2];\r\n        const sab2 = satBounds[2];\r\n        axis2.subVectors(b, c);\r\n        sab2.setFromPoints(axis2, points);\r\n\r\n        const axis3 = satAxes[3];\r\n        const sab3 = satBounds[3];\r\n        axis3.subVectors(c, a);\r\n        sab3.setFromPoints(axis3, points);\r\n\r\n        this.sphere.setFromPoints(this.points);\r\n        this.plane.setFromNormalAndCoplanarPoint(axis0, a);\r\n        this.needsUpdate = false;\r\n\r\n    }\r\n\r\n}\r\n\r\nSeparatingAxisTriangle.prototype.closestPointToSegment = (function() {\r\n\r\n    const point1 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const point2 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const edge = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3();\r\n\r\n    return function distanceToSegment(segment, target1 = null, target2 = null) {\r\n\r\n        const { start, end } = segment;\r\n        const points = this.points;\r\n        let distSq;\r\n        let closestDistanceSq = Infinity;\r\n\r\n        // check the triangle edges\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            const nexti = (i + 1) % 3;\r\n            edge.start.copy(points[i]);\r\n            edge.end.copy(points[nexti]);\r\n\r\n            closestPointsSegmentToSegment(edge, segment, point1, point2);\r\n\r\n            distSq = point1.distanceToSquared(point2);\r\n            if (distSq < closestDistanceSq) {\r\n\r\n                closestDistanceSq = distSq;\r\n                if (target1) target1.copy(point1);\r\n                if (target2) target2.copy(point2);\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // check end points\r\n        this.closestPointToPoint(start, point1);\r\n        distSq = start.distanceToSquared(point1);\r\n        if (distSq < closestDistanceSq) {\r\n\r\n            closestDistanceSq = distSq;\r\n            if (target1) target1.copy(point1);\r\n            if (target2) target2.copy(start);\r\n\r\n        }\r\n\r\n        this.closestPointToPoint(end, point1);\r\n        distSq = end.distanceToSquared(point1);\r\n        if (distSq < closestDistanceSq) {\r\n\r\n            closestDistanceSq = distSq;\r\n            if (target1) target1.copy(point1);\r\n            if (target2) target2.copy(end);\r\n\r\n        }\r\n\r\n        return Math.sqrt(closestDistanceSq);\r\n\r\n    };\r\n\r\n})();\r\n\r\nSeparatingAxisTriangle.prototype.intersectsTriangle = (function() {\r\n\r\n    const saTri2 = new SeparatingAxisTriangle();\r\n    const arr1 = new Array(3);\r\n    const arr2 = new Array(3);\r\n    const cachedSatBounds = new SeparatingAxisBounds();\r\n    const cachedSatBounds2 = new SeparatingAxisBounds();\r\n    const cachedAxis = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const dir1 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const dir2 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const tempDir = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const edge = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3();\r\n    const edge1 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3();\r\n    const edge2 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3();\r\n\r\n    // TODO: If the triangles are coplanar and intersecting the target is nonsensical. It should at least\r\n    // be a line contained by both triangles if not a different special case somehow represented in the return result.\r\n    return function intersectsTriangle(other, target = null) {\r\n\r\n        if (this.needsUpdate) {\r\n\r\n            this.update();\r\n\r\n        }\r\n\r\n        if (!other.isSeparatingAxisTriangle) {\r\n\r\n            saTri2.copy(other);\r\n            saTri2.update();\r\n            other = saTri2;\r\n\r\n        } else if (other.needsUpdate) {\r\n\r\n            other.update();\r\n\r\n        }\r\n\r\n        const satBounds1 = this.satBounds;\r\n        const satAxes1 = this.satAxes;\r\n        arr2[0] = other.a;\r\n        arr2[1] = other.b;\r\n        arr2[2] = other.c;\r\n        for (let i = 0; i < 4; i++) {\r\n\r\n            const sb = satBounds1[i];\r\n            const sa = satAxes1[i];\r\n            cachedSatBounds.setFromPoints(sa, arr2);\r\n            if (sb.isSeparated(cachedSatBounds)) return false;\r\n\r\n        }\r\n\r\n        const satBounds2 = other.satBounds;\r\n        const satAxes2 = other.satAxes;\r\n        arr1[0] = this.a;\r\n        arr1[1] = this.b;\r\n        arr1[2] = this.c;\r\n        for (let i = 0; i < 4; i++) {\r\n\r\n            const sb = satBounds2[i];\r\n            const sa = satAxes2[i];\r\n            cachedSatBounds.setFromPoints(sa, arr1);\r\n            if (sb.isSeparated(cachedSatBounds)) return false;\r\n\r\n        }\r\n\r\n        // check crossed axes\r\n        for (let i = 0; i < 4; i++) {\r\n\r\n            const sa1 = satAxes1[i];\r\n            for (let i2 = 0; i2 < 4; i2++) {\r\n\r\n                const sa2 = satAxes2[i2];\r\n                cachedAxis.crossVectors(sa1, sa2);\r\n                cachedSatBounds.setFromPoints(cachedAxis, arr1);\r\n                cachedSatBounds2.setFromPoints(cachedAxis, arr2);\r\n                if (cachedSatBounds.isSeparated(cachedSatBounds2)) return false;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        if (target) {\r\n\r\n            const plane1 = this.plane;\r\n            const plane2 = other.plane;\r\n\r\n            if (Math.abs(plane1.normal.dot(plane2.normal)) > 1.0 - 1e-10) {\r\n\r\n                // TODO find two points that intersect on the edges and make that the result\r\n                console.warn('SeparatingAxisTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0.');\r\n                target.start.set(0, 0, 0);\r\n                target.end.set(0, 0, 0);\r\n\r\n            } else {\r\n\r\n                // find the edge that intersects the other triangle plane\r\n                const points1 = this.points;\r\n                let found1 = false;\r\n                for (let i = 0; i < 3; i++) {\r\n\r\n                    const p1 = points1[i];\r\n                    const p2 = points1[(i + 1) % 3];\r\n\r\n                    edge.start.copy(p1);\r\n                    edge.end.copy(p2);\r\n\r\n                    if (plane2.intersectLine(edge, found1 ? edge1.start : edge1.end)) {\r\n\r\n                        if (found1) {\r\n\r\n                            break;\r\n\r\n                        }\r\n\r\n                        found1 = true;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                // find the other triangles edge that intersects this plane\r\n                const points2 = other.points;\r\n                let found2 = false;\r\n                for (let i = 0; i < 3; i++) {\r\n\r\n                    const p1 = points2[i];\r\n                    const p2 = points2[(i + 1) % 3];\r\n\r\n                    edge.start.copy(p1);\r\n                    edge.end.copy(p2);\r\n\r\n                    if (plane1.intersectLine(edge, found2 ? edge2.start : edge2.end)) {\r\n\r\n                        if (found2) {\r\n\r\n                            break;\r\n\r\n                        }\r\n\r\n                        found2 = true;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                // find swap the second edge so both lines are running the same direction\r\n                edge1.delta(dir1);\r\n                edge2.delta(dir2);\r\n\r\n\r\n                if (dir1.dot(dir2) < 0) {\r\n\r\n                    let tmp = edge2.start;\r\n                    edge2.start = edge2.end;\r\n                    edge2.end = tmp;\r\n\r\n                }\r\n\r\n                tempDir.subVectors(edge1.start, edge2.start);\r\n                if (tempDir.dot(dir1) > 0) {\r\n\r\n                    target.start.copy(edge1.start);\r\n\r\n                } else {\r\n\r\n                    target.start.copy(edge2.start);\r\n\r\n                }\r\n\r\n                tempDir.subVectors(edge1.end, edge2.end);\r\n                if (tempDir.dot(dir1) < 0) {\r\n\r\n                    target.end.copy(edge1.end);\r\n\r\n                } else {\r\n\r\n                    target.end.copy(edge2.end);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return true;\r\n\r\n    };\r\n\r\n})();\r\n\r\n\r\nSeparatingAxisTriangle.prototype.distanceToPoint = (function() {\r\n\r\n    const target = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    return function distanceToPoint(point) {\r\n\r\n        this.closestPointToPoint(point, target);\r\n        return point.distanceTo(target);\r\n\r\n    };\r\n\r\n})();\r\n\r\n\r\nSeparatingAxisTriangle.prototype.distanceToTriangle = (function() {\r\n\r\n    const point = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const point2 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const cornerFields = ['a', 'b', 'c'];\r\n    const line1 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3();\r\n    const line2 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3();\r\n\r\n    return function distanceToTriangle(other, target1 = null, target2 = null) {\r\n\r\n        const lineTarget = target1 || target2 ? line1 : null;\r\n        if (this.intersectsTriangle(other, lineTarget)) {\r\n\r\n            if (target1 || target2) {\r\n\r\n                if (target1) lineTarget.getCenter(target1);\r\n                if (target2) lineTarget.getCenter(target2);\r\n\r\n            }\r\n\r\n            return 0;\r\n\r\n        }\r\n\r\n        let closestDistanceSq = Infinity;\r\n\r\n        // check all point distances\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            let dist;\r\n            const field = cornerFields[i];\r\n            const otherVec = other[field];\r\n            this.closestPointToPoint(otherVec, point);\r\n\r\n            dist = otherVec.distanceToSquared(point);\r\n\r\n            if (dist < closestDistanceSq) {\r\n\r\n                closestDistanceSq = dist;\r\n                if (target1) target1.copy(point);\r\n                if (target2) target2.copy(otherVec);\r\n\r\n            }\r\n\r\n\r\n            const thisVec = this[field];\r\n            other.closestPointToPoint(thisVec, point);\r\n\r\n            dist = thisVec.distanceToSquared(point);\r\n\r\n            if (dist < closestDistanceSq) {\r\n\r\n                closestDistanceSq = dist;\r\n                if (target1) target1.copy(thisVec);\r\n                if (target2) target2.copy(point);\r\n\r\n            }\r\n\r\n        }\r\n\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            const f11 = cornerFields[i];\r\n            const f12 = cornerFields[(i + 1) % 3];\r\n            line1.set(this[f11], this[f12]);\r\n            for (let i2 = 0; i2 < 3; i2++) {\r\n\r\n                const f21 = cornerFields[i2];\r\n                const f22 = cornerFields[(i2 + 1) % 3];\r\n                line2.set(other[f21], other[f22]);\r\n\r\n                closestPointsSegmentToSegment(line1, line2, point, point2);\r\n\r\n                const dist = point.distanceToSquared(point2);\r\n                if (dist < closestDistanceSq) {\r\n\r\n                    closestDistanceSq = dist;\r\n                    if (target1) target1.copy(point);\r\n                    if (target2) target2.copy(point2);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return Math.sqrt(closestDistanceSq);\r\n\r\n    };\r\n\r\n})();\r\n\r\nclass OrientedBox extends https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3 {\r\n\r\n    constructor(...args) {\r\n\r\n        super(...args);\r\n\r\n        this.isOrientedBox = true;\r\n        this.matrix = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4();\r\n        this.invMatrix = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4();\r\n        this.points = new Array(8).fill().map(() => new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3());\r\n        this.satAxes = new Array(3).fill().map(() => new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3());\r\n        this.satBounds = new Array(3).fill().map(() => new SeparatingAxisBounds());\r\n        this.alignedSatBounds = new Array(3).fill().map(() => new SeparatingAxisBounds());\r\n        this.needsUpdate = false;\r\n\r\n    }\r\n\r\n    set(min, max, matrix) {\r\n\r\n        super.set(min, max);\r\n        this.matrix = matrix;\r\n        this.needsUpdate = true;\r\n\r\n    }\r\n\r\n    copy(other) {\r\n\r\n        super.copy(other);\r\n        this.matrix.copy(other.matrix);\r\n        this.needsUpdate = true;\r\n\r\n    }\r\n\r\n}\r\n\r\nOrientedBox.prototype.update = (function() {\r\n\r\n    return function update() {\r\n\r\n        const matrix = this.matrix;\r\n        const min = this.min;\r\n        const max = this.max;\r\n\r\n        const points = this.points;\r\n        for (let x = 0; x <= 1; x++) {\r\n\r\n            for (let y = 0; y <= 1; y++) {\r\n\r\n                for (let z = 0; z <= 1; z++) {\r\n\r\n                    const i = ((1 << 0) * x) | ((1 << 1) * y) | ((1 << 2) * z);\r\n                    const v = points[i];\r\n                    v.x = x ? max.x : min.x;\r\n                    v.y = y ? max.y : min.y;\r\n                    v.z = z ? max.z : min.z;\r\n\r\n                    v.applyMatrix4(matrix);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        const satBounds = this.satBounds;\r\n        const satAxes = this.satAxes;\r\n        const minVec = points[0];\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            const axis = satAxes[i];\r\n            const sb = satBounds[i];\r\n            const index = 1 << i;\r\n            const pi = points[index];\r\n\r\n            axis.subVectors(minVec, pi);\r\n            sb.setFromPoints(axis, points);\r\n\r\n        }\r\n\r\n        const alignedSatBounds = this.alignedSatBounds;\r\n        alignedSatBounds[0].setFromPointsField(points, 'x');\r\n        alignedSatBounds[1].setFromPointsField(points, 'y');\r\n        alignedSatBounds[2].setFromPointsField(points, 'z');\r\n\r\n        this.invMatrix.copy(this.matrix).invert();\r\n        this.needsUpdate = false;\r\n\r\n    };\r\n\r\n})();\r\n\r\nOrientedBox.prototype.intersectsBox = (function() {\r\n\r\n    const aabbBounds = new SeparatingAxisBounds();\r\n    return function intersectsBox(box) {\r\n\r\n        // TODO: should this be doing SAT against the AABB?\r\n        if (this.needsUpdate) {\r\n\r\n            this.update();\r\n\r\n        }\r\n\r\n        const min = box.min;\r\n        const max = box.max;\r\n        const satBounds = this.satBounds;\r\n        const satAxes = this.satAxes;\r\n        const alignedSatBounds = this.alignedSatBounds;\r\n\r\n        aabbBounds.min = min.x;\r\n        aabbBounds.max = max.x;\r\n        if (alignedSatBounds[0].isSeparated(aabbBounds)) return false;\r\n\r\n        aabbBounds.min = min.y;\r\n        aabbBounds.max = max.y;\r\n        if (alignedSatBounds[1].isSeparated(aabbBounds)) return false;\r\n\r\n        aabbBounds.min = min.z;\r\n        aabbBounds.max = max.z;\r\n        if (alignedSatBounds[2].isSeparated(aabbBounds)) return false;\r\n\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            const axis = satAxes[i];\r\n            const sb = satBounds[i];\r\n            aabbBounds.setFromBox(axis, box);\r\n            if (sb.isSeparated(aabbBounds)) return false;\r\n\r\n        }\r\n\r\n        return true;\r\n\r\n    };\r\n\r\n})();\r\n\r\nOrientedBox.prototype.intersectsTriangle = (function() {\r\n\r\n    const saTri = new SeparatingAxisTriangle();\r\n    const pointsArr = new Array(3);\r\n    const cachedSatBounds = new SeparatingAxisBounds();\r\n    const cachedSatBounds2 = new SeparatingAxisBounds();\r\n    const cachedAxis = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    return function intersectsTriangle(triangle) {\r\n\r\n        if (this.needsUpdate) {\r\n\r\n            this.update();\r\n\r\n        }\r\n\r\n        if (!triangle.isSeparatingAxisTriangle) {\r\n\r\n            saTri.copy(triangle);\r\n            saTri.update();\r\n            triangle = saTri;\r\n\r\n        } else if (triangle.needsUpdate) {\r\n\r\n            triangle.update();\r\n\r\n        }\r\n\r\n        const satBounds = this.satBounds;\r\n        const satAxes = this.satAxes;\r\n\r\n        pointsArr[0] = triangle.a;\r\n        pointsArr[1] = triangle.b;\r\n        pointsArr[2] = triangle.c;\r\n\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            const sb = satBounds[i];\r\n            const sa = satAxes[i];\r\n            cachedSatBounds.setFromPoints(sa, pointsArr);\r\n            if (sb.isSeparated(cachedSatBounds)) return false;\r\n\r\n        }\r\n\r\n        const triSatBounds = triangle.satBounds;\r\n        const triSatAxes = triangle.satAxes;\r\n        const points = this.points;\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            const sb = triSatBounds[i];\r\n            const sa = triSatAxes[i];\r\n            cachedSatBounds.setFromPoints(sa, points);\r\n            if (sb.isSeparated(cachedSatBounds)) return false;\r\n\r\n        }\r\n\r\n        // check crossed axes\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            const sa1 = satAxes[i];\r\n            for (let i2 = 0; i2 < 4; i2++) {\r\n\r\n                const sa2 = triSatAxes[i2];\r\n                cachedAxis.crossVectors(sa1, sa2);\r\n                cachedSatBounds.setFromPoints(cachedAxis, pointsArr);\r\n                cachedSatBounds2.setFromPoints(cachedAxis, points);\r\n                if (cachedSatBounds.isSeparated(cachedSatBounds2)) return false;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return true;\r\n\r\n    };\r\n\r\n})();\r\n\r\nOrientedBox.prototype.closestPointToPoint = (function() {\r\n\r\n    return function closestPointToPoint(point, target1) {\r\n\r\n        if (this.needsUpdate) {\r\n\r\n            this.update();\r\n\r\n        }\r\n\r\n        target1\r\n            .copy(point)\r\n            .applyMatrix4(this.invMatrix)\r\n            .clamp(this.min, this.max)\r\n            .applyMatrix4(this.matrix);\r\n\r\n        return target1;\r\n\r\n    };\r\n\r\n})();\r\n\r\nOrientedBox.prototype.distanceToPoint = (function() {\r\n\r\n    const target = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    return function distanceToPoint(point) {\r\n\r\n        this.closestPointToPoint(point, target);\r\n        return point.distanceTo(target);\r\n\r\n    };\r\n\r\n})();\r\n\r\nOrientedBox.prototype.distanceToBox = (function() {\r\n\r\n    const xyzFields = ['x', 'y', 'z'];\r\n    const segments1 = new Array(12).fill().map(() => new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3());\r\n    const segments2 = new Array(12).fill().map(() => new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Line3());\r\n\r\n    const point1 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n    const point2 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n\r\n    // early out if we find a value below threshold\r\n    return function distanceToBox(box, threshold = 0, target1 = null, target2 = null) {\r\n\r\n        if (this.needsUpdate) {\r\n\r\n            this.update();\r\n\r\n        }\r\n\r\n        if (this.intersectsBox(box)) {\r\n\r\n            if (target1 || target2) {\r\n\r\n                box.getCenter(point2);\r\n                this.closestPointToPoint(point2, point1);\r\n                box.closestPointToPoint(point1, point2);\r\n\r\n                if (target1) target1.copy(point1);\r\n                if (target2) target2.copy(point2);\r\n\r\n            }\r\n\r\n            return 0;\r\n\r\n        }\r\n\r\n        const threshold2 = threshold * threshold;\r\n        const min = box.min;\r\n        const max = box.max;\r\n        const points = this.points;\r\n\r\n\r\n        // iterate over every edge and compare distances\r\n        let closestDistanceSq = Infinity;\r\n\r\n        // check over all these points\r\n        for (let i = 0; i < 8; i++) {\r\n\r\n            const p = points[i];\r\n            point2.copy(p).clamp(min, max);\r\n\r\n            const dist = p.distanceToSquared(point2);\r\n            if (dist < closestDistanceSq) {\r\n\r\n                closestDistanceSq = dist;\r\n                if (target1) target1.copy(p);\r\n                if (target2) target2.copy(point2);\r\n\r\n                if (dist < threshold2) return Math.sqrt(dist);\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // generate and check all line segment distances\r\n        let count = 0;\r\n        for (let i = 0; i < 3; i++) {\r\n\r\n            for (let i1 = 0; i1 <= 1; i1++) {\r\n\r\n                for (let i2 = 0; i2 <= 1; i2++) {\r\n\r\n                    const nextIndex = (i + 1) % 3;\r\n                    const nextIndex2 = (i + 2) % 3;\r\n\r\n                    // get obb line segments\r\n                    const index = i1 << nextIndex | i2 << nextIndex2;\r\n                    const index2 = 1 << i | i1 << nextIndex | i2 << nextIndex2;\r\n                    const p1 = points[index];\r\n                    const p2 = points[index2];\r\n                    const line1 = segments1[count];\r\n                    line1.set(p1, p2);\r\n\r\n\r\n                    // get aabb line segments\r\n                    const f1 = xyzFields[i];\r\n                    const f2 = xyzFields[nextIndex];\r\n                    const f3 = xyzFields[nextIndex2];\r\n                    const line2 = segments2[count];\r\n                    const start = line2.start;\r\n                    const end = line2.end;\r\n\r\n                    start[f1] = min[f1];\r\n                    start[f2] = i1 ? min[f2] : max[f2];\r\n                    start[f3] = i2 ? min[f3] : max[f2];\r\n\r\n                    end[f1] = max[f1];\r\n                    end[f2] = i1 ? min[f2] : max[f2];\r\n                    end[f3] = i2 ? min[f3] : max[f2];\r\n\r\n                    count++;\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // check all the other boxes point\r\n        for (let x = 0; x <= 1; x++) {\r\n\r\n            for (let y = 0; y <= 1; y++) {\r\n\r\n                for (let z = 0; z <= 1; z++) {\r\n\r\n                    point2.x = x ? max.x : min.x;\r\n                    point2.y = y ? max.y : min.y;\r\n                    point2.z = z ? max.z : min.z;\r\n\r\n                    this.closestPointToPoint(point2, point1);\r\n                    const dist = point2.distanceToSquared(point1);\r\n                    if (dist < closestDistanceSq) {\r\n\r\n                        closestDistanceSq = dist;\r\n                        if (target1) target1.copy(point1);\r\n                        if (target2) target2.copy(point2);\r\n\r\n                        if (dist < threshold2) return Math.sqrt(dist);\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        for (let i = 0; i < 12; i++) {\r\n\r\n            const l1 = segments1[i];\r\n            for (let i2 = 0; i2 < 12; i2++) {\r\n\r\n                const l2 = segments2[i2];\r\n                closestPointsSegmentToSegment(l1, l2, point1, point2);\r\n                const dist = point1.distanceToSquared(point2);\r\n                if (dist < closestDistanceSq) {\r\n\r\n                    closestDistanceSq = dist;\r\n                    if (target1) target1.copy(point1);\r\n                    if (target2) target2.copy(point2);\r\n\r\n                    if (dist < threshold2) return Math.sqrt(dist);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return Math.sqrt(closestDistanceSq);\r\n\r\n    };\r\n\r\n})();\r\n\r\n// Ripped and modified From THREE.js Mesh raycast\r\n// https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L115\r\nconst vA = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst vB = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst vC = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n\r\nconst uvA = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2();\r\nconst uvB = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2();\r\nconst uvC = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2();\r\n\r\nconst intersectionPoint = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n\r\nfunction checkIntersection(ray, pA, pB, pC, point, side) {\r\n\r\n    let intersect;\r\n    if (side === https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.BackSide) {\r\n\r\n        intersect = ray.intersectTriangle(pC, pB, pA, true, point);\r\n\r\n    } else {\r\n\r\n        intersect = ray.intersectTriangle(pA, pB, pC, side !== https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.DoubleSide, point);\r\n\r\n    }\r\n\r\n    if (intersect === null) return null;\r\n\r\n    const distance = ray.origin.distanceTo(point);\r\n\r\n    return {\r\n\r\n        distance: distance,\r\n        point: point.clone(),\r\n\r\n    };\r\n\r\n}\r\n\r\nfunction checkBufferGeometryIntersection(ray, position, uv, a, b, c, side) {\r\n\r\n    vA.fromBufferAttribute(position, a);\r\n    vB.fromBufferAttribute(position, b);\r\n    vC.fromBufferAttribute(position, c);\r\n\r\n    const intersection = checkIntersection(ray, vA, vB, vC, intersectionPoint, side);\r\n\r\n    if (intersection) {\r\n\r\n        if (uv) {\r\n\r\n            uvA.fromBufferAttribute(uv, a);\r\n            uvB.fromBufferAttribute(uv, b);\r\n            uvC.fromBufferAttribute(uv, c);\r\n\r\n            intersection.uv = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Triangle.getUV(intersectionPoint, vA, vB, vC, uvA, uvB, uvC, new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2());\r\n\r\n        }\r\n\r\n        const face = {\r\n            a: a,\r\n            b: b,\r\n            c: c,\r\n            normal: new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3(),\r\n            materialIndex: 0\r\n        };\r\n\r\n        https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Triangle.getNormal(vA, vB, vC, face.normal);\r\n\r\n        intersection.face = face;\r\n        intersection.faceIndex = a;\r\n\r\n    }\r\n\r\n    return intersection;\r\n\r\n}\r\n\r\n// https://github.com/mrdoob/three.js/blob/0aa87c999fe61e216c1133fba7a95772b503eddf/src/objects/Mesh.js#L258\r\nfunction intersectTri(geo, side, ray, tri, intersections) {\r\n\r\n    const triOffset = tri * 3;\r\n    const a = geo.index.getX(triOffset);\r\n    const b = geo.index.getX(triOffset + 1);\r\n    const c = geo.index.getX(triOffset + 2);\r\n\r\n    const intersection = checkBufferGeometryIntersection(ray, geo.attributes.position, geo.attributes.uv, a, b, c, side);\r\n\r\n    if (intersection) {\r\n\r\n        intersection.faceIndex = tri;\r\n        if (intersections) intersections.push(intersection);\r\n        return intersection;\r\n\r\n    }\r\n\r\n    return null;\r\n\r\n}\r\n\r\nfunction intersectTris(geo, side, ray, offset, count, intersections) {\r\n\r\n    for (let i = offset, end = offset + count; i < end; i++) {\r\n\r\n        intersectTri(geo, side, ray, i, intersections);\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction intersectClosestTri(geo, side, ray, offset, count) {\r\n\r\n    let dist = Infinity;\r\n    let res = null;\r\n    for (let i = offset, end = offset + count; i < end; i++) {\r\n\r\n        const intersection = intersectTri(geo, side, ray, i);\r\n        if (intersection && intersection.distance < dist) {\r\n\r\n            res = intersection;\r\n            dist = intersection.distance;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return res;\r\n\r\n}\r\n\r\n// converts the given BVH raycast intersection to align with the three.js raycast\r\n// structure (include object, world space distance and point).\r\nfunction convertRaycastIntersect(hit, object, raycaster) {\r\n\r\n    if (hit === null) {\r\n\r\n        return null;\r\n\r\n    }\r\n\r\n    hit.point.applyMatrix4(object.matrixWorld);\r\n    hit.distance = hit.point.distanceTo(raycaster.ray.origin);\r\n    hit.object = object;\r\n\r\n    if (hit.distance < raycaster.near || hit.distance > raycaster.far) {\r\n\r\n        return null;\r\n\r\n    } else {\r\n\r\n        return hit;\r\n\r\n    }\r\n\r\n}\r\n\r\n// sets the vertices of triangle `tri` with the 3 vertices after i\r\nfunction setTriangle(tri, i, index, pos) {\r\n\r\n    const ta = tri.a;\r\n    const tb = tri.b;\r\n    const tc = tri.c;\r\n\r\n    let i0 = i;\r\n    let i1 = i + 1;\r\n    let i2 = i + 2;\r\n    if (index) {\r\n\r\n        i0 = index.getX(i);\r\n        i1 = index.getX(i + 1);\r\n        i2 = index.getX(i + 2);\r\n\r\n    }\r\n\r\n    ta.x = pos.getX(i0);\r\n    ta.y = pos.getY(i0);\r\n    ta.z = pos.getZ(i0);\r\n\r\n    tb.x = pos.getX(i1);\r\n    tb.y = pos.getY(i1);\r\n    tb.z = pos.getZ(i1);\r\n\r\n    tc.x = pos.getX(i2);\r\n    tc.y = pos.getY(i2);\r\n    tc.z = pos.getZ(i2);\r\n\r\n}\r\n\r\nfunction iterateOverTriangles(\r\n    offset,\r\n    count,\r\n    geometry,\r\n    intersectsTriangleFunc,\r\n    contained,\r\n    depth,\r\n    triangle\r\n) {\r\n\r\n    const index = geometry.index;\r\n    const pos = geometry.attributes.position;\r\n    for (let i = offset, l = count + offset; i < l; i++) {\r\n\r\n        setTriangle(triangle, i * 3, index, pos);\r\n        triangle.needsUpdate = true;\r\n\r\n        if (intersectsTriangleFunc(triangle, i, contained, depth)) {\r\n\r\n            return true;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return false;\r\n\r\n}\r\n\r\nconst tempV1 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst tempV2 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst tempV3 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst tempUV1 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2();\r\nconst tempUV2 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2();\r\nconst tempUV3 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2();\r\n\r\nfunction getTriangleHitPointInfo(point, geometry, triangleIndex, target) {\r\n\r\n    const indices = geometry.getIndex().array;\r\n    const positions = geometry.getAttribute('position');\r\n    const uvs = geometry.getAttribute('uv');\r\n\r\n    const a = indices[triangleIndex * 3];\r\n    const b = indices[triangleIndex * 3 + 1];\r\n    const c = indices[triangleIndex * 3 + 2];\r\n\r\n    tempV1.fromBufferAttribute(positions, a);\r\n    tempV2.fromBufferAttribute(positions, b);\r\n    tempV3.fromBufferAttribute(positions, c);\r\n\r\n    // find the associated material index\r\n    let materialIndex = 0;\r\n    const groups = geometry.groups;\r\n    const firstVertexIndex = triangleIndex * 3;\r\n    for (let i = 0, l = groups.length; i < l; i++) {\r\n\r\n        const group = groups[i];\r\n        const { start, count } = group;\r\n        if (firstVertexIndex >= start && firstVertexIndex < start + count) {\r\n\r\n            materialIndex = group.materialIndex;\r\n            break;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    // extract uvs\r\n    let uv = null;\r\n    if (uvs) {\r\n\r\n        tempUV1.fromBufferAttribute(uvs, a);\r\n        tempUV2.fromBufferAttribute(uvs, b);\r\n        tempUV3.fromBufferAttribute(uvs, c);\r\n\r\n        if (target && target.uv) uv = target.uv;\r\n        else uv = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2();\r\n\r\n        https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Triangle.getUV(point, tempV1, tempV2, tempV3, tempUV1, tempUV2, tempUV3, uv);\r\n\r\n    }\r\n\r\n    // adjust the provided target or create a new one\r\n    if (target) {\r\n\r\n        if (!target.face) target.face = {};\r\n        target.face.a = a;\r\n        target.face.b = b;\r\n        target.face.c = c;\r\n        target.face.materialIndex = materialIndex;\r\n        if (!target.face.normal) target.face.normal = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n        https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Triangle.getNormal(tempV1, tempV2, tempV3, target.face.normal);\r\n\r\n        if (!target.uv) target.uv = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector2();\r\n        target.uv.copy(uv);\r\n\r\n        return target;\r\n\r\n    } else {\r\n\r\n        return {\r\n            face: {\r\n                a: a,\r\n                b: b,\r\n                c: c,\r\n                materialIndex: materialIndex,\r\n                normal: https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Triangle.getNormal(tempV1, tempV2, tempV3, new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3())\r\n            },\r\n            uv: uv\r\n        };\r\n\r\n    }\r\n\r\n}\r\n\r\nclass PrimitivePool {\r\n\r\n    constructor(getNewPrimitive) {\r\n\r\n        this._getNewPrimitive = getNewPrimitive;\r\n        this._primitives = [];\r\n\r\n    }\r\n\r\n    getPrimitive() {\r\n\r\n        const primitives = this._primitives;\r\n        if (primitives.length === 0) {\r\n\r\n            return this._getNewPrimitive();\r\n\r\n        } else {\r\n\r\n            return primitives.pop();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    releasePrimitive(primitive) {\r\n\r\n        this._primitives.push(primitive);\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction IS_LEAF(n16, uint16Array) {\r\n\r\n    return uint16Array[n16 + 15] === 0xFFFF;\r\n\r\n}\r\n\r\nfunction OFFSET(n32, uint32Array) {\r\n\r\n    return uint32Array[n32 + 6];\r\n\r\n}\r\n\r\nfunction COUNT(n16, uint16Array) {\r\n\r\n    return uint16Array[n16 + 14];\r\n\r\n}\r\n\r\nfunction LEFT_NODE(n32) {\r\n\r\n    return n32 + 8;\r\n\r\n}\r\n\r\nfunction RIGHT_NODE(n32, uint32Array) {\r\n\r\n    return uint32Array[n32 + 6];\r\n\r\n}\r\n\r\nfunction SPLIT_AXIS(n32, uint32Array) {\r\n\r\n    return uint32Array[n32 + 7];\r\n\r\n}\r\n\r\nfunction BOUNDING_DATA_INDEX(n32) {\r\n\r\n    return n32;\r\n\r\n}\r\n\r\nconst boundingBox$1 = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3();\r\nconst boxIntersection = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst xyzFields = ['x', 'y', 'z'];\r\n\r\nfunction raycast(nodeIndex32, geometry, side, ray, intersects) {\r\n\r\n    let nodeIndex16 = nodeIndex32 * 2,\r\n        float32Array = _float32Array,\r\n        uint16Array = _uint16Array,\r\n        uint32Array = _uint32Array;\r\n\r\n    const isLeaf = IS_LEAF(nodeIndex16, uint16Array);\r\n    if (isLeaf) {\r\n\r\n        const offset = OFFSET(nodeIndex32, uint32Array);\r\n        const count = COUNT(nodeIndex16, uint16Array);\r\n\r\n        intersectTris(geometry, side, ray, offset, count, intersects);\r\n\r\n    } else {\r\n\r\n        const leftIndex = LEFT_NODE(nodeIndex32);\r\n        if (intersectRay(leftIndex, float32Array, ray, boxIntersection)) {\r\n\r\n            raycast(leftIndex, geometry, side, ray, intersects);\r\n\r\n        }\r\n\r\n        const rightIndex = RIGHT_NODE(nodeIndex32, uint32Array);\r\n        if (intersectRay(rightIndex, float32Array, ray, boxIntersection)) {\r\n\r\n            raycast(rightIndex, geometry, side, ray, intersects);\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction raycastFirst(nodeIndex32, geometry, side, ray) {\r\n\r\n    let nodeIndex16 = nodeIndex32 * 2,\r\n        float32Array = _float32Array,\r\n        uint16Array = _uint16Array,\r\n        uint32Array = _uint32Array;\r\n\r\n    const isLeaf = IS_LEAF(nodeIndex16, uint16Array);\r\n    if (isLeaf) {\r\n\r\n        const offset = OFFSET(nodeIndex32, uint32Array);\r\n        const count = COUNT(nodeIndex16, uint16Array);\r\n        return intersectClosestTri(geometry, side, ray, offset, count);\r\n\r\n    } else {\r\n\r\n        // consider the position of the split plane with respect to the oncoming ray; whichever direction\r\n        // the ray is coming from, look for an intersection among that side of the tree first\r\n        const splitAxis = SPLIT_AXIS(nodeIndex32, uint32Array);\r\n        const xyzAxis = xyzFields[splitAxis];\r\n        const rayDir = ray.direction[xyzAxis];\r\n        const leftToRight = rayDir >= 0;\r\n\r\n        // c1 is the child to check first\r\n        let c1, c2;\r\n        if (leftToRight) {\r\n\r\n            c1 = LEFT_NODE(nodeIndex32);\r\n            c2 = RIGHT_NODE(nodeIndex32, uint32Array);\r\n\r\n        } else {\r\n\r\n            c1 = RIGHT_NODE(nodeIndex32, uint32Array);\r\n            c2 = LEFT_NODE(nodeIndex32);\r\n\r\n        }\r\n\r\n        const c1Intersection = intersectRay(c1, float32Array, ray, boxIntersection);\r\n        const c1Result = c1Intersection ? raycastFirst(c1, geometry, side, ray) : null;\r\n\r\n        // if we got an intersection in the first node and it's closer than the second node's bounding\r\n        // box, we don't need to consider the second node because it couldn't possibly be a better result\r\n        if (c1Result) {\r\n\r\n            // check if the point is within the second bounds\r\n            // \"point\" is in the local frame of the bvh\r\n            const point = c1Result.point[xyzAxis];\r\n            const isOutside = leftToRight ?\r\n                point <= float32Array[c2 + splitAxis] : // min bounding data\r\n                point >= float32Array[c2 + splitAxis + 3]; // max bounding data\r\n\r\n            if (isOutside) {\r\n\r\n                return c1Result;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // either there was no intersection in the first node, or there could still be a closer\r\n        // intersection in the second, so check the second node and then take the better of the two\r\n        const c2Intersection = intersectRay(c2, float32Array, ray, boxIntersection);\r\n        const c2Result = c2Intersection ? raycastFirst(c2, geometry, side, ray) : null;\r\n\r\n        if (c1Result && c2Result) {\r\n\r\n            return c1Result.distance <= c2Result.distance ? c1Result : c2Result;\r\n\r\n        } else {\r\n\r\n            return c1Result || c2Result || null;\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nconst shapecast = (function() {\r\n\r\n    let _box1, _box2;\r\n    const boxStack = [];\r\n    const boxPool = new PrimitivePool(() => new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3());\r\n\r\n    return function shapecast(...args) {\r\n\r\n        _box1 = boxPool.getPrimitive();\r\n        _box2 = boxPool.getPrimitive();\r\n        boxStack.push(_box1, _box2);\r\n\r\n        const result = shapecastTraverse(...args);\r\n\r\n        boxPool.releasePrimitive(_box1);\r\n        boxPool.releasePrimitive(_box2);\r\n        boxStack.pop();\r\n        boxStack.pop();\r\n\r\n        const length = boxStack.length;\r\n        if (length > 0) {\r\n\r\n            _box2 = boxStack[length - 1];\r\n            _box1 = boxStack[length - 2];\r\n\r\n        }\r\n\r\n        return result;\r\n\r\n    };\r\n\r\n    function shapecastTraverse(\r\n        nodeIndex32,\r\n        geometry,\r\n        intersectsBoundsFunc,\r\n        intersectsRangeFunc,\r\n        nodeScoreFunc = null,\r\n        nodeIndexByteOffset = 0, // offset for unique node identifier\r\n        depth = 0\r\n    ) {\r\n\r\n        // Define these inside the function so it has access to the local variables needed\r\n        // when converting to the buffer equivalents\r\n        function getLeftOffset(nodeIndex32) {\r\n\r\n            let nodeIndex16 = nodeIndex32 * 2,\r\n                uint16Array = _uint16Array,\r\n                uint32Array = _uint32Array;\r\n\r\n            // traverse until we find a leaf\r\n            while (!IS_LEAF(nodeIndex16, uint16Array)) {\r\n\r\n                nodeIndex32 = LEFT_NODE(nodeIndex32);\r\n                nodeIndex16 = nodeIndex32 * 2;\r\n\r\n            }\r\n\r\n            return OFFSET(nodeIndex32, uint32Array);\r\n\r\n        }\r\n\r\n        function getRightEndOffset(nodeIndex32) {\r\n\r\n            let nodeIndex16 = nodeIndex32 * 2,\r\n                uint16Array = _uint16Array,\r\n                uint32Array = _uint32Array;\r\n\r\n            // traverse until we find a leaf\r\n            while (!IS_LEAF(nodeIndex16, uint16Array)) {\r\n\r\n                // adjust offset to point to the right node\r\n                nodeIndex32 = RIGHT_NODE(nodeIndex32, uint32Array);\r\n                nodeIndex16 = nodeIndex32 * 2;\r\n\r\n            }\r\n\r\n            // return the end offset of the triangle range\r\n            return OFFSET(nodeIndex32, uint32Array) + COUNT(nodeIndex16, uint16Array);\r\n\r\n        }\r\n\r\n        let nodeIndex16 = nodeIndex32 * 2,\r\n            float32Array = _float32Array,\r\n            uint16Array = _uint16Array,\r\n            uint32Array = _uint32Array;\r\n\r\n        const isLeaf = IS_LEAF(nodeIndex16, uint16Array);\r\n        if (isLeaf) {\r\n\r\n            const offset = OFFSET(nodeIndex32, uint32Array);\r\n            const count = COUNT(nodeIndex16, uint16Array);\r\n            arrayToBox(BOUNDING_DATA_INDEX(nodeIndex32), float32Array, _box1);\r\n            return intersectsRangeFunc(offset, count, false, depth, nodeIndexByteOffset + nodeIndex32, _box1);\r\n\r\n        } else {\r\n\r\n            const left = LEFT_NODE(nodeIndex32);\r\n            const right = RIGHT_NODE(nodeIndex32, uint32Array);\r\n            let c1 = left;\r\n            let c2 = right;\r\n\r\n            let score1, score2;\r\n            let box1, box2;\r\n            if (nodeScoreFunc) {\r\n\r\n                box1 = _box1;\r\n                box2 = _box2;\r\n\r\n                // bounding data is not offset\r\n                arrayToBox(BOUNDING_DATA_INDEX(c1), float32Array, box1);\r\n                arrayToBox(BOUNDING_DATA_INDEX(c2), float32Array, box2);\r\n\r\n                score1 = nodeScoreFunc(box1);\r\n                score2 = nodeScoreFunc(box2);\r\n\r\n                if (score2 < score1) {\r\n\r\n                    c1 = right;\r\n                    c2 = left;\r\n\r\n                    const temp = score1;\r\n                    score1 = score2;\r\n                    score2 = temp;\r\n\r\n                    box1 = box2;\r\n                    // box2 is always set before use below\r\n\r\n                }\r\n\r\n            }\r\n\r\n            // Check box 1 intersection\r\n            if (!box1) {\r\n\r\n                box1 = _box1;\r\n                arrayToBox(BOUNDING_DATA_INDEX(c1), float32Array, box1);\r\n\r\n            }\r\n\r\n            const isC1Leaf = IS_LEAF(c1 * 2, uint16Array);\r\n            const c1Intersection = intersectsBoundsFunc(box1, isC1Leaf, score1, depth + 1, nodeIndexByteOffset + c1);\r\n\r\n            let c1StopTraversal;\r\n            if (c1Intersection === CONTAINED) {\r\n\r\n                const offset = getLeftOffset(c1);\r\n                const end = getRightEndOffset(c1);\r\n                const count = end - offset;\r\n\r\n                c1StopTraversal = intersectsRangeFunc(offset, count, true, depth + 1, nodeIndexByteOffset + c1, box1);\r\n\r\n            } else {\r\n\r\n                c1StopTraversal =\r\n                    c1Intersection &&\r\n                    shapecastTraverse(\r\n                        c1,\r\n                        geometry,\r\n                        intersectsBoundsFunc,\r\n                        intersectsRangeFunc,\r\n                        nodeScoreFunc,\r\n                        nodeIndexByteOffset,\r\n                        depth + 1\r\n                    );\r\n\r\n            }\r\n\r\n            if (c1StopTraversal) return true;\r\n\r\n            // Check box 2 intersection\r\n            // cached box2 will have been overwritten by previous traversal\r\n            box2 = _box2;\r\n            arrayToBox(BOUNDING_DATA_INDEX(c2), float32Array, box2);\r\n\r\n            const isC2Leaf = IS_LEAF(c2 * 2, uint16Array);\r\n            const c2Intersection = intersectsBoundsFunc(box2, isC2Leaf, score2, depth + 1, nodeIndexByteOffset + c2);\r\n\r\n            let c2StopTraversal;\r\n            if (c2Intersection === CONTAINED) {\r\n\r\n                const offset = getLeftOffset(c2);\r\n                const end = getRightEndOffset(c2);\r\n                const count = end - offset;\r\n\r\n                c2StopTraversal = intersectsRangeFunc(offset, count, true, depth + 1, nodeIndexByteOffset + c2, box2);\r\n\r\n            } else {\r\n\r\n                c2StopTraversal =\r\n                    c2Intersection &&\r\n                    shapecastTraverse(\r\n                        c2,\r\n                        geometry,\r\n                        intersectsBoundsFunc,\r\n                        intersectsRangeFunc,\r\n                        nodeScoreFunc,\r\n                        nodeIndexByteOffset,\r\n                        depth + 1\r\n                    );\r\n\r\n            }\r\n\r\n            if (c2StopTraversal) return true;\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n    }\r\n\r\n})();\r\n\r\nconst intersectsGeometry = (function() {\r\n\r\n    const triangle = new SeparatingAxisTriangle();\r\n    const triangle2 = new SeparatingAxisTriangle();\r\n    const invertedMat = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4();\r\n\r\n    const obb = new OrientedBox();\r\n    const obb2 = new OrientedBox();\r\n\r\n    return function intersectsGeometry(nodeIndex32, geometry, otherGeometry, geometryToBvh, cachedObb = null) {\r\n\r\n        let nodeIndex16 = nodeIndex32 * 2,\r\n            float32Array = _float32Array,\r\n            uint16Array = _uint16Array,\r\n            uint32Array = _uint32Array;\r\n\r\n        if (cachedObb === null) {\r\n\r\n            if (!otherGeometry.boundingBox) {\r\n\r\n                otherGeometry.computeBoundingBox();\r\n\r\n            }\r\n\r\n            obb.set(otherGeometry.boundingBox.min, otherGeometry.boundingBox.max, geometryToBvh);\r\n            cachedObb = obb;\r\n\r\n        }\r\n\r\n        const isLeaf = IS_LEAF(nodeIndex16, uint16Array);\r\n        if (isLeaf) {\r\n\r\n            const thisGeometry = geometry;\r\n            const thisIndex = thisGeometry.index;\r\n            const thisPos = thisGeometry.attributes.position;\r\n\r\n            const index = otherGeometry.index;\r\n            const pos = otherGeometry.attributes.position;\r\n\r\n            const offset = OFFSET(nodeIndex32, uint32Array);\r\n            const count = COUNT(nodeIndex16, uint16Array);\r\n\r\n            // get the inverse of the geometry matrix so we can transform our triangles into the\r\n            // geometry space we're trying to test. We assume there are fewer triangles being checked\r\n            // here.\r\n            invertedMat.copy(geometryToBvh).invert();\r\n\r\n            if (otherGeometry.boundsTree) {\r\n\r\n                arrayToBox(BOUNDING_DATA_INDEX(nodeIndex32), float32Array, obb2);\r\n                obb2.matrix.copy(invertedMat);\r\n                obb2.needsUpdate = true;\r\n\r\n                const res = otherGeometry.boundsTree.shapecast({\r\n\r\n                    intersectsBounds: box => obb2.intersectsBox(box),\r\n\r\n                    intersectsTriangle: tri => {\r\n\r\n                        tri.a.applyMatrix4(geometryToBvh);\r\n                        tri.b.applyMatrix4(geometryToBvh);\r\n                        tri.c.applyMatrix4(geometryToBvh);\r\n                        tri.needsUpdate = true;\r\n\r\n                        for (let i = offset * 3, l = (count + offset) * 3; i < l; i += 3) {\r\n\r\n                            // this triangle needs to be transformed into the current BVH coordinate frame\r\n                            setTriangle(triangle2, i, thisIndex, thisPos);\r\n                            triangle2.needsUpdate = true;\r\n                            if (tri.intersectsTriangle(triangle2)) {\r\n\r\n                                return true;\r\n\r\n                            }\r\n\r\n                        }\r\n\r\n                        return false;\r\n\r\n                    }\r\n\r\n                });\r\n\r\n                return res;\r\n\r\n            } else {\r\n\r\n                for (let i = offset * 3, l = (count + offset * 3); i < l; i += 3) {\r\n\r\n                    // this triangle needs to be transformed into the current BVH coordinate frame\r\n                    setTriangle(triangle, i, thisIndex, thisPos);\r\n                    triangle.a.applyMatrix4(invertedMat);\r\n                    triangle.b.applyMatrix4(invertedMat);\r\n                    triangle.c.applyMatrix4(invertedMat);\r\n                    triangle.needsUpdate = true;\r\n\r\n                    for (let i2 = 0, l2 = index.count; i2 < l2; i2 += 3) {\r\n\r\n                        setTriangle(triangle2, i2, index, pos);\r\n                        triangle2.needsUpdate = true;\r\n\r\n                        if (triangle.intersectsTriangle(triangle2)) {\r\n\r\n                            return true;\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            const left = nodeIndex32 + 8;\r\n            const right = uint32Array[nodeIndex32 + 6];\r\n\r\n            arrayToBox(BOUNDING_DATA_INDEX(left), float32Array, boundingBox$1);\r\n            const leftIntersection =\r\n                cachedObb.intersectsBox(boundingBox$1) &&\r\n                intersectsGeometry(left, geometry, otherGeometry, geometryToBvh, cachedObb);\r\n\r\n            if (leftIntersection) return true;\r\n\r\n            arrayToBox(BOUNDING_DATA_INDEX(right), float32Array, boundingBox$1);\r\n            const rightIntersection =\r\n                cachedObb.intersectsBox(boundingBox$1) &&\r\n                intersectsGeometry(right, geometry, otherGeometry, geometryToBvh, cachedObb);\r\n\r\n            if (rightIntersection) return true;\r\n\r\n            return false;\r\n\r\n        }\r\n\r\n    };\r\n\r\n})();\r\n\r\nfunction intersectRay(nodeIndex32, array, ray, target) {\r\n\r\n    arrayToBox(nodeIndex32, array, boundingBox$1);\r\n    return ray.intersectBox(boundingBox$1, target);\r\n\r\n}\r\n\r\nconst bufferStack = [];\r\nlet _prevBuffer;\r\nlet _float32Array;\r\nlet _uint16Array;\r\nlet _uint32Array;\r\n\r\nfunction setBuffer(buffer) {\r\n\r\n    if (_prevBuffer) {\r\n\r\n        bufferStack.push(_prevBuffer);\r\n\r\n    }\r\n\r\n    _prevBuffer = buffer;\r\n    _float32Array = new Float32Array(buffer);\r\n    _uint16Array = new Uint16Array(buffer);\r\n    _uint32Array = new Uint32Array(buffer);\r\n\r\n}\r\n\r\nfunction clearBuffer() {\r\n\r\n    _prevBuffer = null;\r\n    _float32Array = null;\r\n    _uint16Array = null;\r\n    _uint32Array = null;\r\n\r\n    if (bufferStack.length) {\r\n\r\n        setBuffer(bufferStack.pop());\r\n\r\n    }\r\n\r\n}\r\n\r\nconst SKIP_GENERATION = Symbol('skip tree generation');\r\n\r\nconst aabb = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3();\r\nconst aabb2 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3();\r\nconst tempMatrix = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4();\r\nconst obb = /* @__PURE__ */ new OrientedBox();\r\nconst obb2 = /* @__PURE__ */ new OrientedBox();\r\nconst temp = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst temp1 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst temp2 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst temp3 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst temp4 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\nconst tempBox = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3();\r\nconst trianglePool = /* @__PURE__ */ new PrimitivePool(() => new SeparatingAxisTriangle());\r\n\r\nclass MeshBVH {\r\n\r\n    static serialize(bvh, options = {}) {\r\n\r\n        if (options.isBufferGeometry) {\r\n\r\n            console.warn('MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature.');\r\n\r\n            return MeshBVH.serialize(\r\n                arguments[0], {\r\n                    cloneBuffers: arguments[2] === undefined ? true : arguments[2],\r\n                }\r\n            );\r\n\r\n        }\r\n\r\n        options = {\r\n            cloneBuffers: true,\r\n            ...options,\r\n        };\r\n\r\n        const geometry = bvh.geometry;\r\n        const rootData = bvh._roots;\r\n        const indexAttribute = geometry.getIndex();\r\n        let result;\r\n        if (options.cloneBuffers) {\r\n\r\n            result = {\r\n                roots: rootData.map(root => root.slice()),\r\n                index: indexAttribute.array.slice(),\r\n            };\r\n\r\n        } else {\r\n\r\n            result = {\r\n                roots: rootData,\r\n                index: indexAttribute.array,\r\n            };\r\n\r\n        }\r\n\r\n        return result;\r\n\r\n    }\r\n\r\n    static deserialize(data, geometry, options = {}) {\r\n\r\n        if (typeof options === 'boolean') {\r\n\r\n            console.warn('MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature.');\r\n\r\n            return MeshBVH.deserialize(\r\n                arguments[0],\r\n                arguments[1], {\r\n                    setIndex: arguments[2] === undefined ? true : arguments[2],\r\n                }\r\n            );\r\n\r\n        }\r\n\r\n        options = {\r\n            setIndex: true,\r\n            ...options,\r\n        };\r\n\r\n        const { index, roots } = data;\r\n        const bvh = new MeshBVH(geometry, {...options, [SKIP_GENERATION]: true });\r\n        bvh._roots = roots;\r\n\r\n        if (options.setIndex) {\r\n\r\n            const indexAttribute = geometry.getIndex();\r\n            if (indexAttribute === null) {\r\n\r\n                const newIndex = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.BufferAttribute(data.index, 1, false);\r\n                geometry.setIndex(newIndex);\r\n\r\n            } else if (indexAttribute.array !== index) {\r\n\r\n                indexAttribute.array.set(index);\r\n                indexAttribute.needsUpdate = true;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return bvh;\r\n\r\n    }\r\n\r\n    constructor(geometry, options = {}) {\r\n\r\n        if (!geometry.isBufferGeometry) {\r\n\r\n            throw new Error('MeshBVH: Only BufferGeometries are supported.');\r\n\r\n        } else if (geometry.index && geometry.index.isInterleavedBufferAttribute) {\r\n\r\n            throw new Error('MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.');\r\n\r\n        }\r\n\r\n        // default options\r\n        options = Object.assign({\r\n\r\n            strategy: CENTER,\r\n            maxDepth: 40,\r\n            maxLeafTris: 10,\r\n            verbose: true,\r\n            useSharedArrayBuffer: false,\r\n            setBoundingBox: true,\r\n            onProgress: null,\r\n\r\n            // undocumented options\r\n\r\n            // Whether to skip generating the tree. Used for deserialization.\r\n            [SKIP_GENERATION]: false,\r\n\r\n        }, options);\r\n\r\n        if (options.useSharedArrayBuffer && typeof SharedArrayBuffer === 'undefined') {\r\n\r\n            throw new Error('MeshBVH: SharedArrayBuffer is not available.');\r\n\r\n        }\r\n\r\n        this._roots = null;\r\n        if (!options[SKIP_GENERATION]) {\r\n\r\n            this._roots = buildPackedTree(geometry, options);\r\n\r\n            if (!geometry.boundingBox && options.setBoundingBox) {\r\n\r\n                geometry.boundingBox = this.getBoundingBox(new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3());\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // retain references to the geometry so we can use them it without having to\r\n        // take a geometry reference in every function.\r\n        this.geometry = geometry;\r\n\r\n    }\r\n\r\n    refit(nodeIndices = null) {\r\n\r\n        if (nodeIndices && Array.isArray(nodeIndices)) {\r\n\r\n            nodeIndices = new Set(nodeIndices);\r\n\r\n        }\r\n\r\n        const geometry = this.geometry;\r\n        const indexArr = geometry.index.array;\r\n        const posAttr = geometry.attributes.position;\r\n        const posArr = posAttr.array;\r\n\r\n        // support for an interleaved position buffer\r\n        const bufferOffset = posAttr.offset || 0;\r\n        let stride = 3;\r\n        if (posAttr.isInterleavedBufferAttribute) {\r\n\r\n            stride = posAttr.data.stride;\r\n\r\n        }\r\n\r\n        let buffer, uint32Array, uint16Array, float32Array;\r\n        let byteOffset = 0;\r\n        const roots = this._roots;\r\n        for (let i = 0, l = roots.length; i < l; i++) {\r\n\r\n            buffer = roots[i];\r\n            uint32Array = new Uint32Array(buffer);\r\n            uint16Array = new Uint16Array(buffer);\r\n            float32Array = new Float32Array(buffer);\r\n\r\n            _traverse(0, byteOffset);\r\n            byteOffset += buffer.byteLength;\r\n\r\n        }\r\n\r\n        function _traverse(node32Index, byteOffset, force = false) {\r\n\r\n            const node16Index = node32Index * 2;\r\n            const isLeaf = uint16Array[node16Index + 15] === IS_LEAFNODE_FLAG;\r\n            if (isLeaf) {\r\n\r\n                const offset = uint32Array[node32Index + 6];\r\n                const count = uint16Array[node16Index + 14];\r\n\r\n                let minx = Infinity;\r\n                let miny = Infinity;\r\n                let minz = Infinity;\r\n                let maxx = -Infinity;\r\n                let maxy = -Infinity;\r\n                let maxz = -Infinity;\r\n                for (let i = 3 * offset, l = 3 * (offset + count); i < l; i++) {\r\n\r\n                    const index = indexArr[i] * stride + bufferOffset;\r\n                    const x = posArr[index + 0];\r\n                    const y = posArr[index + 1];\r\n                    const z = posArr[index + 2];\r\n\r\n                    if (x < minx) minx = x;\r\n                    if (x > maxx) maxx = x;\r\n\r\n                    if (y < miny) miny = y;\r\n                    if (y > maxy) maxy = y;\r\n\r\n                    if (z < minz) minz = z;\r\n                    if (z > maxz) maxz = z;\r\n\r\n                }\r\n\r\n                if (\r\n                    float32Array[node32Index + 0] !== minx ||\r\n                    float32Array[node32Index + 1] !== miny ||\r\n                    float32Array[node32Index + 2] !== minz ||\r\n\r\n                    float32Array[node32Index + 3] !== maxx ||\r\n                    float32Array[node32Index + 4] !== maxy ||\r\n                    float32Array[node32Index + 5] !== maxz\r\n                ) {\r\n\r\n                    float32Array[node32Index + 0] = minx;\r\n                    float32Array[node32Index + 1] = miny;\r\n                    float32Array[node32Index + 2] = minz;\r\n\r\n                    float32Array[node32Index + 3] = maxx;\r\n                    float32Array[node32Index + 4] = maxy;\r\n                    float32Array[node32Index + 5] = maxz;\r\n\r\n                    return true;\r\n\r\n                } else {\r\n\r\n                    return false;\r\n\r\n                }\r\n\r\n            } else {\r\n\r\n                const left = node32Index + 8;\r\n                const right = uint32Array[node32Index + 6];\r\n\r\n                // the identifying node indices provided by the shapecast function include offsets of all\r\n                // root buffers to guarantee they're unique between roots so offset left and right indices here.\r\n                const offsetLeft = left + byteOffset;\r\n                const offsetRight = right + byteOffset;\r\n                let forceChildren = force;\r\n                let includesLeft = false;\r\n                let includesRight = false;\r\n\r\n                if (nodeIndices) {\r\n\r\n                    // if we see that neither the left or right child are included in the set that need to be updated\r\n                    // then we assume that all children need to be updated.\r\n                    if (!forceChildren) {\r\n\r\n                        includesLeft = nodeIndices.has(offsetLeft);\r\n                        includesRight = nodeIndices.has(offsetRight);\r\n                        forceChildren = !includesLeft && !includesRight;\r\n\r\n                    }\r\n\r\n                } else {\r\n\r\n                    includesLeft = true;\r\n                    includesRight = true;\r\n\r\n                }\r\n\r\n                const traverseLeft = forceChildren || includesLeft;\r\n                const traverseRight = forceChildren || includesRight;\r\n\r\n                let leftChange = false;\r\n                if (traverseLeft) {\r\n\r\n                    leftChange = _traverse(left, byteOffset, forceChildren);\r\n\r\n                }\r\n\r\n                let rightChange = false;\r\n                if (traverseRight) {\r\n\r\n                    rightChange = _traverse(right, byteOffset, forceChildren);\r\n\r\n                }\r\n\r\n                const didChange = leftChange || rightChange;\r\n                if (didChange) {\r\n\r\n                    for (let i = 0; i < 3; i++) {\r\n\r\n                        const lefti = left + i;\r\n                        const righti = right + i;\r\n                        const minLeftValue = float32Array[lefti];\r\n                        const maxLeftValue = float32Array[lefti + 3];\r\n                        const minRightValue = float32Array[righti];\r\n                        const maxRightValue = float32Array[righti + 3];\r\n\r\n                        float32Array[node32Index + i] = minLeftValue < minRightValue ? minLeftValue : minRightValue;\r\n                        float32Array[node32Index + i + 3] = maxLeftValue > maxRightValue ? maxLeftValue : maxRightValue;\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                return didChange;\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    traverse(callback, rootIndex = 0) {\r\n\r\n        const buffer = this._roots[rootIndex];\r\n        const uint32Array = new Uint32Array(buffer);\r\n        const uint16Array = new Uint16Array(buffer);\r\n        _traverse(0);\r\n\r\n        function _traverse(node32Index, depth = 0) {\r\n\r\n            const node16Index = node32Index * 2;\r\n            const isLeaf = uint16Array[node16Index + 15] === IS_LEAFNODE_FLAG;\r\n            if (isLeaf) {\r\n\r\n                const offset = uint32Array[node32Index + 6];\r\n                const count = uint16Array[node16Index + 14];\r\n                callback(depth, isLeaf, new Float32Array(buffer, node32Index * 4, 6), offset, count);\r\n\r\n            } else {\r\n\r\n                // TODO: use node functions here\r\n                const left = node32Index + BYTES_PER_NODE / 4;\r\n                const right = uint32Array[node32Index + 6];\r\n                const splitAxis = uint32Array[node32Index + 7];\r\n                const stopTraversal = callback(depth, isLeaf, new Float32Array(buffer, node32Index * 4, 6), splitAxis);\r\n\r\n                if (!stopTraversal) {\r\n\r\n                    _traverse(left, depth + 1);\r\n                    _traverse(right, depth + 1);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    /* Core Cast Functions */\r\n    raycast(ray, materialOrSide = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.FrontSide) {\r\n\r\n        const roots = this._roots;\r\n        const geometry = this.geometry;\r\n        const intersects = [];\r\n        const isMaterial = materialOrSide.isMaterial;\r\n        const isArrayMaterial = Array.isArray(materialOrSide);\r\n\r\n        const groups = geometry.groups;\r\n        const side = isMaterial ? materialOrSide.side : materialOrSide;\r\n        for (let i = 0, l = roots.length; i < l; i++) {\r\n\r\n            const materialSide = isArrayMaterial ? materialOrSide[groups[i].materialIndex].side : side;\r\n            const startCount = intersects.length;\r\n\r\n            setBuffer(roots[i]);\r\n            raycast(0, geometry, materialSide, ray, intersects);\r\n            clearBuffer();\r\n\r\n            if (isArrayMaterial) {\r\n\r\n                const materialIndex = groups[i].materialIndex;\r\n                for (let j = startCount, jl = intersects.length; j < jl; j++) {\r\n\r\n                    intersects[j].face.materialIndex = materialIndex;\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return intersects;\r\n\r\n    }\r\n\r\n    raycastFirst(ray, materialOrSide = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.FrontSide) {\r\n\r\n        const roots = this._roots;\r\n        const geometry = this.geometry;\r\n        const isMaterial = materialOrSide.isMaterial;\r\n        const isArrayMaterial = Array.isArray(materialOrSide);\r\n\r\n        let closestResult = null;\r\n\r\n        const groups = geometry.groups;\r\n        const side = isMaterial ? materialOrSide.side : materialOrSide;\r\n        for (let i = 0, l = roots.length; i < l; i++) {\r\n\r\n            const materialSide = isArrayMaterial ? materialOrSide[groups[i].materialIndex].side : side;\r\n\r\n            setBuffer(roots[i]);\r\n            const result = raycastFirst(0, geometry, materialSide, ray);\r\n            clearBuffer();\r\n\r\n            if (result != null && (closestResult == null || result.distance < closestResult.distance)) {\r\n\r\n                closestResult = result;\r\n                if (isArrayMaterial) {\r\n\r\n                    result.face.materialIndex = groups[i].materialIndex;\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return closestResult;\r\n\r\n    }\r\n\r\n    intersectsGeometry(otherGeometry, geomToMesh) {\r\n\r\n        const geometry = this.geometry;\r\n        let result = false;\r\n        for (const root of this._roots) {\r\n\r\n            setBuffer(root);\r\n            result = intersectsGeometry(0, geometry, otherGeometry, geomToMesh);\r\n            clearBuffer();\r\n\r\n            if (result) {\r\n\r\n                break;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return result;\r\n\r\n    }\r\n\r\n    shapecast(callbacks, _intersectsTriangleFunc, _orderNodesFunc) {\r\n\r\n        const geometry = this.geometry;\r\n        if (callbacks instanceof Function) {\r\n\r\n            if (_intersectsTriangleFunc) {\r\n\r\n                // Support the previous function signature that provided three sequential index buffer\r\n                // indices here.\r\n                const originalTriangleFunc = _intersectsTriangleFunc;\r\n                _intersectsTriangleFunc = (tri, index, contained, depth) => {\r\n\r\n                    const i3 = index * 3;\r\n                    return originalTriangleFunc(tri, i3, i3 + 1, i3 + 2, contained, depth);\r\n\r\n                };\r\n\r\n\r\n            }\r\n\r\n            callbacks = {\r\n\r\n                boundsTraverseOrder: _orderNodesFunc,\r\n                intersectsBounds: callbacks,\r\n                intersectsTriangle: _intersectsTriangleFunc,\r\n                intersectsRange: null,\r\n\r\n            };\r\n\r\n            console.warn('MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.');\r\n\r\n        }\r\n\r\n        const triangle = trianglePool.getPrimitive();\r\n        let {\r\n            boundsTraverseOrder,\r\n            intersectsBounds,\r\n            intersectsRange,\r\n            intersectsTriangle,\r\n        } = callbacks;\r\n\r\n        if (intersectsRange && intersectsTriangle) {\r\n\r\n            const originalIntersectsRange = intersectsRange;\r\n            intersectsRange = (offset, count, contained, depth, nodeIndex) => {\r\n\r\n                if (!originalIntersectsRange(offset, count, contained, depth, nodeIndex)) {\r\n\r\n                    return iterateOverTriangles(offset, count, geometry, intersectsTriangle, contained, depth, triangle);\r\n\r\n                }\r\n\r\n                return true;\r\n\r\n            };\r\n\r\n        } else if (!intersectsRange) {\r\n\r\n            if (intersectsTriangle) {\r\n\r\n                intersectsRange = (offset, count, contained, depth) => {\r\n\r\n                    return iterateOverTriangles(offset, count, geometry, intersectsTriangle, contained, depth, triangle);\r\n\r\n                };\r\n\r\n            } else {\r\n\r\n                intersectsRange = (offset, count, contained) => {\r\n\r\n                    return contained;\r\n\r\n                };\r\n\r\n            }\r\n\r\n        }\r\n\r\n        let result = false;\r\n        let byteOffset = 0;\r\n        for (const root of this._roots) {\r\n\r\n            setBuffer(root);\r\n            result = shapecast(0, geometry, intersectsBounds, intersectsRange, boundsTraverseOrder, byteOffset);\r\n            clearBuffer();\r\n\r\n            if (result) {\r\n\r\n                break;\r\n\r\n            }\r\n\r\n            byteOffset += root.byteLength;\r\n\r\n        }\r\n\r\n        trianglePool.releasePrimitive(triangle);\r\n\r\n        return result;\r\n\r\n    }\r\n\r\n    bvhcast(otherBvh, matrixToLocal, callbacks) {\r\n\r\n        // BVHCast function for intersecting two BVHs against each other. Ultimately just uses two recursive shapecast calls rather\r\n        // than an approach that walks down the tree (see bvhcast.js file for more info).\r\n\r\n        let {\r\n            intersectsRanges,\r\n            intersectsTriangles,\r\n        } = callbacks;\r\n\r\n        const indexAttr = this.geometry.index;\r\n        const positionAttr = this.geometry.attributes.position;\r\n\r\n        const otherIndexAttr = otherBvh.geometry.index;\r\n        const otherPositionAttr = otherBvh.geometry.attributes.position;\r\n\r\n        tempMatrix.copy(matrixToLocal).invert();\r\n\r\n        const triangle = trianglePool.getPrimitive();\r\n        const triangle2 = trianglePool.getPrimitive();\r\n\r\n        if (intersectsTriangles) {\r\n\r\n            function iterateOverDoubleTriangles(offset1, count1, offset2, count2, depth1, index1, depth2, index2) {\r\n\r\n                for (let i2 = offset2, l2 = offset2 + count2; i2 < l2; i2++) {\r\n\r\n                    setTriangle(triangle2, i2 * 3, otherIndexAttr, otherPositionAttr);\r\n                    triangle2.a.applyMatrix4(matrixToLocal);\r\n                    triangle2.b.applyMatrix4(matrixToLocal);\r\n                    triangle2.c.applyMatrix4(matrixToLocal);\r\n                    triangle2.needsUpdate = true;\r\n\r\n                    for (let i1 = offset1, l1 = offset1 + count1; i1 < l1; i1++) {\r\n\r\n                        setTriangle(triangle, i1 * 3, indexAttr, positionAttr);\r\n                        triangle.needsUpdate = true;\r\n\r\n                        if (intersectsTriangles(triangle, triangle2, i1, i2, depth1, index1, depth2, index2)) {\r\n\r\n                            return true;\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n\r\n                return false;\r\n\r\n            }\r\n\r\n            if (intersectsRanges) {\r\n\r\n                const originalIntersectsRanges = intersectsRanges;\r\n                intersectsRanges = function(offset1, count1, offset2, count2, depth1, index1, depth2, index2) {\r\n\r\n                    if (!originalIntersectsRanges(offset1, count1, offset2, count2, depth1, index1, depth2, index2)) {\r\n\r\n                        return iterateOverDoubleTriangles(offset1, count1, offset2, count2, depth1, index1, depth2, index2);\r\n\r\n                    }\r\n\r\n                    return true;\r\n\r\n                };\r\n\r\n            } else {\r\n\r\n                intersectsRanges = iterateOverDoubleTriangles;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.getBoundingBox(aabb2);\r\n        aabb2.applyMatrix4(matrixToLocal);\r\n        const result = this.shapecast({\r\n\r\n            intersectsBounds: box => aabb2.intersectsBox(box),\r\n\r\n            intersectsRange: (offset1, count1, contained, depth1, nodeIndex1, box) => {\r\n\r\n                aabb.copy(box);\r\n                aabb.applyMatrix4(tempMatrix);\r\n                return otherBvh.shapecast({\r\n\r\n                    intersectsBounds: box => aabb.intersectsBox(box),\r\n\r\n                    intersectsRange: (offset2, count2, contained, depth2, nodeIndex2) => {\r\n\r\n                        return intersectsRanges(offset1, count1, offset2, count2, depth1, nodeIndex1, depth2, nodeIndex2);\r\n\r\n                    },\r\n\r\n                });\r\n\r\n            }\r\n\r\n        });\r\n\r\n        trianglePool.releasePrimitive(triangle);\r\n        trianglePool.releasePrimitive(triangle2);\r\n        return result;\r\n\r\n    }\r\n\r\n    /* Derived Cast Functions */\r\n    intersectsBox(box, boxToMesh) {\r\n\r\n        obb.set(box.min, box.max, boxToMesh);\r\n        obb.needsUpdate = true;\r\n\r\n        return this.shapecast({\r\n            intersectsBounds: box => obb.intersectsBox(box),\r\n            intersectsTriangle: tri => obb.intersectsTriangle(tri)\r\n        });\r\n\r\n    }\r\n\r\n    intersectsSphere(sphere) {\r\n\r\n        return this.shapecast({\r\n            intersectsBounds: box => sphere.intersectsBox(box),\r\n            intersectsTriangle: tri => tri.intersectsSphere(sphere)\r\n        });\r\n\r\n    }\r\n\r\n    closestPointToGeometry(otherGeometry, geometryToBvh, target1 = {}, target2 = {}, minThreshold = 0, maxThreshold = Infinity) {\r\n\r\n        if (!otherGeometry.boundingBox) {\r\n\r\n            otherGeometry.computeBoundingBox();\r\n\r\n        }\r\n\r\n        obb.set(otherGeometry.boundingBox.min, otherGeometry.boundingBox.max, geometryToBvh);\r\n        obb.needsUpdate = true;\r\n\r\n        const geometry = this.geometry;\r\n        const pos = geometry.attributes.position;\r\n        const index = geometry.index;\r\n        const otherPos = otherGeometry.attributes.position;\r\n        const otherIndex = otherGeometry.index;\r\n        const triangle = trianglePool.getPrimitive();\r\n        const triangle2 = trianglePool.getPrimitive();\r\n\r\n        let tempTarget1 = temp1;\r\n        let tempTargetDest1 = temp2;\r\n        let tempTarget2 = null;\r\n        let tempTargetDest2 = null;\r\n\r\n        if (target2) {\r\n\r\n            tempTarget2 = temp3;\r\n            tempTargetDest2 = temp4;\r\n\r\n        }\r\n\r\n        let closestDistance = Infinity;\r\n        let closestDistanceTriIndex = null;\r\n        let closestDistanceOtherTriIndex = null;\r\n        tempMatrix.copy(geometryToBvh).invert();\r\n        obb2.matrix.copy(tempMatrix);\r\n        this.shapecast({\r\n\r\n                boundsTraverseOrder: box => {\r\n\r\n                    return obb.distanceToBox(box, Math.min(closestDistance, maxThreshold));\r\n\r\n                },\r\n\r\n                intersectsBounds: (box, isLeaf, score) => {\r\n\r\n                    if (score < closestDistance && score < maxThreshold) {\r\n\r\n                        // if we know the triangles of this bounds will be intersected next then\r\n                        // save the bounds to use during triangle checks.\r\n                        if (isLeaf) {\r\n\r\n                            obb2.min.copy(box.min);\r\n                            obb2.max.copy(box.max);\r\n                            obb2.needsUpdate = true;\r\n\r\n                        }\r\n\r\n                        return true;\r\n\r\n                    }\r\n\r\n                    return false;\r\n\r\n                },\r\n\r\n                intersectsRange: (offset, count) => {\r\n\r\n                    if (otherGeometry.boundsTree) {\r\n\r\n                        // if the other geometry has a bvh then use the accelerated path where we use shapecast to find\r\n                        // the closest bounds in the other geometry to check.\r\n                        return otherGeometry.boundsTree.shapecast({\r\n                            boundsTraverseOrder: box => {\r\n\r\n                                return obb2.distanceToBox(box, Math.min(closestDistance, maxThreshold));\r\n\r\n                            },\r\n\r\n                            intersectsBounds: (box, isLeaf, score) => {\r\n\r\n                                return score < closestDistance && score < maxThreshold;\r\n\r\n                            },\r\n\r\n                            intersectsRange: (otherOffset, otherCount) => {\r\n\r\n                                for (let i2 = otherOffset * 3, l2 = (otherOffset + otherCount) * 3; i2 < l2; i2 += 3) {\r\n\r\n                                    setTriangle(triangle2, i2, otherIndex, otherPos);\r\n                                    triangle2.a.applyMatrix4(geometryToBvh);\r\n                                    triangle2.b.applyMatrix4(geometryToBvh);\r\n                                    triangle2.c.applyMatrix4(geometryToBvh);\r\n                                    triangle2.needsUpdate = true;\r\n\r\n                                    for (let i = offset * 3, l = (offset + count) * 3; i < l; i += 3) {\r\n\r\n                                        setTriangle(triangle, i, index, pos);\r\n                                        triangle.needsUpdate = true;\r\n\r\n                                        const dist = triangle.distanceToTriangle(triangle2, tempTarget1, tempTarget2);\r\n                                        if (dist < closestDistance) {\r\n\r\n                                            tempTargetDest1.copy(tempTarget1);\r\n\r\n                                            if (tempTargetDest2) {\r\n\r\n                                                tempTargetDest2.copy(tempTarget2);\r\n\r\n                                            }\r\n\r\n                                            closestDistance = dist;\r\n                                            closestDistanceTriIndex = i / 3;\r\n                                            closestDistanceOtherTriIndex = i2 / 3;\r\n\r\n                                        }\r\n\r\n                                        // stop traversal if we find a point that's under the given threshold\r\n                                        if (dist < minThreshold) {\r\n\r\n                                            return true;\r\n\r\n                                        }\r\n\r\n                                    }\r\n\r\n                                }\r\n\r\n                            },\r\n                        });\r\n\r\n                    } else {\r\n\r\n                        // If no bounds tree then we'll just check every triangle.\r\n                        const triCount = otherIndex ? otherIndex.count : otherPos.count;\r\n                        for (let i2 = 0, l2 = triCount; i2 < l2; i2 += 3) {\r\n\r\n                            setTriangle(triangle2, i2, otherIndex, otherPos);\r\n                            triangle2.a.applyMatrix4(geometryToBvh);\r\n                            triangle2.b.applyMatrix4(geometryToBvh);\r\n                            triangle2.c.applyMatrix4(geometryToBvh);\r\n                            triangle2.needsUpdate = true;\r\n\r\n                            for (let i = offset * 3, l = (offset + count) * 3; i < l; i += 3) {\r\n\r\n                                setTriangle(triangle, i, index, pos);\r\n                                triangle.needsUpdate = true;\r\n\r\n                                const dist = triangle.distanceToTriangle(triangle2, tempTarget1, tempTarget2);\r\n                                if (dist < closestDistance) {\r\n\r\n                                    tempTargetDest1.copy(tempTarget1);\r\n\r\n                                    if (tempTargetDest2) {\r\n\r\n                                        tempTargetDest2.copy(tempTarget2);\r\n\r\n                                    }\r\n\r\n                                    closestDistance = dist;\r\n                                    closestDistanceTriIndex = i / 3;\r\n                                    closestDistanceOtherTriIndex = i2 / 3;\r\n\r\n                                }\r\n\r\n                                // stop traversal if we find a point that's under the given threshold\r\n                                if (dist < minThreshold) {\r\n\r\n                                    return true;\r\n\r\n                                }\r\n\r\n                            }\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                },\r\n\r\n            }\r\n\r\n        );\r\n\r\n        trianglePool.releasePrimitive(triangle);\r\n        trianglePool.releasePrimitive(triangle2);\r\n\r\n        if (closestDistance === Infinity) return null;\r\n\r\n        if (!target1.point) target1.point = tempTargetDest1.clone();\r\n        else target1.point.copy(tempTargetDest1);\r\n        target1.distance = closestDistance,\r\n            target1.faceIndex = closestDistanceTriIndex;\r\n\r\n        if (target2) {\r\n\r\n            if (!target2.point) target2.point = tempTargetDest2.clone();\r\n            else target2.point.copy(tempTargetDest2);\r\n            target2.point.applyMatrix4(tempMatrix);\r\n            tempTargetDest1.applyMatrix4(tempMatrix);\r\n            target2.distance = tempTargetDest1.sub(target2.point).length();\r\n            target2.faceIndex = closestDistanceOtherTriIndex;\r\n\r\n        }\r\n\r\n        return target1;\r\n\r\n    }\r\n\r\n    closestPointToPoint(point, target = {}, minThreshold = 0, maxThreshold = Infinity) {\r\n\r\n        // early out if under minThreshold\r\n        // skip checking if over maxThreshold\r\n        // set minThreshold = maxThreshold to quickly check if a point is within a threshold\r\n        // returns Infinity if no value found\r\n        const minThresholdSq = minThreshold * minThreshold;\r\n        const maxThresholdSq = maxThreshold * maxThreshold;\r\n        let closestDistanceSq = Infinity;\r\n        let closestDistanceTriIndex = null;\r\n        this.shapecast(\r\n\r\n            {\r\n\r\n                boundsTraverseOrder: box => {\r\n\r\n                    temp.copy(point).clamp(box.min, box.max);\r\n                    return temp.distanceToSquared(point);\r\n\r\n                },\r\n\r\n                intersectsBounds: (box, isLeaf, score) => {\r\n\r\n                    return score < closestDistanceSq && score < maxThresholdSq;\r\n\r\n                },\r\n\r\n                intersectsTriangle: (tri, triIndex) => {\r\n\r\n                    tri.closestPointToPoint(point, temp);\r\n                    const distSq = point.distanceToSquared(temp);\r\n                    if (distSq < closestDistanceSq) {\r\n\r\n                        temp1.copy(temp);\r\n                        closestDistanceSq = distSq;\r\n                        closestDistanceTriIndex = triIndex;\r\n\r\n                    }\r\n\r\n                    if (distSq < minThresholdSq) {\r\n\r\n                        return true;\r\n\r\n                    } else {\r\n\r\n                        return false;\r\n\r\n                    }\r\n\r\n                },\r\n\r\n            }\r\n\r\n        );\r\n\r\n        if (closestDistanceSq === Infinity) return null;\r\n\r\n        const closestDistance = Math.sqrt(closestDistanceSq);\r\n\r\n        if (!target.point) target.point = temp1.clone();\r\n        else target.point.copy(temp1);\r\n        target.distance = closestDistance,\r\n            target.faceIndex = closestDistanceTriIndex;\r\n\r\n        return target;\r\n\r\n    }\r\n\r\n    getBoundingBox(target) {\r\n\r\n        target.makeEmpty();\r\n\r\n        const roots = this._roots;\r\n        roots.forEach(buffer => {\r\n\r\n            arrayToBox(0, new Float32Array(buffer), tempBox);\r\n            target.union(tempBox);\r\n\r\n        });\r\n\r\n        return target;\r\n\r\n    }\r\n\r\n}\r\n\r\n// Deprecation\r\nconst originalRaycast = MeshBVH.prototype.raycast;\r\nMeshBVH.prototype.raycast = function(...args) {\r\n\r\n    if (args[0].isMesh) {\r\n\r\n        console.warn('MeshBVH: The function signature and results frame for \"raycast\" has changed. See docs for new signature.');\r\n        const [\r\n            mesh, raycaster, ray, intersects,\r\n        ] = args;\r\n\r\n        const results = originalRaycast.call(this, ray, mesh.material);\r\n        results.forEach(hit => {\r\n\r\n            hit = convertRaycastIntersect(hit, mesh, raycaster);\r\n            if (hit) {\r\n\r\n                intersects.push(hit);\r\n\r\n            }\r\n\r\n        });\r\n\r\n        return intersects;\r\n\r\n    } else {\r\n\r\n        return originalRaycast.apply(this, args);\r\n\r\n    }\r\n\r\n};\r\n\r\nconst originalRaycastFirst = MeshBVH.prototype.raycastFirst;\r\nMeshBVH.prototype.raycastFirst = function(...args) {\r\n\r\n    if (args[0].isMesh) {\r\n\r\n        console.warn('MeshBVH: The function signature and results frame for \"raycastFirst\" has changed. See docs for new signature.');\r\n        const [\r\n            mesh, raycaster, ray,\r\n        ] = args;\r\n\r\n        return convertRaycastIntersect(originalRaycastFirst.call(this, ray, mesh.material), mesh, raycaster);\r\n\r\n    } else {\r\n\r\n        return originalRaycastFirst.apply(this, args);\r\n\r\n    }\r\n\r\n};\r\n\r\nconst originalClosestPointToPoint = MeshBVH.prototype.closestPointToPoint;\r\nMeshBVH.prototype.closestPointToPoint = function(...args) {\r\n\r\n\r\n    if (args[0].isMesh) {\r\n\r\n        console.warn('MeshBVH: The function signature and results frame for \"closestPointToPoint\" has changed. See docs for new signature.');\r\n\r\n        args.unshift();\r\n\r\n        const target = args[1];\r\n        const result = {};\r\n        args[1] = result;\r\n\r\n        originalClosestPointToPoint.apply(this, args);\r\n\r\n        if (target) {\r\n\r\n            target.copy(result.point);\r\n\r\n        }\r\n\r\n        return result.distance;\r\n\r\n    } else {\r\n\r\n        return originalClosestPointToPoint.apply(this, args);\r\n\r\n    }\r\n\r\n};\r\n\r\nconst originalClosestPointToGeometry = MeshBVH.prototype.closestPointToGeometry;\r\nMeshBVH.prototype.closestPointToGeometry = function(...args) {\r\n\r\n    const target1 = args[2];\r\n    const target2 = args[3];\r\n    if (target1 && target1.isVector3 || target2 && target2.isVector3) {\r\n\r\n        console.warn('MeshBVH: The function signature and results frame for \"closestPointToGeometry\" has changed. See docs for new signature.');\r\n\r\n        const result1 = {};\r\n        const result2 = {};\r\n        const geometryToBvh = args[1];\r\n        args[2] = result1;\r\n        args[3] = result2;\r\n\r\n        originalClosestPointToGeometry.apply(this, args);\r\n\r\n        if (target1) {\r\n\r\n            target1.copy(result1.point);\r\n\r\n        }\r\n\r\n        if (target2) {\r\n\r\n            target2.copy(result2.point).applyMatrix4(geometryToBvh);\r\n\r\n        }\r\n\r\n        return result1.distance;\r\n\r\n    } else {\r\n\r\n        return originalClosestPointToGeometry.apply(this, args);\r\n\r\n    }\r\n\r\n};\r\n\r\nconst originalRefit = MeshBVH.prototype.refit;\r\nMeshBVH.prototype.refit = function(...args) {\r\n\r\n    const nodeIndices = args[0];\r\n    const terminationIndices = args[1];\r\n    if (terminationIndices && (terminationIndices instanceof Set || Array.isArray(terminationIndices))) {\r\n\r\n        console.warn('MeshBVH: The function signature for \"refit\" has changed. See docs for new signature.');\r\n\r\n        const newNodeIndices = new Set();\r\n        terminationIndices.forEach(v => newNodeIndices.add(v));\r\n        if (nodeIndices) {\r\n\r\n            nodeIndices.forEach(v => newNodeIndices.add(v));\r\n\r\n        }\r\n\r\n        originalRefit.call(this, newNodeIndices);\r\n\r\n    } else {\r\n\r\n        originalRefit.apply(this, args);\r\n\r\n    }\r\n\r\n};\r\n\r\n[\r\n    'intersectsGeometry',\r\n    'shapecast',\r\n    'intersectsBox',\r\n    'intersectsSphere',\r\n].forEach(name => {\r\n\r\n    const originalFunc = MeshBVH.prototype[name];\r\n    MeshBVH.prototype[name] = function(...args) {\r\n\r\n        if (args[0] === null || args[0].isMesh) {\r\n\r\n            args.shift();\r\n            console.warn(`MeshBVH: The function signature for \"${ name }\" has changed and no longer takes Mesh. See docs for new signature.`);\r\n\r\n        }\r\n\r\n        return originalFunc.apply(this, args);\r\n\r\n    };\r\n\r\n});\r\n\r\nconst boundingBox = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3();\r\nclass MeshBVHRootVisualizer extends https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Object3D {\r\n\r\n    get isMesh() {\r\n\r\n        return !this.displayEdges;\r\n\r\n    }\r\n\r\n    get isLineSegments() {\r\n\r\n        return this.displayEdges;\r\n\r\n    }\r\n\r\n    get isLine() {\r\n\r\n        return this.displayEdges;\r\n\r\n    }\r\n\r\n    constructor(mesh, material, depth = 10, group = 0) {\r\n\r\n        super();\r\n\r\n        this.material = material;\r\n        this.geometry = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.BufferGeometry();\r\n        this.name = 'MeshBVHRootVisualizer';\r\n        this.depth = depth;\r\n        this.displayParents = false;\r\n        this.mesh = mesh;\r\n        this.displayEdges = true;\r\n        this._group = group;\r\n\r\n    }\r\n\r\n    raycast() {}\r\n\r\n    update() {\r\n\r\n        const geometry = this.geometry;\r\n        const boundsTree = this.mesh.geometry.boundsTree;\r\n        const group = this._group;\r\n        geometry.dispose();\r\n        this.visible = false;\r\n        if (boundsTree) {\r\n\r\n            // count the number of bounds required\r\n            const targetDepth = this.depth - 1;\r\n            const displayParents = this.displayParents;\r\n            let boundsCount = 0;\r\n            boundsTree.traverse((depth, isLeaf) => {\r\n\r\n                if (depth === targetDepth || isLeaf) {\r\n\r\n                    boundsCount++;\r\n                    return true;\r\n\r\n                } else if (displayParents) {\r\n\r\n                    boundsCount++;\r\n\r\n                }\r\n\r\n            }, group);\r\n\r\n            // fill in the position buffer with the bounds corners\r\n            let posIndex = 0;\r\n            const positionArray = new Float32Array(8 * 3 * boundsCount);\r\n            boundsTree.traverse((depth, isLeaf, boundingData) => {\r\n\r\n                const terminate = depth === targetDepth || isLeaf;\r\n                if (terminate || displayParents) {\r\n\r\n                    arrayToBox(0, boundingData, boundingBox);\r\n\r\n                    const { min, max } = boundingBox;\r\n                    for (let x = -1; x <= 1; x += 2) {\r\n\r\n                        const xVal = x < 0 ? min.x : max.x;\r\n                        for (let y = -1; y <= 1; y += 2) {\r\n\r\n                            const yVal = y < 0 ? min.y : max.y;\r\n                            for (let z = -1; z <= 1; z += 2) {\r\n\r\n                                const zVal = z < 0 ? min.z : max.z;\r\n                                positionArray[posIndex + 0] = xVal;\r\n                                positionArray[posIndex + 1] = yVal;\r\n                                positionArray[posIndex + 2] = zVal;\r\n\r\n                                posIndex += 3;\r\n\r\n                            }\r\n\r\n                        }\r\n\r\n                    }\r\n\r\n                    return terminate;\r\n\r\n                }\r\n\r\n            }, group);\r\n\r\n            let indexArray;\r\n            let indices;\r\n            if (this.displayEdges) {\r\n\r\n                // fill in the index buffer to point to the corner points\r\n                indices = new Uint8Array([\r\n                    // x axis\r\n                    0, 4,\r\n                    1, 5,\r\n                    2, 6,\r\n                    3, 7,\r\n\r\n                    // y axis\r\n                    0, 2,\r\n                    1, 3,\r\n                    4, 6,\r\n                    5, 7,\r\n\r\n                    // z axis\r\n                    0, 1,\r\n                    2, 3,\r\n                    4, 5,\r\n                    6, 7,\r\n                ]);\r\n\r\n            } else {\r\n\r\n                indices = new Uint8Array([\r\n\r\n                    // X-, X+\r\n                    0, 1, 2,\r\n                    2, 1, 3,\r\n\r\n                    4, 6, 5,\r\n                    6, 7, 5,\r\n\r\n                    // Y-, Y+\r\n                    1, 4, 5,\r\n                    0, 4, 1,\r\n\r\n                    2, 3, 6,\r\n                    3, 7, 6,\r\n\r\n                    // Z-, Z+\r\n                    0, 2, 4,\r\n                    2, 6, 4,\r\n\r\n                    1, 5, 3,\r\n                    3, 5, 7,\r\n\r\n                ]);\r\n\r\n            }\r\n\r\n            if (positionArray.length > 65535) {\r\n\r\n                indexArray = new Uint32Array(indices.length * boundsCount);\r\n\r\n            } else {\r\n\r\n                indexArray = new Uint16Array(indices.length * boundsCount);\r\n\r\n            }\r\n\r\n            const indexLength = indices.length;\r\n            for (let i = 0; i < boundsCount; i++) {\r\n\r\n                const posOffset = i * 8;\r\n                const indexOffset = i * indexLength;\r\n                for (let j = 0; j < indexLength; j++) {\r\n\r\n                    indexArray[indexOffset + j] = posOffset + indices[j];\r\n\r\n                }\r\n\r\n            }\r\n\r\n            // update the geometry\r\n            geometry.setIndex(\r\n                new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.BufferAttribute(indexArray, 1, false),\r\n            );\r\n            geometry.setAttribute(\r\n                'position',\r\n                new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.BufferAttribute(positionArray, 3, false),\r\n            );\r\n            this.visible = true;\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nclass MeshBVHVisualizer extends https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Group {\r\n\r\n    get color() {\r\n\r\n        return this.edgeMaterial.color;\r\n\r\n    }\r\n\r\n    get opacity() {\r\n\r\n        return this.edgeMaterial.opacity;\r\n\r\n    }\r\n\r\n    set opacity(v) {\r\n\r\n        this.edgeMaterial.opacity = v;\r\n        this.meshMaterial.opacity = v;\r\n\r\n    }\r\n\r\n    constructor(mesh, depth = 10) {\r\n\r\n        super();\r\n\r\n        this.name = 'MeshBVHVisualizer';\r\n        this.depth = depth;\r\n        this.mesh = mesh;\r\n        this.displayParents = false;\r\n        this.displayEdges = true;\r\n        this._roots = [];\r\n\r\n        const edgeMaterial = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.LineBasicMaterial({\r\n            color: 0x00FF88,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            depthWrite: false,\r\n        });\r\n\r\n        const meshMaterial = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.MeshBasicMaterial({\r\n            color: 0x00FF88,\r\n            transparent: true,\r\n            opacity: 0.3,\r\n            depthWrite: false,\r\n        });\r\n\r\n        meshMaterial.color = edgeMaterial.color;\r\n\r\n        this.edgeMaterial = edgeMaterial;\r\n        this.meshMaterial = meshMaterial;\r\n\r\n        this.update();\r\n\r\n    }\r\n\r\n    update() {\r\n\r\n        const bvh = this.mesh.geometry.boundsTree;\r\n        const totalRoots = bvh ? bvh._roots.length : 0;\r\n        while (this._roots.length > totalRoots) {\r\n\r\n            this._roots.pop();\r\n\r\n        }\r\n\r\n        for (let i = 0; i < totalRoots; i++) {\r\n\r\n            if (i >= this._roots.length) {\r\n\r\n                const root = new MeshBVHRootVisualizer(this.mesh, this.edgeMaterial, this.depth, i);\r\n                this.add(root);\r\n                this._roots.push(root);\r\n\r\n            }\r\n\r\n            const root = this._roots[i];\r\n            root.depth = this.depth;\r\n            root.mesh = this.mesh;\r\n            root.displayParents = this.displayParents;\r\n            root.displayEdges = this.displayEdges;\r\n            root.material = this.displayEdges ? this.edgeMaterial : this.meshMaterial;\r\n            root.update();\r\n\r\n        }\r\n\r\n    }\r\n\r\n    updateMatrixWorld(...args) {\r\n\r\n        this.position.copy(this.mesh.position);\r\n        this.rotation.copy(this.mesh.rotation);\r\n        this.scale.copy(this.mesh.scale);\r\n\r\n        super.updateMatrixWorld(...args);\r\n\r\n    }\r\n\r\n    copy(source) {\r\n\r\n        this.depth = source.depth;\r\n        this.mesh = source.mesh;\r\n\r\n    }\r\n\r\n    clone() {\r\n\r\n        return new MeshBVHVisualizer(this.mesh, this.depth);\r\n\r\n    }\r\n\r\n    dispose() {\r\n\r\n        this.edgeMaterial.dispose();\r\n        this.meshMaterial.dispose();\r\n\r\n        const children = this.children;\r\n        for (let i = 0, l = children.length; i < l; i++) {\r\n\r\n            children[i].geometry.dispose();\r\n\r\n        }\r\n\r\n    }\r\n\r\n}\r\n\r\nconst _box1 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3();\r\nconst _box2 = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3();\r\nconst _vec = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Vector3();\r\n\r\n// https://stackoverflow.com/questions/1248302/how-to-get-the-size-of-a-javascript-object\r\nfunction getPrimitiveSize(el) {\r\n\r\n    switch (typeof el) {\r\n\r\n        case 'number':\r\n            return 8;\r\n        case 'string':\r\n            return el.length * 2;\r\n        case 'boolean':\r\n            return 4;\r\n        default:\r\n            return 0;\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction isTypedArray(arr) {\r\n\r\n    const regex = /(Uint|Int|Float)(8|16|32)Array/;\r\n    return regex.test(arr.constructor.name);\r\n\r\n}\r\n\r\nfunction getRootExtremes(bvh, group) {\r\n\r\n    const result = {\r\n        nodeCount: 0,\r\n        leafNodeCount: 0,\r\n\r\n        depth: {\r\n            min: Infinity,\r\n            max: -Infinity\r\n        },\r\n        tris: {\r\n            min: Infinity,\r\n            max: -Infinity\r\n        },\r\n        splits: [0, 0, 0],\r\n        surfaceAreaScore: 0,\r\n    };\r\n\r\n    bvh.traverse((depth, isLeaf, boundingData, offsetOrSplit, count) => {\r\n\r\n        const l0 = boundingData[0 + 3] - boundingData[0];\r\n        const l1 = boundingData[1 + 3] - boundingData[1];\r\n        const l2 = boundingData[2 + 3] - boundingData[2];\r\n\r\n        const surfaceArea = 2 * (l0 * l1 + l1 * l2 + l2 * l0);\r\n\r\n        result.nodeCount++;\r\n        if (isLeaf) {\r\n\r\n            result.leafNodeCount++;\r\n\r\n            result.depth.min = Math.min(depth, result.depth.min);\r\n            result.depth.max = Math.max(depth, result.depth.max);\r\n\r\n            result.tris.min = Math.min(count, result.tris.min);\r\n            result.tris.max = Math.max(count, result.tris.max);\r\n\r\n            result.surfaceAreaScore += surfaceArea * TRIANGLE_INTERSECT_COST * count;\r\n\r\n        } else {\r\n\r\n            result.splits[offsetOrSplit]++;\r\n\r\n            result.surfaceAreaScore += surfaceArea * TRAVERSAL_COST;\r\n\r\n        }\r\n\r\n    }, group);\r\n\r\n    // If there are no leaf nodes because the tree hasn't finished generating yet.\r\n    if (result.tris.min === Infinity) {\r\n\r\n        result.tris.min = 0;\r\n        result.tris.max = 0;\r\n\r\n    }\r\n\r\n    if (result.depth.min === Infinity) {\r\n\r\n        result.depth.min = 0;\r\n        result.depth.max = 0;\r\n\r\n    }\r\n\r\n    return result;\r\n\r\n}\r\n\r\nfunction getBVHExtremes(bvh) {\r\n\r\n    return bvh._roots.map((root, i) => getRootExtremes(bvh, i));\r\n\r\n}\r\n\r\nfunction estimateMemoryInBytes(obj) {\r\n\r\n    const traversed = new Set();\r\n    const stack = [obj];\r\n    let bytes = 0;\r\n\r\n    while (stack.length) {\r\n\r\n        const curr = stack.pop();\r\n        if (traversed.has(curr)) {\r\n\r\n            continue;\r\n\r\n        }\r\n\r\n        traversed.add(curr);\r\n\r\n        for (let key in curr) {\r\n\r\n            if (!curr.hasOwnProperty(key)) {\r\n\r\n                continue;\r\n\r\n            }\r\n\r\n            bytes += getPrimitiveSize(key);\r\n\r\n            const value = curr[key];\r\n            if (value && (typeof value === 'object' || typeof value === 'function')) {\r\n\r\n                if (isTypedArray(value)) {\r\n\r\n                    bytes += value.byteLength;\r\n\r\n                } else if (value instanceof ArrayBuffer) {\r\n\r\n                    bytes += value.byteLength;\r\n\r\n                } else {\r\n\r\n                    stack.push(value);\r\n\r\n                }\r\n\r\n            } else {\r\n\r\n                bytes += getPrimitiveSize(value);\r\n\r\n            }\r\n\r\n\r\n        }\r\n\r\n    }\r\n\r\n    return bytes;\r\n\r\n}\r\n\r\nfunction validateBounds(bvh) {\r\n\r\n    const geometry = bvh.geometry;\r\n    const depthStack = [];\r\n    const index = geometry.index;\r\n    const position = geometry.getAttribute('position');\r\n    let passes = true;\r\n\r\n    bvh.traverse((depth, isLeaf, boundingData, offset, count) => {\r\n\r\n        const info = {\r\n            depth,\r\n            isLeaf,\r\n            boundingData,\r\n            offset,\r\n            count,\r\n        };\r\n        depthStack[depth] = info;\r\n\r\n        arrayToBox(0, boundingData, _box1);\r\n        const parent = depthStack[depth - 1];\r\n\r\n        if (isLeaf) {\r\n\r\n            // check triangles\r\n            for (let i = offset * 3, l = (offset + count) * 3; i < l; i += 3) {\r\n\r\n                const i0 = index.getX(i);\r\n                const i1 = index.getX(i + 1);\r\n                const i2 = index.getX(i + 2);\r\n\r\n                let isContained;\r\n\r\n                _vec.fromBufferAttribute(position, i0);\r\n                isContained = _box1.containsPoint(_vec);\r\n\r\n                _vec.fromBufferAttribute(position, i1);\r\n                isContained = isContained && _box1.containsPoint(_vec);\r\n\r\n                _vec.fromBufferAttribute(position, i2);\r\n                isContained = isContained && _box1.containsPoint(_vec);\r\n\r\n                console.assert(isContained, 'Leaf bounds does not fully contain triangle.');\r\n                passes = passes && isContained;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        if (parent) {\r\n\r\n            // check if my bounds fit in my parents\r\n            arrayToBox(0, boundingData, _box2);\r\n\r\n            const isContained = _box2.containsBox(_box1);\r\n            console.assert(isContained, 'Parent bounds does not fully contain child.');\r\n            passes = passes && isContained;\r\n\r\n        }\r\n\r\n    });\r\n\r\n    return passes;\r\n\r\n}\r\n\r\n// Returns a simple, human readable object that represents the BVH.\r\nfunction getJSONStructure(bvh) {\r\n\r\n    const depthStack = [];\r\n\r\n    bvh.traverse((depth, isLeaf, boundingData, offset, count) => {\r\n\r\n        const info = {\r\n            bounds: arrayToBox(0, boundingData, new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Box3()),\r\n        };\r\n\r\n        if (isLeaf) {\r\n\r\n            info.count = count;\r\n            info.offset = offset;\r\n\r\n        } else {\r\n\r\n            info.left = null;\r\n            info.right = null;\r\n\r\n        }\r\n\r\n        depthStack[depth] = info;\r\n\r\n        // traversal hits the left then right node\r\n        const parent = depthStack[depth - 1];\r\n        if (parent) {\r\n\r\n            if (parent.left === null) {\r\n\r\n                parent.left = info;\r\n\r\n            } else {\r\n\r\n                parent.right = info;\r\n\r\n            }\r\n\r\n        }\r\n\r\n    });\r\n\r\n    return depthStack[0];\r\n\r\n}\r\n\r\nconst ray = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Ray();\r\nconst tmpInverseMatrix = /* @__PURE__ */ new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Matrix4();\r\nconst origMeshRaycastFunc = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.Mesh.prototype.raycast;\r\n\r\nfunction acceleratedRaycast(raycaster, intersects) {\r\n\r\n    if (this.geometry.boundsTree) {\r\n\r\n        if (this.material === undefined) return;\r\n\r\n        tmpInverseMatrix.copy(this.matrixWorld).invert();\r\n        ray.copy(raycaster.ray).applyMatrix4(tmpInverseMatrix);\r\n\r\n        const bvh = this.geometry.boundsTree;\r\n        if (raycaster.firstHitOnly === true) {\r\n\r\n            const hit = convertRaycastIntersect(bvh.raycastFirst(ray, this.material), this, raycaster);\r\n            if (hit) {\r\n\r\n                intersects.push(hit);\r\n\r\n            }\r\n\r\n        } else {\r\n\r\n            const hits = bvh.raycast(ray, this.material);\r\n            for (let i = 0, l = hits.length; i < l; i++) {\r\n\r\n                const hit = convertRaycastIntersect(hits[i], this, raycaster);\r\n                if (hit) {\r\n\r\n                    intersects.push(hit);\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n    } else {\r\n\r\n        origMeshRaycastFunc.call(this, raycaster, intersects);\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction computeBoundsTree(options) {\r\n\r\n    this.boundsTree = new MeshBVH(this, options);\r\n    return this.boundsTree;\r\n\r\n}\r\n\r\nfunction disposeBoundsTree() {\r\n\r\n    this.boundsTree = null;\r\n\r\n}\r\n\r\nfunction countToStringFormat(count) {\r\n\r\n    switch (count) {\r\n\r\n        case 1:\r\n            return 'R';\r\n        case 2:\r\n            return 'RG';\r\n        case 3:\r\n            return 'RGB';\r\n        case 4:\r\n            return 'RGBA';\r\n\r\n    }\r\n\r\n    throw new Error();\r\n\r\n}\r\n\r\nfunction countToFormat(count) {\r\n\r\n    switch (count) {\r\n\r\n        case 1:\r\n            return https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RedFormat;\r\n        case 2:\r\n            return https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RGFormat;\r\n        case 3:\r\n            return https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RGBFormat;\r\n        case 4:\r\n            return https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RGBAFormat;\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction countToIntFormat(count) {\r\n\r\n    switch (count) {\r\n\r\n        case 1:\r\n            return https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RedIntegerFormat;\r\n        case 2:\r\n            return https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RGIntegerFormat;\r\n        case 3:\r\n            return https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RGBIntegerFormat;\r\n        case 4:\r\n            return https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RGBAIntegerFormat;\r\n\r\n    }\r\n\r\n}\r\n\r\nclass VertexAttributeTexture extends https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.DataTexture {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this.minFilter = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.NearestFilter;\r\n        this.magFilter = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.NearestFilter;\r\n        this.generateMipmaps = false;\r\n        this.overrideItemSize = null;\r\n        this._forcedType = null;\r\n\r\n    }\r\n\r\n    updateFrom(attr) {\r\n\r\n        const overrideItemSize = this.overrideItemSize;\r\n        const originalItemSize = attr.itemSize;\r\n        const originalCount = attr.count;\r\n        if (overrideItemSize !== null) {\r\n\r\n            if ((originalItemSize * originalCount) % overrideItemSize !== 0.0) {\r\n\r\n                throw new Error('VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.');\r\n\r\n            }\r\n\r\n            attr.itemSize = overrideItemSize;\r\n            attr.count = originalCount * originalItemSize / overrideItemSize;\r\n\r\n        }\r\n\r\n        const itemSize = attr.itemSize;\r\n        const count = attr.count;\r\n        const normalized = attr.normalized;\r\n        const originalBufferCons = attr.array.constructor;\r\n        const byteCount = originalBufferCons.BYTES_PER_ELEMENT;\r\n        let targetType = this._forcedType;\r\n\r\n        // derive the type of texture this should be in the shader\r\n        if (targetType === null) {\r\n\r\n            switch (originalBufferCons) {\r\n\r\n                case Float32Array:\r\n                    targetType = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.FloatType;\r\n                    break;\r\n\r\n                case Uint8Array:\r\n                case Uint16Array:\r\n                case Uint32Array:\r\n                    targetType = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.UnsignedIntType;\r\n                    break;\r\n\r\n                case Int8Array:\r\n                case Int16Array:\r\n                case Int32Array:\r\n                    targetType = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.IntType;\r\n                    break;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // get the target format to store the texture as\r\n        let type, format, normalizeValue, targetBufferCons;\r\n        let internalFormat = countToStringFormat(itemSize);\r\n        switch (targetType) {\r\n\r\n            case https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.FloatType:\r\n                normalizeValue = 1.0;\r\n                format = countToFormat(itemSize);\r\n\r\n                if (normalized && byteCount === 1) {\r\n\r\n                    targetBufferCons = originalBufferCons;\r\n                    internalFormat += '8';\r\n\r\n                    if (originalBufferCons === Uint8Array) {\r\n\r\n                        type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.UnsignedByteType;\r\n\r\n                    } else {\r\n\r\n                        type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.ByteType;\r\n                        internalFormat += '_SNORM';\r\n\r\n                    }\r\n\r\n                } else {\r\n\r\n                    targetBufferCons = Float32Array;\r\n                    internalFormat += '32F';\r\n                    type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.FloatType;\r\n\r\n                }\r\n\r\n                break;\r\n\r\n            case https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.IntType:\r\n                internalFormat += byteCount * 8 + 'I';\r\n                normalizeValue = normalized ? Math.pow(2, originalBufferCons.BYTES_PER_ELEMENT * 8 - 1) : 1.0;\r\n                format = countToIntFormat(itemSize);\r\n\r\n                if (byteCount === 1) {\r\n\r\n                    targetBufferCons = Int8Array;\r\n                    type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.ByteType;\r\n\r\n                } else if (byteCount === 2) {\r\n\r\n                    targetBufferCons = Int16Array;\r\n                    type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.ShortType;\r\n\r\n                } else {\r\n\r\n                    targetBufferCons = Int32Array;\r\n                    type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.IntType;\r\n\r\n                }\r\n\r\n                break;\r\n\r\n            case https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.UnsignedIntType:\r\n                internalFormat += byteCount * 8 + 'UI';\r\n                normalizeValue = normalized ? Math.pow(2, originalBufferCons.BYTES_PER_ELEMENT * 8 - 1) : 1.0;\r\n                format = countToIntFormat(itemSize);\r\n\r\n                if (byteCount === 1) {\r\n\r\n                    targetBufferCons = Uint8Array;\r\n                    type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.UnsignedByteType;\r\n\r\n                } else if (byteCount === 2) {\r\n\r\n                    targetBufferCons = Uint16Array;\r\n                    type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.UnsignedShortType;\r\n\r\n                } else {\r\n\r\n                    targetBufferCons = Uint32Array;\r\n                    type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.UnsignedIntType;\r\n\r\n                }\r\n\r\n                break;\r\n\r\n        }\r\n\r\n        // copy the data over to the new texture array\r\n        const dimension = Math.ceil(Math.sqrt(count));\r\n        const length = itemSize * dimension * dimension;\r\n        const dataArray = new targetBufferCons(length);\r\n        for (let i = 0; i < count; i++) {\r\n\r\n            const ii = itemSize * i;\r\n            dataArray[ii] = attr.getX(i) / normalizeValue;\r\n\r\n            if (itemSize >= 2) {\r\n\r\n                dataArray[ii + 1] = attr.getY(i) / normalizeValue;\r\n\r\n            }\r\n\r\n            if (itemSize >= 3) {\r\n\r\n                dataArray[ii + 2] = attr.getZ(i) / normalizeValue;\r\n\r\n            }\r\n\r\n            if (itemSize >= 4) {\r\n\r\n                dataArray[ii + 3] = attr.getW(i) / normalizeValue;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        this.internalFormat = internalFormat;\r\n        this.format = format;\r\n        this.type = type;\r\n        this.image.width = dimension;\r\n        this.image.height = dimension;\r\n        this.image.data = dataArray;\r\n        this.needsUpdate = true;\r\n\r\n        attr.itemSize = originalItemSize;\r\n        attr.count = originalCount;\r\n\r\n    }\r\n\r\n}\r\n\r\nclass UIntVertexAttributeTexture extends VertexAttributeTexture {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this._forcedType = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.UnsignedIntType;\r\n\r\n    }\r\n\r\n}\r\n\r\nclass IntVertexAttributeTexture extends VertexAttributeTexture {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this._forcedType = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.IntType;\r\n\r\n    }\r\n\r\n\r\n}\r\n\r\nclass FloatVertexAttributeTexture extends VertexAttributeTexture {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this._forcedType = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.FloatType;\r\n\r\n    }\r\n\r\n}\r\n\r\nfunction bvhToTextures(bvh, boundsTexture, contentsTexture) {\r\n\r\n    const roots = bvh._roots;\r\n\r\n    if (roots.length !== 1) {\r\n\r\n        throw new Error('MeshBVHUniformStruct: Multi-root BVHs not supported.');\r\n\r\n    }\r\n\r\n    const root = roots[0];\r\n    const uint16Array = new Uint16Array(root);\r\n    const uint32Array = new Uint32Array(root);\r\n    const float32Array = new Float32Array(root);\r\n\r\n    // Both bounds need two elements per node so compute the height so it's twice as long as\r\n    // the width so we can expand the row by two and still have a square texture\r\n    const nodeCount = root.byteLength / BYTES_PER_NODE;\r\n    const boundsDimension = 2 * Math.ceil(Math.sqrt(nodeCount / 2));\r\n    const boundsArray = new Float32Array(3 * boundsDimension * boundsDimension);\r\n\r\n    const contentsDimension = Math.ceil(Math.sqrt(nodeCount));\r\n    const contentsArray = new Uint32Array(2 * contentsDimension * contentsDimension);\r\n\r\n    for (let i = 0; i < nodeCount; i++) {\r\n\r\n        const nodeIndex32 = i * BYTES_PER_NODE / 4;\r\n        const nodeIndex16 = nodeIndex32 * 2;\r\n        const boundsIndex = BOUNDING_DATA_INDEX(nodeIndex32);\r\n        for (let b = 0; b < 6; b++) {\r\n\r\n            boundsArray[6 * i + b] = float32Array[boundsIndex + b];\r\n\r\n        }\r\n\r\n        if (IS_LEAF(nodeIndex16, uint16Array)) {\r\n\r\n            const count = COUNT(nodeIndex16, uint16Array);\r\n            const offset = OFFSET(nodeIndex32, uint32Array);\r\n\r\n            const mergedLeafCount = 0xffff0000 | count;\r\n            contentsArray[i * 2 + 0] = mergedLeafCount;\r\n            contentsArray[i * 2 + 1] = offset;\r\n\r\n        } else {\r\n\r\n            const rightIndex = 4 * RIGHT_NODE(nodeIndex32, uint32Array) / BYTES_PER_NODE;\r\n            const splitAxis = SPLIT_AXIS(nodeIndex32, uint32Array);\r\n\r\n            contentsArray[i * 2 + 0] = splitAxis;\r\n            contentsArray[i * 2 + 1] = rightIndex;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    boundsTexture.image.data = boundsArray;\r\n    boundsTexture.image.width = boundsDimension;\r\n    boundsTexture.image.height = boundsDimension;\r\n    boundsTexture.format = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RGBFormat;\r\n    boundsTexture.type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.FloatType;\r\n    boundsTexture.internalFormat = 'RGB32F';\r\n    boundsTexture.minFilter = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.NearestFilter;\r\n    boundsTexture.magFilter = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.NearestFilter;\r\n    boundsTexture.generateMipmaps = false;\r\n    boundsTexture.needsUpdate = true;\r\n\r\n    contentsTexture.image.data = contentsArray;\r\n    contentsTexture.image.width = contentsDimension;\r\n    contentsTexture.image.height = contentsDimension;\r\n    contentsTexture.format = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.RGIntegerFormat;\r\n    contentsTexture.type = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.UnsignedIntType;\r\n    contentsTexture.internalFormat = 'RG32UI';\r\n    contentsTexture.minFilter = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.NearestFilter;\r\n    contentsTexture.magFilter = https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.NearestFilter;\r\n    contentsTexture.generateMipmaps = false;\r\n    contentsTexture.needsUpdate = true;\r\n\r\n}\r\n\r\nclass MeshBVHUniformStruct {\r\n\r\n    constructor() {\r\n\r\n        this.autoDispose = true;\r\n        this.index = new UIntVertexAttributeTexture();\r\n        this.position = new FloatVertexAttributeTexture();\r\n        this.bvhBounds = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.DataTexture();\r\n        this.bvhContents = new https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js__WEBPACK_IMPORTED_MODULE_0__.DataTexture();\r\n\r\n        this.index.overrideItemSize = 3;\r\n\r\n    }\r\n\r\n    updateFrom(bvh) {\r\n\r\n        const { geometry } = bvh;\r\n\r\n        bvhToTextures(bvh, this.bvhBounds, this.bvhContents);\r\n\r\n        this.index.updateFrom(geometry.index);\r\n        this.position.updateFrom(geometry.attributes.position);\r\n\r\n    }\r\n\r\n    dispose() {\r\n\r\n        const { index, position, bvhBounds, bvhContents } = this;\r\n\r\n        if (index) index.dispose();\r\n        if (position) position.dispose();\r\n        if (bvhBounds) bvhBounds.dispose();\r\n        if (bvhContents) bvhContents.dispose();\r\n\r\n    }\r\n\r\n}\r\n\r\nconst shaderStructs = /* glsl */ `\r\n#ifndef TRI_INTERSECT_EPSILON\r\n#define TRI_INTERSECT_EPSILON 1e-5\r\n#endif\r\n\r\n#ifndef INFINITY\r\n#define INFINITY 1e20\r\n#endif\r\n\r\nstruct BVH {\r\n\r\n\tusampler2D index;\r\n\tsampler2D position;\r\n\r\n\tsampler2D bvhBounds;\r\n\tusampler2D bvhContents;\r\n\r\n};\r\n\r\n// Note that a struct cannot be used for the hit record including faceIndices, faceNormal, barycoord,\r\n// side, and dist because on some mobile GPUS (such as Adreno) numbers are afforded less precision specifically\r\n// when in a struct leading to inaccurate hit results. See KhronosGroup/WebGL#3351 for more details.\r\n`;\r\n\r\nconst shaderIntersectFunction = /* glsl */ `\r\n\r\nuvec4 uTexelFetch1D( usampler2D tex, uint index ) {\r\n\r\n\tuint width = uint( textureSize( tex, 0 ).x );\r\n\tuvec2 uv;\r\n\tuv.x = index % width;\r\n\tuv.y = index / width;\r\n\r\n\treturn texelFetch( tex, ivec2( uv ), 0 );\r\n\r\n}\r\n\r\nivec4 iTexelFetch1D( isampler2D tex, uint index ) {\r\n\r\n\tuint width = uint( textureSize( tex, 0 ).x );\r\n\tuvec2 uv;\r\n\tuv.x = index % width;\r\n\tuv.y = index / width;\r\n\r\n\treturn texelFetch( tex, ivec2( uv ), 0 );\r\n\r\n}\r\n\r\nvec4 texelFetch1D( sampler2D tex, uint index ) {\r\n\r\n\tuint width = uint( textureSize( tex, 0 ).x );\r\n\tuvec2 uv;\r\n\tuv.x = index % width;\r\n\tuv.y = index / width;\r\n\r\n\treturn texelFetch( tex, ivec2( uv ), 0 );\r\n\r\n}\r\n\r\nvec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {\r\n\r\n\treturn\r\n\t\tbarycoord.x * texelFetch1D( tex, faceIndices.x ) +\r\n\t\tbarycoord.y * texelFetch1D( tex, faceIndices.y ) +\r\n\t\tbarycoord.z * texelFetch1D( tex, faceIndices.z );\r\n\r\n}\r\n\r\nvoid ndcToCameraRay(\r\n\tvec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,\r\n\tout vec3 rayOrigin, out vec3 rayDirection\r\n) {\r\n\r\n\t// get camera look direction and near plane for camera clipping\r\n\tvec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );\r\n\tvec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );\r\n\tfloat near = abs( nearVector.z / nearVector.w );\r\n\r\n\t// get the camera direction and position from camera matrices\r\n\tvec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );\r\n\tvec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );\r\n\tdirection /= direction.w;\r\n\tdirection = cameraWorld * direction - origin;\r\n\r\n\t// slide the origin along the ray until it sits at the near clip plane position\r\n\torigin.xyz += direction.xyz * near / dot( direction, lookDirection );\r\n\r\n\trayOrigin = origin.xyz;\r\n\trayDirection = direction.xyz;\r\n\r\n}\r\n\r\nfloat intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax ) {\r\n\r\n\t// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/\r\n\t// https://tavianator.com/2011/ray_box.html\r\n\tvec3 invDir = 1.0 / rayDirection;\r\n\r\n\t// find intersection distances for each plane\r\n\tvec3 tMinPlane = invDir * ( boundsMin - rayOrigin );\r\n\tvec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );\r\n\r\n\t// get the min and max distances from each intersection\r\n\tvec3 tMinHit = min( tMaxPlane, tMinPlane );\r\n\tvec3 tMaxHit = max( tMaxPlane, tMinPlane );\r\n\r\n\t// get the furthest hit distance\r\n\tvec2 t = max( tMinHit.xx, tMinHit.yz );\r\n\tfloat t0 = max( t.x, t.y );\r\n\r\n\t// get the minimum hit distance\r\n\tt = min( tMaxHit.xx, tMaxHit.yz );\r\n\tfloat t1 = min( t.x, t.y );\r\n\r\n\t// set distance to 0.0 if the ray starts inside the box\r\n\tfloat dist = max( t0, 0.0 );\r\n\r\n\treturn t1 >= dist ? dist : INFINITY;\r\n\r\n}\r\n\r\nbool intersectsTriangle(\r\n\tvec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,\r\n\tout vec3 barycoord, out vec3 norm, out float dist, out float side\r\n) {\r\n\r\n\t// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d\r\n\tvec3 edge1 = b - a;\r\n\tvec3 edge2 = c - a;\r\n\tnorm = cross( edge1, edge2 );\r\n\r\n\tfloat det = - dot( rayDirection, norm );\r\n\tfloat invdet = 1.0 / det;\r\n\r\n\tvec3 AO = rayOrigin - a;\r\n\tvec3 DAO = cross( AO, rayDirection );\r\n\r\n\tvec4 uvt;\r\n\tuvt.x = dot( edge2, DAO ) * invdet;\r\n\tuvt.y = - dot( edge1, DAO ) * invdet;\r\n\tuvt.z = dot( AO, norm ) * invdet;\r\n\tuvt.w = 1.0 - uvt.x - uvt.y;\r\n\r\n\t// set the hit information\r\n\tbarycoord = uvt.wxy; // arranged in A, B, C order\r\n\tdist = uvt.z;\r\n\tside = sign( det );\r\n\tnorm = side * normalize( norm );\r\n\r\n\t// add an epsilon to avoid misses between triangles\r\n\tuvt += vec4( TRI_INTERSECT_EPSILON );\r\n\r\n\treturn all( greaterThanEqual( uvt, vec4( 0.0 ) ) );\r\n\r\n}\r\n\r\nbool intersectTriangles(\r\n\tBVH bvh, vec3 rayOrigin, vec3 rayDirection, uint offset, uint count,\r\n\tinout float minDistance,\r\n\r\n\t// output variables\r\n\tout uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,\r\n\tout float side, out float dist\r\n) {\r\n\r\n\tbool found = false;\r\n\tvec3 localBarycoord, localNormal;\r\n\tfloat localDist, localSide;\r\n\tfor ( uint i = offset, l = offset + count; i < l; i ++ ) {\r\n\r\n\t\tuvec3 indices = uTexelFetch1D( bvh.index, i ).xyz;\r\n\t\tvec3 a = texelFetch1D( bvh.position, indices.x ).rgb;\r\n\t\tvec3 b = texelFetch1D( bvh.position, indices.y ).rgb;\r\n\t\tvec3 c = texelFetch1D( bvh.position, indices.z ).rgb;\r\n\r\n\t\tif (\r\n\t\t\tintersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )\r\n\t\t\t&& localDist < minDistance\r\n\t\t) {\r\n\r\n\t\t\tfound = true;\r\n\t\t\tminDistance = localDist;\r\n\r\n\t\t\tfaceIndices = uvec4( indices.xyz, i );\r\n\t\t\tfaceNormal = localNormal;\r\n\r\n\t\t\tside = localSide;\r\n\t\t\tbarycoord = localBarycoord;\r\n\t\t\tdist = localDist;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn found;\r\n\r\n}\r\n\r\nfloat intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, BVH bvh, uint currNodeIndex ) {\r\n\r\n\tvec3 boundsMin = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 0u ).xyz;\r\n\tvec3 boundsMax = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 1u ).xyz;\r\n\treturn intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax );\r\n\r\n}\r\n\r\nbool bvhIntersectFirstHit(\r\n\tBVH bvh, vec3 rayOrigin, vec3 rayDirection,\r\n\r\n\t// output variables\r\n\tout uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,\r\n\tout float side, out float dist\r\n) {\r\n\r\n\t// stack needs to be twice as long as the deepest tree we expect because\r\n\t// we push both the left and right child onto the stack every traversal\r\n\tint ptr = 0;\r\n\tuint stack[ 60 ];\r\n\tstack[ 0 ] = 0u;\r\n\r\n\tfloat triangleDistance = 1e20;\r\n\tbool found = false;\r\n\twhile ( ptr > - 1 && ptr < 60 ) {\r\n\r\n\t\tuint currNodeIndex = stack[ ptr ];\r\n\t\tptr --;\r\n\r\n\t\t// check if we intersect the current bounds\r\n\t\tfloat boundsHitDistance = intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh, currNodeIndex );\r\n\t\tif ( boundsHitDistance == INFINITY || boundsHitDistance > triangleDistance ) {\r\n\r\n\t\t\tcontinue;\r\n\r\n\t\t}\r\n\r\n\t\tuvec2 boundsInfo = uTexelFetch1D( bvh.bvhContents, currNodeIndex ).xy;\r\n\t\tbool isLeaf = bool( boundsInfo.x & 0xffff0000u );\r\n\r\n\t\tif ( isLeaf ) {\r\n\r\n\t\t\tuint count = boundsInfo.x & 0x0000ffffu;\r\n\t\t\tuint offset = boundsInfo.y;\r\n\r\n\t\t\tfound = intersectTriangles(\r\n\t\t\t\tbvh, rayOrigin, rayDirection, offset, count, triangleDistance,\r\n\t\t\t\tfaceIndices, faceNormal, barycoord, side, dist\r\n\t\t\t) || found;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tuint leftIndex = currNodeIndex + 1u;\r\n\t\t\tuint splitAxis = boundsInfo.x & 0x0000ffffu;\r\n\t\t\tuint rightIndex = boundsInfo.y;\r\n\r\n\t\t\tbool leftToRight = rayDirection[ splitAxis ] >= 0.0;\r\n\t\t\tuint c1 = leftToRight ? leftIndex : rightIndex;\r\n\t\t\tuint c2 = leftToRight ? rightIndex : leftIndex;\r\n\r\n\t\t\t// set c2 in the stack so we traverse it later. We need to keep track of a pointer in\r\n\t\t\t// the stack while we traverse. The second pointer added is the one that will be\r\n\t\t\t// traversed first\r\n\t\t\tptr ++;\r\n\t\t\tstack[ ptr ] = c2;\r\n\r\n\t\t\tptr ++;\r\n\t\t\tstack[ ptr ] = c1;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\treturn found;\r\n\r\n}\r\n\r\n`;\r\n\r\n\n\n//# sourceURL=webpack://webpack-demo/./src/util/three-mesh-bvh.js?");

/***/ }),

/***/ "https://cdn.skypack.dev/pin/three@v0.135.0-pjGUcRG9Xt70OdXl97VF/mode=imports/optimized/three.js":
/*!******************************************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/pin/three@v0.135.0-pjGUcRG9Xt70OdXl97VF/mode=imports/optimized/three.js" ***!
  \******************************************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_pin_three_v0_135_0_pjGUcRG9Xt70OdXl97VF_mode_imports_optimized_three_js_ca8443e7__;

/***/ }),

/***/ "https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js":
/*!******************************************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/pin/three@v0.137.0-X5O2PK3x44y1WRry67Kr/mode=imports/optimized/three.js" ***!
  \******************************************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_pin_three_v0_137_0_X5O2PK3x44y1WRry67Kr_mode_imports_optimized_three_js_e9257153__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js":
/*!***********************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js" ***!
  \***********************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_controls_OrbitControls_js_45f05ee1__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FBXLoader.js":
/*!******************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FBXLoader.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_FBXLoader_js_3c26c106__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js":
/*!*******************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/GLTFLoader.js" ***!
  \*******************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_loaders_GLTFLoader_js_9cb5268d__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/EffectComposer.js":
/*!******************************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/EffectComposer.js" ***!
  \******************************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_EffectComposer_js_4572cba5__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/FilmPass.js":
/*!************************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/FilmPass.js" ***!
  \************************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_FilmPass_js_a4cf9645__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/RenderPass.js":
/*!**************************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/RenderPass.js" ***!
  \**************************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_RenderPass_js_0dc18f7f__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/ShaderPass.js":
/*!**************************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/postprocessing/ShaderPass.js" ***!
  \**************************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_postprocessing_ShaderPass_js_de906420__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/renderers/CSS2DRenderer.js":
/*!************************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/renderers/CSS2DRenderer.js" ***!
  \************************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_renderers_CSS2DRenderer_js_d3e40862__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/shaders/FXAAShader.js":
/*!*******************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/shaders/FXAAShader.js" ***!
  \*******************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_shaders_FXAAShader_js_6abc11d7__;

/***/ }),

/***/ "https://cdn.skypack.dev/three@0.136.0/examples/jsm/utils/BufferGeometryUtils.js":
/*!**************************************************************************************************!*\
  !*** external "https://cdn.skypack.dev/three@0.136.0/examples/jsm/utils/BufferGeometryUtils.js" ***!
  \**************************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_cdn_skypack_dev_three_0_136_0_examples_jsm_utils_BufferGeometryUtils_js_2cb856e0__;

/***/ }),

/***/ "https://threejs.org/examples/jsm/math/ImprovedNoise.js":
/*!*************************************************************************!*\
  !*** external "https://threejs.org/examples/jsm/math/ImprovedNoise.js" ***!
  \*************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_threejs_org_examples_jsm_math_ImprovedNoise_js_6d016c7a__;

/***/ }),

/***/ "https://unpkg.com/three@0.137.0/examples/jsm/postprocessing/SMAAPass.js":
/*!******************************************************************************************!*\
  !*** external "https://unpkg.com/three@0.137.0/examples/jsm/postprocessing/SMAAPass.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

var x = y => { var x = {}; __webpack_require__.d(x, y); return x; }
var y = x => () => x
module.exports = __WEBPACK_EXTERNAL_MODULE_https_unpkg_com_three_0_137_0_examples_jsm_postprocessing_SMAAPass_js_959c2540__;

/***/ })

/******/ });
/************************************************************************/
/******/ // The module cache
/******/ var __webpack_module_cache__ = {};
/******/ 
/******/ // The require function
/******/ function __webpack_require__(moduleId) {
/******/ 	// Check if module is in cache
/******/ 	var cachedModule = __webpack_module_cache__[moduleId];
/******/ 	if (cachedModule !== undefined) {
/******/ 		return cachedModule.exports;
/******/ 	}
/******/ 	// Create a new module (and put it into the cache)
/******/ 	var module = __webpack_module_cache__[moduleId] = {
/******/ 		// no module.id needed
/******/ 		// no module.loaded needed
/******/ 		exports: {}
/******/ 	};
/******/ 
/******/ 	// Execute the module function
/******/ 	__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 
/******/ 	// Return the exports of the module
/******/ 	return module.exports;
/******/ }
/******/ 
/************************************************************************/
/******/ /* webpack/runtime/define property getters */
/******/ (() => {
/******/ 	// define getter functions for harmony exports
/******/ 	__webpack_require__.d = (exports, definition) => {
/******/ 		for(var key in definition) {
/******/ 			if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 				Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 			}
/******/ 		}
/******/ 	};
/******/ })();
/******/ 
/******/ /* webpack/runtime/hasOwnProperty shorthand */
/******/ (() => {
/******/ 	__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ })();
/******/ 
/******/ /* webpack/runtime/make namespace object */
/******/ (() => {
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = (exports) => {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/ })();
/******/ 
/************************************************************************/
/******/ 
/******/ // startup
/******/ // Load entry module and return exports
/******/ // This entry module can't be inlined because the eval devtool is used.
/******/ var __webpack_exports__ = __webpack_require__("./src/VirtualEnvironment.js");
/******/ export { __webpack_exports__  as spacetime};
